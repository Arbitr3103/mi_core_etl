<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Ozon Demographics Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="src/js/OzonDemographics.js"></script>
    <style>
      body {
        background: #f8f9fa;
        padding: 20px;
      }

      .chart-container {
        position: relative;
        height: 300px;
      }

      .region-block {
        transition: all 0.3s ease;
      }

      .region-block:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <h1>üß™ Test Ozon Demographics Dashboard</h1>

      <!-- Test Filters -->
      <div class="card mb-4">
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-3">
              <label class="form-label">üìÖ –ü–µ—Ä–∏–æ–¥ —Å:</label>
              <input
                type="date"
                id="analyticsStartDate"
                class="form-control"
                value="2025-01-01"
              />
            </div>
            <div class="col-md-3">
              <label class="form-label">üìÖ –ø–æ:</label>
              <input
                type="date"
                id="analyticsEndDate"
                class="form-control"
                value="2025-01-31"
              />
            </div>
            <div class="col-md-3">
              <label class="form-label">üì¶ –¢–æ–≤–∞—Ä:</label>
              <select id="analyticsProduct" class="form-control">
                <option value="">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</option>
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label">üì¢ –ö–∞–º–ø–∞–Ω–∏—è:</label>
              <select id="analyticsCampaign" class="form-control">
                <option value="">–í—Å–µ –∫–∞–º–ø–∞–Ω–∏–∏</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <!-- Demographics Container -->
      <div id="demographicsContainer">
        <!-- Demographics dashboard will be initialized here -->
      </div>

      <!-- Test Controls -->
      <div class="card mt-4">
        <div class="card-body">
          <h5>üîß Test Controls</h5>
          <div class="btn-group" role="group">
            <button type="button" id="testInitialize" class="btn btn-primary">
              Initialize Demographics
            </button>
            <button type="button" id="testLoadData" class="btn btn-success">
              Load Test Data
            </button>
            <button type="button" id="testDestroy" class="btn btn-danger">
              Destroy Component
            </button>
          </div>
          <div class="mt-3">
            <div id="testStatus" class="alert alert-info">
              Ready to test demographics dashboard
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      let ozonDemographics = null;

      // Test data
      const testDemographicsData = [
        {
          age_group: "18-24",
          gender: "M",
          region: "–ú–æ—Å–∫–≤–∞",
          orders_count: 150,
          revenue: 45000,
        },
        {
          age_group: "18-24",
          gender: "F",
          region: "–ú–æ—Å–∫–≤–∞",
          orders_count: 200,
          revenue: 60000,
        },
        {
          age_group: "25-34",
          gender: "M",
          region: "–ú–æ—Å–∫–≤–∞",
          orders_count: 300,
          revenue: 90000,
        },
        {
          age_group: "25-34",
          gender: "F",
          region: "–ú–æ—Å–∫–≤–∞",
          orders_count: 250,
          revenue: 75000,
        },
        {
          age_group: "35-44",
          gender: "M",
          region: "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
          orders_count: 180,
          revenue: 54000,
        },
        {
          age_group: "35-44",
          gender: "F",
          region: "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥",
          orders_count: 220,
          revenue: 66000,
        },
        {
          age_group: "45-54",
          gender: "M",
          region: "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥",
          orders_count: 120,
          revenue: 36000,
        },
        {
          age_group: "45-54",
          gender: "F",
          region: "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥",
          orders_count: 140,
          revenue: 42000,
        },
        {
          age_group: "55-64",
          gender: "M",
          region: "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫",
          orders_count: 80,
          revenue: 24000,
        },
        {
          age_group: "55-64",
          gender: "F",
          region: "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫",
          orders_count: 90,
          revenue: 27000,
        },
        {
          age_group: "65+",
          gender: "M",
          region: "–ö–∞–∑–∞–Ω—å",
          orders_count: 40,
          revenue: 12000,
        },
        {
          age_group: "65+",
          gender: "F",
          region: "–ö–∞–∑–∞–Ω—å",
          orders_count: 50,
          revenue: 15000,
        },
        {
          age_group: "25-34",
          gender: "M",
          region: "–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥",
          orders_count: 100,
          revenue: 30000,
        },
        {
          age_group: "25-34",
          gender: "F",
          region: "–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥",
          orders_count: 110,
          revenue: 33000,
        },
        {
          age_group: "35-44",
          gender: "M",
          region: "–ß–µ–ª—è–±–∏–Ω—Å–∫",
          orders_count: 70,
          revenue: 21000,
        },
        {
          age_group: "35-44",
          gender: "F",
          region: "–ß–µ–ª—è–±–∏–Ω—Å–∫",
          orders_count: 85,
          revenue: 25500,
        },
        {
          age_group: "25-34",
          gender: "M",
          region: "–°–∞–º–∞—Ä–∞",
          orders_count: 95,
          revenue: 28500,
        },
        {
          age_group: "25-34",
          gender: "F",
          region: "–°–∞–º–∞—Ä–∞",
          orders_count: 105,
          revenue: 31500,
        },
        {
          age_group: "35-44",
          gender: "M",
          region: "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É",
          orders_count: 60,
          revenue: 18000,
        },
        {
          age_group: "35-44",
          gender: "F",
          region: "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É",
          orders_count: 75,
          revenue: 22500,
        },
      ];

      function updateTestStatus(message, type = "info") {
        const statusEl = document.getElementById("testStatus");
        statusEl.className = `alert alert-${type}`;
        statusEl.textContent = message;
      }

      // Test controls
      document
        .getElementById("testInitialize")
        .addEventListener("click", function () {
          try {
            if (ozonDemographics) {
              ozonDemographics.destroy();
            }

            ozonDemographics = new OzonDemographics({
              containerId: "demographicsContainer",
              apiBaseUrl: "/src/api/ozon-analytics.php",
              autoRefresh: false,
            });

            updateTestStatus(
              "Demographics dashboard initialized successfully!",
              "success"
            );
          } catch (error) {
            updateTestStatus(
              "Error initializing demographics: " + error.message,
              "danger"
            );
            console.error("Initialization error:", error);
          }
        });

      document
        .getElementById("testLoadData")
        .addEventListener("click", function () {
          try {
            if (!ozonDemographics) {
              updateTestStatus(
                "Please initialize the demographics dashboard first",
                "warning"
              );
              return;
            }

            // Simulate loading test data
            ozonDemographics.updateCharts(testDemographicsData);
            ozonDemographics.updateSummary(testDemographicsData);

            updateTestStatus("Test data loaded successfully!", "success");
          } catch (error) {
            updateTestStatus(
              "Error loading test data: " + error.message,
              "danger"
            );
            console.error("Data loading error:", error);
          }
        });

      document
        .getElementById("testDestroy")
        .addEventListener("click", function () {
          try {
            if (ozonDemographics) {
              ozonDemographics.destroy();
              ozonDemographics = null;

              // Clear the container
              document.getElementById("demographicsContainer").innerHTML = "";

              updateTestStatus("Demographics dashboard destroyed", "info");
            } else {
              updateTestStatus(
                "No demographics dashboard to destroy",
                "warning"
              );
            }
          } catch (error) {
            updateTestStatus(
              "Error destroying demographics: " + error.message,
              "danger"
            );
            console.error("Destroy error:", error);
          }
        });

      // Auto-initialize on page load
      document.addEventListener("DOMContentLoaded", function () {
        updateTestStatus(
          'Page loaded. Click "Initialize Demographics" to start testing.'
        );
      });
    </script>
  </body>
</html>
