# üöÄ –ì–æ—Ç–æ–≤–æ –∫ –õ–æ–∫–∞–ª—å–Ω–æ–º—É –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

## –î–∞—Ç–∞: 2025-10-27

### ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ì–æ—Ç–æ–≤–∞

–õ–æ–∫–∞–ª—å–Ω–∞—è —Å—Ä–µ–¥–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –Ω–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ Ozon ETL Refactoring.

---

## üìä –¢–µ–∫—É—â–µ–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ

### –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö: PostgreSQL 14.16

-   **–ò–º—è –ë–î:** mi_core_db
-   **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** vladimirbragin
-   **–•–æ—Å—Ç:** localhost:5432

### –î–∞–Ω–Ω—ã–µ

| –ú–µ—Ç—Ä–∏–∫–∞           | –ó–Ω–∞—á–µ–Ω–∏–µ |
| ----------------- | -------- |
| –ü—Ä–æ–¥—É–∫—Ç—ã –≠–¢–û–ù–û–í–û  | 10       |
| –ó–∞–ø–∏—Å–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è  | 29       |
| –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–∫–ª–∞–¥—ã | 29       |
| –ü–æ–∫—Ä—ã—Ç–∏–µ –¥–∞–Ω–Ω—ã–º–∏  | 100%     |

### –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö

```
SKU: 161875313 - –õ–∞–ø—à–∞ –≠–¢–û–ù–û–í–û —Ä–∏—Å–æ–≤–∞—è –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∞—è 300–≥
–°–∫–ª–∞–¥—ã:
  - –í–û–†–û–ù–ï–ñ_–ú–†–§–¶: 12 —à—Ç
  - –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥_–†–§–¶_–ù–û–í–´–ô: 17 —à—Ç
  - –ù–ï–í–ò–ù–ù–û–ú–´–°–°–ö_–†–§–¶: 16 —à—Ç
  - –û–†–ï–ù–ë–£–†–ì_–†–§–¶: 7 —à—Ç
  - –°–ê–ú–ê–†–ê_–†–§–¶: 7 —à—Ç
```

---

## üéØ –ß—Ç–æ –ú–æ–∂–Ω–æ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –ù–æ–≤—ã–π –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª ETL

-   ‚úÖ –ü–æ–ª–µ `visibility` –≤ `dim_products`
-   ‚úÖ –ü–æ–ª–µ `ozon_visibility` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
-   ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `etl_workflow_executions` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
-   ‚úÖ –†–∞–∑–±–∏–≤–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –ø–æ —Å–∫–ª–∞–¥–∞–º

### 2. –î–∞—à–±–æ—Ä–¥

-   –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –ø–æ —Å–∫–ª–∞–¥–∞–º
-   –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É visibility
-   –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ —Å–∫–ª–∞–¥–∞–º
-   –ù–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### 3. ETL –ü—Ä–æ—Ü–µ—Å—Å—ã

-   ProductETL –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è visibility
-   InventoryETL –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤
-   –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Ozon API

---

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ó–∞–ø—É—Å–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã
psql -d mi_core_db -c "SELECT sku_ozon, product_name FROM dim_products WHERE sku_ozon ~ '^[0-9]+$' LIMIT 5;"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
psql -d mi_core_db -c "SELECT dp.sku_ozon, i.warehouse_name, i.quantity_present FROM inventory i JOIN dim_products dp ON i.product_id = dp.id LIMIT 10;"
```

### –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: PHP –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
php -S localhost:8000 -t frontend/

# –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å–∫—Ä–∏–ø—Ç
./local-frontend.sh
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ETL (dry-run)

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
php src/ETL/Ozon/Scripts/etl_health_check.php

# –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ workflow
php src/ETL/Ozon/Scripts/run_etl_workflow.php --dry-run --verbose
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞

```
mi_core_etl/
‚îú‚îÄ‚îÄ src/ETL/Ozon/
‚îÇ   ‚îú‚îÄ‚îÄ Components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProductETL.php      # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ visibility
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ InventoryETL.php    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ Scripts/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ run_etl_workflow.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ etl_health_check.php
‚îÇ   ‚îî‚îÄ‚îÄ Config/
‚îÇ       ‚îî‚îÄ‚îÄ etl_config.php       # ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è PostgreSQL
‚îú‚îÄ‚îÄ frontend/                     # –î–∞—à–±–æ—Ä–¥
‚îú‚îÄ‚îÄ migrations/                   # SQL –º–∏–≥—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ docs/                        # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### ETL Config (src/ETL/Ozon/Config/etl_config.php)

```php
'database' => [
    'host' => 'localhost',
    'port' => '5432',
    'database' => 'mi_core_db',
    'username' => 'vladimirbragin',
    'password' => '',
]
```

### Ozon API

```php
'ozon_api' => [
    'client_id' => '26100',
    'api_key' => '7e074977-e0db-4ace-ba9e-82903e088b4b',
    'base_url' => 'https://api-seller.ozon.ru',
]
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

-   [x] PostgreSQL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
-   [x] MySQL —É–¥–∞–ª–µ–Ω (–Ω–µ—Ç –ø—É—Ç–∞–Ω–∏—Ü—ã)
-   [x] –î–∞–Ω–Ω—ã–µ –≠–¢–û–ù–û–í–û –∑–∞–≥—Ä—É–∂–µ–Ω—ã
-   [x] –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã
-   [x] –ü–æ–ª—è visibility –¥–æ–±–∞–≤–ª–µ–Ω—ã
-   [x] ETL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
-   [x] –°–∫—Ä–∏–ø—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã (syntax errors)
-   [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞

---

## üéâ –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –¥–∞—à–±–æ—Ä–¥**

    ```bash
    php -S localhost:8000 -t frontend/
    ```

    –û—Ç–∫—Ä—ã—Ç—å: http://localhost:8000

2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**

    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–±–∏–≤–∫—É –ø–æ —Å–∫–ª–∞–¥–∞–º
    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã

3. **–ó–∞–ø—É—Å—Ç–∏—Ç—å ProductETL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**

    - –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª–µ visibility —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ Ozon
    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤

4. **–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**
    - –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ visibility
    - –£–ª—É—á—à–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∫–ª–∞–¥–æ–≤
    - –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã:

-   –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `src/ETL/Ozon/Logs/`
-   –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `docs/ozon_etl_*.md`
-   Troubleshooting: `docs/ozon_etl_troubleshooting_guide.md`

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û –ö –†–ê–ë–û–¢–ï  
**–î–∞—Ç–∞:** 2025-10-27 18:22  
**–í–µ—Ä—Å–∏—è:** Ozon ETL Refactoring v1.0
