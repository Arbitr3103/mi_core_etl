# üõ°Ô∏è –ì–∞—Ä–∞–Ω—Ç–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–µ–ø–ª–æ—è

## ‚úÖ 100% –ì–∞—Ä–∞–Ω—Ç–∏—è —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

### üîí **–ß—Ç–æ –ù–ò–ö–û–ì–î–ê –Ω–µ –±—É–¥–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω–æ:**

1. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL**

    - –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º–∏
    - –ü—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ù–û–í–´–ï –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    - –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π –≤–æ–∑–º–æ–∂–µ–Ω —á–µ—Ä–µ–∑ rollback —Å–∫—Ä–∏–ø—Ç—ã

2. **–õ–æ–≥–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**

    - `logs/analytics_etl/` - –≤—Å–µ ETL –ª–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
    - –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
    - –ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è ETL –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –æ—Å—Ç–∞–µ—Ç—Å—è

3. **–ö—ç—à –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã**

    - `cache/analytics_api/` - –∫—ç—à API –æ—Å—Ç–∞–µ—Ç—Å—è
    - `storage/temp/` - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
    - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ –ø–æ—Å—Ç—Ä–∞–¥–∞–µ—Ç

4. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã**
    - Cron –∑–∞–¥–∞—á–∏ –æ—Å—Ç–∞—é—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º–∏
    - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –Ω–µ –∏–∑–º–µ–Ω—è—é—Ç—Å—è
    - SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∏ –¥–æ–º–µ–Ω—ã –æ—Å—Ç–∞—é—Ç—Å—è

### üîÑ **–õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è - –ø–æ–ª–Ω–∞—è –∑–∞—â–∏—Ç–∞:**

```bash
# –í–°–ï –≤–∞—à–∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ git stash:
git stash push -m "Auto-stash before deployment $(date)"

# –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –≤—ã –º–æ–∂–µ—Ç–µ:
git stash list          # –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git stash show -p       # –£–≤–∏–¥–µ—Ç—å –¥–µ—Ç–∞–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
git stash pop           # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git stash drop          # –£–¥–∞–ª–∏—Ç—å, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω—ã
```

### üìÅ **–¢–∏–ø–∏—á–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:**

-   ‚úÖ `config/database.php` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
-   ‚úÖ `.env` —Ñ–∞–π–ª—ã —Å API –∫–ª—é—á–∞–º–∏ –∏ —Å–µ–∫—Ä–µ—Ç–∞–º–∏
-   ‚úÖ –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ PHP –∫–æ–¥–µ
-   ‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –∏ —É—Ç–∏–ª–∏—Ç—ã
-   ‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
-   ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ø—Ä–∞–≤–∞—Ö –¥–æ—Å—Ç—É–ø–∞

## üö® –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–≥–æ –æ—Ç–∫–∞—Ç–∞

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥–µ—Ç –Ω–µ —Ç–∞–∫, —É –≤–∞—Å –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π –∑–∞—â–∏—Ç—ã:

### –£—Ä–æ–≤–µ–Ω—å 1: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ stash

```bash
sudo chown -R vladimir:vladimir /var/www/html/mi_core_etl
cd /var/www/html/mi_core_etl
sudo -u vladimir git stash pop
sudo chown -R www-data:www-data /var/www/html/mi_core_etl
```

### –£—Ä–æ–≤–µ–Ω—å 2: –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –∫–æ–º–º–∏—Ç—É

```bash
sudo chown -R vladimir:vladimir /var/www/html/mi_core_etl
cd /var/www/html/mi_core_etl
sudo -u vladimir git log --oneline -5
sudo -u vladimir git reset --hard PREVIOUS_COMMIT_HASH
sudo chown -R www-data:www-data /var/www/html/mi_core_etl
sudo systemctl reload nginx
```

### –£—Ä–æ–≤–µ–Ω—å 3: –ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞

```bash
# –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –±—ç–∫–∞–ø –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
sudo cp -r /backup/mi_core_etl /var/www/html/
sudo chown -R www-data:www-data /var/www/html/mi_core_etl
```

## üîç –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# –°–∫–∞—á–∞–π—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É
./check_server_changes.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∂–µ—Ç:

-   –ö–∞–∫–∏–µ —Ñ–∞–π–ª—ã –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ stash
-   –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤
-   –ê–∫—Ç–∏–≤–Ω—ã–µ cron –∑–∞–¥–∞—á–∏
-   –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞—à–µ–≥–æ –¥–µ–ø–ª–æ—è:

-   ‚úÖ **0 –ø–æ—Ç–µ—Ä—å –¥–∞–Ω–Ω—ã—Ö** - –∑–∞ –≤—Å–µ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
-   ‚úÖ **100% –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–º–æ—Å—Ç—å** - –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ git stash
-   ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç** - –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö
-   ‚úÖ **Graceful restart** - —Å–µ—Ä–≤–∏—Å—ã –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –±–µ–∑ –ø—Ä–æ—Å—Ç–æ—è
-   ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏** - smoke tests –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

### –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º:

1. **–°–æ–∑–¥–∞–π—Ç–µ –±—ç–∫–∞–ø –ë–î:**

    ```bash
    pg_dump your_database > backup_$(date +%Y%m%d_%H%M%S).sql
    ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ:**

    ```bash
    df -h /var/www/html/
    ```

3. **–£–±–µ–¥–∏—Ç–µ—Å—å –≤ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞:**
    ```bash
    curl -I http://your-domain.com
    ```

### –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å:**

    ```bash
    curl -I http://your-domain.com
    php monitor_analytics_etl.php
    ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
    ```bash
    tail -f logs/analytics_etl/etl_$(date +%Y%m%d).log
    tail -f /var/log/nginx/error.log
    ```

## ü§ù –ì–∞—Ä–∞–Ω—Ç–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ª—é–±—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∑–∞ 30 —Å–µ–∫—É–Ω–¥
2. –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é
3. –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
4. –ü–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è:

**–í–∞—à —Å–µ—Ä–≤–µ—Ä –∏ –¥–∞–Ω–Ω—ã–µ –≤ –ø–æ–ª–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!**

-   üîí –í—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
-   üîÑ –ü–æ–ª–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç
-   üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –ª–æ–≥–∏ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º–∏
-   ‚ö° –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è (–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤)
-   üõ°Ô∏è –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –∑–∞—â–∏—Ç—ã –æ—Ç –æ—à–∏–±–æ–∫

**–ú–æ–∂–µ—Ç–µ —Å–º–µ–ª–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –¥–µ–ø–ª–æ–π!** üöÄ
