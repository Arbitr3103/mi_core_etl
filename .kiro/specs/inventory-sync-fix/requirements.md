# Requirements Document

## Introduction

Система управления остатками товаров на маркетплейсах (Озон и Wildberries) показывает неточные данные. В личном кабинете Озон отображается множество товаров с остатками, но в нашей системе показывается только 2 товара на Озон и 1 товар на ВБ. Необходимо исправить синхронизацию данных об остатках между API маркетплейсов и нашей базой данных.

## Requirements

### Requirement 1

**User Story:** Как менеджер по закупкам, я хочу видеть актуальные остатки товаров на всех маркетплейсах, чтобы принимать правильные решения о пополнении запасов.

#### Acceptance Criteria

1. WHEN система запрашивает данные об остатках THEN она SHALL получать все товары с ненулевыми остатками с API Озон
2. WHEN система запрашивает данные об остатках THEN она SHALL получать все товары с ненулевыми остатками с API Wildberries
3. WHEN данные об остатках получены THEN система SHALL корректно сохранять их в базу данных
4. WHEN пользователь просматривает дашборд остатков THEN система SHALL отображать все товары с актуальными остатками

### Requirement 2

**User Story:** Как системный администратор, я хочу диагностировать проблемы с синхронизацией остатков, чтобы быстро выявлять и устранять ошибки.

#### Acceptance Criteria

1. WHEN происходит ошибка синхронизации THEN система SHALL логировать детальную информацию об ошибке
2. WHEN запрос к API маркетплейса завершается неудачно THEN система SHALL записывать код ошибки и описание
3. WHEN данные не сохраняются в БД THEN система SHALL уведомлять об ошибках валидации или записи
4. IF синхронизация не выполнялась более 24 часов THEN система SHALL отправлять уведомление администратору

### Requirement 3

**User Story:** Как пользователь системы, я хочу видеть время последнего обновления данных об остатках, чтобы понимать актуальность информации.

#### Acceptance Criteria

1. WHEN данные об остатках обновляются THEN система SHALL сохранять timestamp последнего обновления
2. WHEN пользователь просматривает остатки THEN система SHALL отображать время последнего обновления для каждого маркетплейса
3. IF данные устарели более чем на 6 часов THEN система SHALL показывать предупреждение о неактуальности
4. WHEN происходит автоматическое обновление THEN система SHALL обновлять timestamp успешного обновления

### Requirement 4

**User Story:** Как аналитик, я хочу сравнивать остатки между нашей системой и данными маркетплейсов, чтобы выявлять расхождения.

#### Acceptance Criteria

1. WHEN выполняется проверка целостности данных THEN система SHALL сравнивать количество товаров в нашей БД с API маркетплейсов
2. WHEN обнаруживается расхождение в количестве товаров THEN система SHALL создавать отчет о несоответствиях
3. WHEN найдены товары отсутствующие в нашей БД THEN система SHALL предлагать их для добавления
4. IF расхождение превышает 10% товаров THEN система SHALL отправлять критическое уведомление

### Requirement 5

**User Story:** Как разработчик, я хочу иметь механизм принудительной пересинхронизации остатков, чтобы восстанавливать данные после сбоев.

#### Acceptance Criteria

1. WHEN запускается полная пересинхронизация THEN система SHALL очищать старые данные об остатках
2. WHEN выполняется пересинхронизация THEN система SHALL загружать все актуальные остатки с каждого маркетплейса
3. WHEN пересинхронизация завершена THEN система SHALL проверять целостность загруженных данных
4. IF пересинхронизация прерывается THEN система SHALL сохранять промежуточное состояние и позволять продолжить процесс
