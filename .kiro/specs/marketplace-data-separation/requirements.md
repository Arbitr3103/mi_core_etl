# Requirements Document

## Introduction

Система дашборда Manhattan в настоящее время отображает данные по продажам с маркетплейсов Озон и Валдберис в агрегированном виде. Клиентам необходимо видеть отдельную аналитику по каждому маркетплейсу для более точного анализа эффективности продаж и принятия решений по каждой площадке отдельно.

## Requirements

### Requirement 1

**User Story:** Как менеджер по продажам, я хочу видеть отдельную статистику маржинальности по Озон и Валдберис, чтобы анализировать эффективность каждого маркетплейса независимо.

#### Acceptance Criteria

1. WHEN пользователь открывает дашборд маржинальности THEN система SHALL отображать отдельные блоки KPI для Озон и Валдберис
2. WHEN пользователь просматривает показатели выручки THEN система SHALL показывать выручку отдельно по каждому маркетплейсу
3. WHEN пользователь анализирует маржинальность THEN система SHALL рассчитывать и отображать процент маржи отдельно для Озон и Валдберис
4. IF данные по одному из маркетплейсов отсутствуют THEN система SHALL отображать соответствующее уведомление

### Requirement 2

**User Story:** Как аналитик, я хочу видеть отдельные графики продаж по дням для каждого маркетплейса, чтобы отслеживать динамику продаж на каждой площадке.

#### Acceptance Criteria

1. WHEN пользователь просматривает графики продаж THEN система SHALL отображать отдельные линии/графики для Озон и Валдберис
2. WHEN пользователь выбирает период анализа THEN система SHALL применять фильтр к обоим маркетплейсам одновременно
3. WHEN пользователь наводит курсор на график THEN система SHALL показывать детальную информацию по конкретному маркетплейсу и дате
4. IF пользователь хочет скрыть один из маркетплейсов THEN система SHALL предоставить возможность переключения видимости

### Requirement 3

**User Story:** Как руководитель отдела продаж, я хочу видеть топ товаров отдельно по каждому маркетплейсу, чтобы понимать какие товары лучше продаются на конкретной площадке.

#### Acceptance Criteria

1. WHEN пользователь просматривает топ товаров THEN система SHALL отображать отдельные таблицы для Озон и Валдберис
2. WHEN система формирует рейтинг товаров THEN система SHALL сортировать товары по выручке/марже в рамках каждого маркетплейса отдельно
3. WHEN пользователь просматривает товар THEN система SHALL показывать SKU, специфичные для каждого маркетплейса (sku_ozon, sku_wb)
4. IF товар продается на обеих площадках THEN система SHALL отображать его в обеих таблицах с соответствующими метриками

### Requirement 4

**User Story:** Как менеджер по закупкам, я хочу видеть рекомендации по пополнению отдельно для каждого маркетплейса, чтобы планировать закупки с учетом специфики каждой площадки.

#### Acceptance Criteria

1. WHEN пользователь просматривает рекомендации по пополнению THEN система SHALL группировать рекомендации по маркетплейсам
2. WHEN система рассчитывает рекомендуемое количество THEN система SHALL учитывать продажи и остатки отдельно по каждому маркетплейсу
3. WHEN пользователь фильтрует рекомендации THEN система SHALL предоставить возможность фильтрации по маркетплейсу
4. IF товар продается на обеих площадках THEN система SHALL показывать отдельные рекомендации для каждого маркетплейса

### Requirement 5

**User Story:** Как пользователь системы, я хочу иметь возможность переключаться между общим видом и раздельным видом данных, чтобы выбирать наиболее подходящий формат анализа.

#### Acceptance Criteria

1. WHEN пользователь открывает дашборд THEN система SHALL предоставить переключатель "Общий вид / Раздельный вид"
2. WHEN пользователь выбирает "Общий вид" THEN система SHALL отображать агрегированные данные как сейчас
3. WHEN пользователь выбирает "Раздельный вид" THEN система SHALL отображать данные отдельно по маркетплейсам
4. WHEN пользователь меняет режим просмотра THEN система SHALL сохранять выбранный режим в сессии пользователя

### Requirement 6

**User Story:** Как администратор системы, я хочу чтобы разделение данных работало корректно с существующей структурой базы данных, чтобы не нарушить текущую функциональность.

#### Acceptance Criteria

1. WHEN система определяет источник данных THEN система SHALL использовать поля source, sku_ozon, sku_wb для идентификации маркетплейса
2. WHEN система обрабатывает исторические данные THEN система SHALL корректно классифицировать данные по маркетплейсам
3. WHEN система выполняет запросы к базе данных THEN система SHALL оптимизировать запросы для работы с разделенными данными
4. IF в данных отсутствует информация о маркетплейсе THEN система SHALL классифицировать такие записи как "Неопределенный источник"
