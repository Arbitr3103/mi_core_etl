# Requirements Document

## Introduction

Система получения точных остатков товаров на конкретных FBO-складах Ozon через API отчетов. Текущая система получает остатки по кластерам (например, "Центр", "Юг"), что бесполезно для планирования поставок. Необходимо получать остатки по конкретным складам (например, "Тверь", "Хоругвино") для точного управления запасами и планирования пополнений.

## Glossary

-   **Ozon_API_System**: Система интеграции с API Ozon для получения данных
-   **Warehouse_Stock_Report**: Отчет по остаткам на складах, генерируемый через API отчетов Ozon
-   **FBO_Warehouse**: Конкретный склад FBO (Fulfillment by Ozon) с точным названием и местоположением
-   **Stock_Cluster**: Группа складов по регионам (например, "Центр", "Юг") - неточные данные
-   **ETL_Process**: Процесс извлечения, трансформации и загрузки данных остатков
-   **Report_Generation_Request**: Запрос на создание отчета через POST /v1/report/warehouse/stock
-   **Report_Status_Check**: Проверка готовности отчета через POST /v1/report/info
-   **CSV_Report_File**: Файл отчета в формате CSV с детализацией по каждому складу

## Requirements

### Requirement 1

**User Story:** Как менеджер по закупкам, я хочу получать точные остатки товаров на конкретных FBO-складах Ozon, чтобы планировать пополнения для каждого склада отдельно.

#### Acceptance Criteria

1. WHEN система запрашивает остатки через стандартный API, THE Ozon_API_System SHALL возвращать данные по кластерам складов
2. WHEN система использует API отчетов, THE Ozon_API_System SHALL предоставлять остатки по конкретным FBO_Warehouse
3. THE ETL_Process SHALL запрашивать генерацию Warehouse_Stock_Report через POST /v1/report/warehouse/stock
4. THE ETL_Process SHALL проверять готовность отчета через POST /v1/report/info каждые 5-10 минут
5. WHEN отчет готов, THE ETL_Process SHALL скачивать и обрабатывать CSV_Report_File

### Requirement 2

**User Story:** Как система управления запасами, я хочу автоматически получать обновленные остатки по складам ежедневно, чтобы поддерживать актуальную информацию для принятия решений.

#### Acceptance Criteria

1. THE ETL_Process SHALL запускаться автоматически каждый день в 06:00 UTC
2. THE ETL_Process SHALL запрашивать Report_Generation_Request для всех активных товаров
3. WHILE отчет генерируется, THE ETL_Process SHALL ожидать готовности максимум 60 минут
4. WHEN отчет готов, THE ETL_Process SHALL загружать данные в таблицу inventory с указанием конкретного FBO_Warehouse
5. THE ETL_Process SHALL логировать все этапы процесса для мониторинга

### Requirement 3

**User Story:** Как аналитик, я хочу видеть остатки с указанием конкретного склада и его местоположения, чтобы анализировать распределение товаров по регионам.

#### Acceptance Criteria

1. THE Ozon_API_System SHALL сохранять название FBO_Warehouse точно как в отчете Ozon
2. THE Ozon_API_System SHALL сопоставлять названия складов с их географическим расположением
3. THE Ozon_API_System SHALL различать основные склады от аналитических данных
4. THE Ozon_API_System SHALL предоставлять API для получения остатков с фильтрацией по конкретному FBO_Warehouse
5. THE Ozon_API_System SHALL возвращать данные в формате JSON с полями: sku, warehouse_name, current_stock, reserved_stock, available_stock

### Requirement 4

**User Story:** Как система пополнения запасов, я хочу получать уведомления о критически низких остатках на конкретных складах, чтобы своевременно планировать поставки.

#### Acceptance Criteria

1. THE ETL_Process SHALL анализировать остатки после каждого обновления данных
2. WHEN остаток товара на FBO_Warehouse меньше минимального порога, THE ETL_Process SHALL создавать уведомление
3. THE ETL_Process SHALL группировать уведомления по складам для удобства планирования
4. THE ETL_Process SHALL отправлять сводку критических остатков менеджерам по закупкам
5. THE ETL_Process SHALL учитывать скорость продаж при расчете критических остатков

### Requirement 5

**User Story:** Как разработчик системы, я хочу иметь надежную обработку ошибок API отчетов, чтобы система продолжала работать даже при временных сбоях Ozon API.

#### Acceptance Criteria

1. WHEN запрос на генерацию отчета возвращает ошибку, THE ETL_Process SHALL повторить попытку через 30 минут максимум 3 раза
2. WHEN отчет не готов в течение 60 минут, THE ETL_Process SHALL логировать таймаут и уведомить администратора
3. WHEN скачивание CSV файла не удается, THE ETL_Process SHALL повторить попытку через 10 минут максимум 5 раз
4. IF все попытки неуспешны, THEN THE ETL_Process SHALL использовать последние доступные данные и уведомить о проблеме
5. THE ETL_Process SHALL сохранять статистику успешности запросов для мониторинга качества интеграции
