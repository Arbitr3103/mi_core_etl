# План реализации: Разделение товаров на активные и неактивные

## Задачи для выполнения

-   [x] 1. Анализ и исправление подключения к базе данных

    -   Исправить ошибку подключения в check_inventory_stats.php
    -   Проверить структуру таблицы inventory в PostgreSQL
    -   Создать рабочий скрипт для анализа остатков
    -   _Требования: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 2.4_

-   [x] 1.1 Исправить скрипт check_inventory_stats.php

    -   Добавить правильное подключение к PostgreSQL через postgresql_config.php
    -   Исправить ошибку "Undefined variable $pdo"
    -   Добавить обработку ошибок подключения
    -   _Требования: 2.1, 2.2, 2.3_

-   [x] 1.2 Проанализировать структуру таблицы inventory

    -   Выполнить DESCRIBE inventory для понимания полей
    -   Проверить наличие полей остатков (quantity_present, available, etc.)
    -   Создать SQL запрос для анализа распределения остатков
    -   _Требования: 1.1, 1.2, 1.3_

-   [x] 1.3 Создать тестовые запросы для анализа активности

    -   Написать SQL для подсчета активных товаров (остаток > 0)
    -   Написать SQL для подсчета неактивных товаров (остаток = 0)
    -   Проверить корректность логики суммирования остатков
    -   _Требования: 1.4, 3.1, 3.2, 3.3_

-   [ ] 2. Создание системы анализа остатков и продаж по складам

    -   Создать скрипт для анализа остатков в разрезе каждого склада
    -   Интегрировать данные продаж для расчета потребности в пополнении
    -   Реализовать определение складов, требующих пополнения на основе продаж
    -   Создать дашборд для мониторинга состояния складов с рекомендациями
    -   _Требования: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 2.4_

-   [x] 2.1 Проанализировать структуру данных продаж и создать базовые запросы

    -   Исследовать структуру таблиц с данными продаж (orders, order_items, sales, etc.)
    -   Создать SQL запросы для извлечения продаж за последний месяц по товарам и складам
    -   Написать запросы для группировки данных остатков по warehouse_name
    -   Рассчитать общие остатки, активные и неактивные товары по каждому складу
    -   Определить средние, минимальные и максимальные остатки по складам
    -   _Требования: 1.1, 1.2, 1.3_

-   [x] 2.2 Реализовать анализ продаж и прогнозирование потребности

    -   Создать запросы для анализа фактических продаж за последний месяц по товарам и складам
    -   Рассчитать среднемесячный расход товаров на каждом складе
    -   Определить минимальный запас для обеспечения продаж на месяц вперед
    -   Создать алгоритм прогнозирования потребности в пополнении
    -   _Требования: 1.4, 2.1, 2.2_

-   [x] 2.3 Реализовать определение критических складов на основе продаж

    -   Создать логику для выявления складов с недостаточными остатками относительно продаж
    -   Установить пороговые значения: критический (< 0.5 месяца), низкий (< 1 месяца), нормальный (1-2 месяца), избыточный (> 2 месяцев)
    -   Добавить категоризацию складов на основе соотношения остатков к месячным продажам
    -   Рассчитать приоритет пополнения на основе скорости продаж и текущих остатков
    -   _Требования: 1.4, 2.1, 2.2_

-   [x] 2.4 Создать систему рекомендаций по пополнению

    -   Рассчитать рекомендуемое количество для заказа на основе месячных продаж
    -   Определить критичность пополнения (срочно, в течение недели, плановое)
    -   Создать формулы: рекомендуемый*заказ = (среднемесячные*продажи \* 2) - текущий_остаток
    -   Добавить учет времени поставки и сезонности продаж
    -   _Требования: 2.3, 2.4, 3.1, 3.2_

-   [x] 2.5 Создать отчет по состоянию складов с рекомендациями

    -   Сформировать детальный отчет с данными по каждому складу включая продажи
    -   Добавить топ-10 товаров требующих срочного пополнения по каждому складу
    -   Включить конкретные рекомендации по количеству и срокам пополнения
    -   Создать сводную таблицу с ключевыми метриками: остатки, продажи, дни до исчерпания, рекомендуемый заказ
    -   Добавить расчет общей суммы рекомендуемых закупок по складам
    -   _Требования: 2.3, 2.4, 3.1, 3.2_

-   [x] 2.6 Создать дашборд мониторинга складов с аналитикой продаж

    -   Разработать веб-интерфейс для отображения состояния складов с учетом продаж
    -   Добавить цветовую индикацию: красный (< 0.5 мес), желтый (0.5-1 мес), зеленый (> 1 мес)
    -   Реализовать детальный просмотр товаров по выбранному складу с данными продаж
    -   Добавить графики динамики продаж и остатков по товарам
    -   Создать раздел "Срочные пополнения" с приоритизированным списком
    -   Добавить возможность экспорта отчетов и заявок на пополнение
    -   _Требования: 3.3, 3.4, 4.1, 4.2_

-   [x] 3. Реализация логики активности товаров в API

    -   Обновить API inventory-analytics.php для расчета активности
    -   Добавить поле activity_status в ответ API
    -   Реализовать правильную логику суммирования остатков
    -   _Требования: 3.1, 3.2, 3.3, 3.4_

-   [x] 3.1 Обновить API для расчета общего остатка

    -   Модифицировать SQL запрос для суммирования всех полей остатков
    -   Добавить вычисление total_stock = quantity_present + available + preparing_for_sale + in_requests + in_transit
    -   Добавить поле total_stock в ответ API
    -   _Требования: 3.1, 3.2_

-   [x] 3.2 Добавить определение статуса активности

    -   Реализовать логику: active если total_stock > 0, иначе inactive
    -   Добавить поле activity_status в JSON ответ API
    -   Обеспечить корректную типизацию данных
    -   _Требования: 3.2, 3.3_

-   [x] 3.3 Добавить статистику по активности в API

    -   Реализовать подсчет общего количества активных товаров
    -   Реализовать подсчет общего количества неактивных товаров
    -   Добавить эти данные в metadata ответа API
    -   _Требования: 3.4, 4.4_

-   [x] 4. Обновление дашборда с фильтрацией по активности

    -   Добавить кнопки фильтрации в интерфейс дашборда
    -   Реализовать логику фильтрации товаров по активности
    -   Обновить отображение статистики для каждого фильтра
    -   _Требования: 4.1, 4.2, 4.3, 4.4_

-   [x] 4.1 Добавить кнопки фильтрации в дашборд

    -   Создать кнопки "Все", "Активные", "Неактивные" в HTML
    -   Добавить CSS стили для активного состояния кнопок
    -   Реализовать JavaScript обработчики для переключения фильтров
    -   _Требования: 4.1, 4.2, 4.3_

-   [x] 4.2 Реализовать логику фильтрации товаров

    -   Добавить JavaScript функцию для фильтрации по activity_status
    -   Реализовать показ/скрытие строк таблицы в зависимости от фильтра
    -   Обеспечить корректную работу с пагинацией
    -   _Требования: 4.2, 4.3_

-   [x] 4.3 Обновить статистику в дашборде

    -   Модифицировать отображение общего количества товаров
    -   Добавить отображение количества активных/неактивных товаров
    -   Обновлять статистику при изменении фильтра
    -   _Требования: 4.4_

-   [x] 5. Визуальное различение активных и неактивных товаров

    -   Добавить цветовое кодирование для товаров
    -   Выделить колонку с общим остатком
    -   Добавить специальные стили для нулевых остатков
    -   _Требования: 5.1, 5.2, 5.3, 5.4_

-   [x] 5.1 Добавить колонку общего остатка

    -   Добавить новую колонку "Общий остаток" в таблицу дашборда
    -   Отображать значение total_stock из API
    -   Добавить сортировку по этой колонке
    -   _Требования: 5.3_

-   [x] 5.2 Реализовать цветовое кодирование

    -   Добавить CSS классы для активных товаров (зеленый/обычный)
    -   Добавить CSS классы для неактивных товаров (красный/серый)
    -   Применять стили на основе activity_status
    -   _Требования: 5.1, 5.2_

-   [x] 5.3 Выделить нулевые остатки

    -   Добавить специальный стиль для значений остатка = 0
    -   Использовать жирный шрифт или фоновый цвет для выделения
    -   Добавить иконку или значок для нулевых остатков
    -   _Требования: 5.4_

-   [x] 6. Тестирование и валидация

    -   Протестировать корректность расчета активности
    -   Проверить работу фильтрации в дашборде
    -   Валидировать соответствие статистики реальным данным
    -   Протестировать анализ остатков по складам
    -   _Требования: Все требования_

-   [x] 6.1 Тестирование логики активности

    -   Создать тестовые данные с различными комбинациями остатков
    -   Проверить корректность суммирования полей остатков
    -   Валидировать правильность определения активности товаров
    -   _Требования: 3.1, 3.2, 3.3_

-   [x] 6.2 Тестирование анализа по складам

    -   Проверить корректность группировки данных по складам
    -   Валидировать расчет критических уровней остатков
    -   Протестировать определение приоритетов пополнения
    -   Проверить точность отчетов по состоянию складов
    -   _Требования: 2.1, 2.2, 2.3, 2.4_

-   [x] 6.3 Тестирование фильтрации в дашборде

    -   Проверить работу всех кнопок фильтрации
    -   Валидировать корректность отображения товаров для каждого фильтра
    -   Проверить обновление статистики при переключении фильтров
    -   _Требования: 4.1, 4.2, 4.3, 4.4_

-   [x] 6.4 Валидация визуального отображения
    -   Проверить корректность цветового кодирования
    -   Валидировать выделение нулевых остатков
    -   Проверить читаемость и удобство интерфейса
    -   Протестировать дашборд мониторинга складов
    -   _Требования: 5.1, 5.2, 5.3, 5.4_
