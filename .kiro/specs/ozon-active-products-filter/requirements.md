# Requirements Document

## Introduction

Система в настоящее время обрабатывает все 176 товаров из базы данных, включая неактивные товары, что приводит к неэффективному использованию ресурсов и засорению дашборда ненужной информацией. Необходимо оптимизировать систему для работы только с активными товарами в продаже (48 товаров), используя правильные фильтры Ozon API.

## Requirements

### Requirement 1

**User Story:** Как администратор системы, я хочу чтобы ETL процесс загружал только активные товары в продаже, чтобы система работала эффективно и показывала релевантные данные.

#### Acceptance Criteria

1. WHEN система запрашивает список товаров через /v2/product/list THEN система SHALL использовать фильтр visibility: "VISIBLE"
2. WHEN система получает детальную информацию товаров THEN система SHALL проверять state = "processed"
3. WHEN система проверяет остатки товаров THEN система SHALL учитывать только товары с present > 0
4. WHEN система сохраняет товары в базу данных THEN система SHALL помечать товары как активные/неактивные на основе критериев

### Requirement 2

**User Story:** Как пользователь дашборда, я хочу видеть аналитику только по товарам в продаже, чтобы получать точные и релевантные данные для принятия решений.

#### Acceptance Criteria

1. WHEN дашборд рассчитывает критические остатки THEN система SHALL учитывать только активные товары
2. WHEN дашборд показывает низкие остатки THEN система SHALL фильтровать только товары в продаже
3. WHEN дашборд отображает избыточные остатки THEN система SHALL исключать неактивные товары
4. WHEN API возвращает статистику THEN система SHALL базировать расчеты на 48 активных товарах вместо 176

### Requirement 3

**User Story:** Как разработчик системы, я хочу иметь гибкую систему фильтрации товаров, чтобы легко настраивать критерии активности товаров.

#### Acceptance Criteria

1. WHEN система определяет активность товара THEN система SHALL использовать комбинированные критерии: visibility=VISIBLE AND state=processed AND present>0
2. WHEN в базе данных обновляется информация о товаре THEN система SHALL обновлять флаг активности товара
3. WHEN администратор запрашивает статистику THEN система SHALL предоставлять отдельные счетчики для активных и всех товаров
4. IF товар становится неактивным THEN система SHALL исключать его из расчетов дашборда

### Requirement 4

**User Story:** Как администратор системы, я хочу контролировать процесс фильтрации товаров, чтобы отслеживать изменения в статусе товаров.

#### Acceptance Criteria

1. WHEN система обновляет статус товаров THEN система SHALL логировать изменения активности товаров
2. WHEN ETL процесс завершается THEN система SHALL предоставлять отчет о количестве активных/неактивных товаров
3. WHEN происходит ошибка при определении статуса товара THEN система SHALL логировать ошибку и продолжать обработку других товаров
4. IF количество активных товаров значительно изменилось THEN система SHALL отправлять уведомление администратору
