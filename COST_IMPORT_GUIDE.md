# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–º–ø–æ—Ä—Ç—É —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–æ–≤

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Excel —Ñ–∞–π–ª–æ–≤. –ü—Ä–æ—Ü–µ—Å—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ –≤–∫–ª—é—á–∞–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î –∏ –∞—Ä—Ö–∏–≤–∞—Ü–∏—é –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. `cost_importer.py` - –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –∏–º–ø–æ—Ä—Ç–∞
- –ü–æ–∏—Å–∫ —Ñ–∞–π–ª–∞ `cost_price.xlsx` –≤ –ø–∞–ø–∫–µ `uploads/`
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã Excel —Ñ–∞–π–ª–∞
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `dim_products` –ø–æ —à—Ç—Ä–∏—Ö–∫–æ–¥—É
- –ê—Ä—Ö–∏–≤–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### 2. `run_cost_import.sh` - Shell —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
- –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (lock —Ñ–∞–π–ª)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª—ã —Å –¥–∞—Ç–æ–π
- –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —á–µ—Ä–µ–∑ cron

### 3. `test_cost_importer.py` - –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö Excel —Ñ–∞–π–ª–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã

## –§–æ—Ä–º–∞—Ç Excel —Ñ–∞–π–ª–∞

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏:
- `barcode` - —à—Ç—Ä–∏—Ö–∫–æ–¥ —Ç–æ–≤–∞—Ä–∞ (—Ç–µ–∫—Å—Ç)
- `cost_price` - —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å (—á–∏—Å–ª–æ > 0)

### –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
```
barcode         | cost_price
4607034370237   | 150.50
4607034370244   | 200.00
4607034370251   | 175.25
```

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –¥–∞–Ω–Ω—ã–º:
- –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è `cost_price.xlsx`
- –®—Ç—Ä–∏—Ö–∫–æ–¥—ã –¥–æ–ª–∂–Ω—ã —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Ç–∞–±–ª–∏—Ü–µ `dim_products`
- –¶–µ–Ω—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏
- –ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ Python –ø–∞–∫–µ—Ç—ã:
```bash
pip install pandas openpyxl mysql-connector-python
```

### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
```
mi_core_etl/
‚îú‚îÄ‚îÄ cost_importer.py
‚îú‚îÄ‚îÄ run_cost_import.sh
‚îú‚îÄ‚îÄ uploads/
‚îÇ   ‚îî‚îÄ‚îÄ cost_price.xlsx      # –§–∞–π–ª –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
‚îî‚îÄ‚îÄ uploads/archive/         # –ê—Ä—Ö–∏–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
```

### 3. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
```bash
chmod +x run_cost_import.sh
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
```bash
# –ü–æ–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª cost_price.xlsx –≤ –ø–∞–ø–∫—É uploads/
python3 cost_importer.py
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ cron
```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ crontab –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –≤ 5:00
0 5 * * * /home/vladimir/mi_core_etl/run_cost_import.sh
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ –∏ –∑–∞–ø—É—Å–∫
python3 test_cost_importer.py
python3 cost_importer.py
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –§–∞–π–ª—ã –ª–æ–≥–æ–≤
- `logs/cost_import_YYYY-MM-DD.log` - –ª–æ–≥–∏ shell —Å–∫—Ä–∏–ø—Ç–∞
- –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ –ª–æ–≥–∏ —Å–∫—Ä–∏–ø—Ç–∞ Python —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏

### –¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π:
- ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (—Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ)
- ‚ùå –û—à–∏–±–∫–∏ (–ø—Ä–æ–±–ª–µ–º—ã —Å —Ñ–∞–π–ª–æ–º, –ë–î)
- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

## –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏

1. **–ü–æ–∏—Å–∫ —Ñ–∞–π–ª–∞** - –∏—â–µ—Ç—Å—è `cost_price.xlsx` –≤ `uploads/`
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –¥–∞–Ω–Ω—ã—Ö Excel
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î** - `UPDATE dim_products SET cost_price = ? WHERE barcode = ?`
4. **–ê—Ä—Ö–∏–≤–∞—Ü–∏—è** - –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ `uploads/archive/cost_price_YYYYMMDD_HHMMSS.xlsx`
5. **–û—Ç—á–µ—Ç** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö/–Ω–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:
- Lock —Ñ–∞–π–ª –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫
- –ê—Ä—Ö–∏–≤–∞—Ü–∏—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ë–î —Å rollback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
- –ö–æ–¥—ã –≤—ã—Ö–æ–¥–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏
```python
import pandas as pd

data = {
    'barcode': ['4607034370237', '4607034370244'],
    'cost_price': [150.50, 200.00]
}

df = pd.DataFrame(data)
df.to_excel('uploads/cost_price.xlsx', index=False)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
```sql
SELECT barcode, cost_price, updated_at 
FROM dim_products 
WHERE barcode IN ('4607034370237', '4607034370244')
ORDER BY updated_at DESC;
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è —Ñ–∞–π–ª–∞: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `cost_price.xlsx`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å: —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ `uploads/`

2. **–û—à–∏–±–∫–∏ Excel**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –∫–æ–ª–æ–Ω–æ–∫ `barcode` –∏ `cost_price`
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ü–µ–Ω—ã - —á–∏—Å–ª–∞, –∞ –Ω–µ —Ç–µ–∫—Å—Ç

3. **–¢–æ–≤–∞—Ä—ã –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —à—Ç—Ä–∏—Ö–∫–æ–¥–æ–≤ –≤ `dim_products`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

4. **–ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏**
   - –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∞—Ö –Ω–∞ –∑–∞–ø–∏—Å—å –≤ `uploads/archive/`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è shell —Å–∫—Ä–∏–ø—Ç–∞

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
ls -la uploads/
ls -la uploads/archive/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
tail -f logs/cost_import_$(date +%Y-%m-%d).log

# –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫
python3 test_cost_importer.py
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω–æ–π ETL —Å–∏—Å—Ç–µ–º–æ–π

–ò–º–ø–æ—Ä—Ç —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π ETL —Å–∏—Å—Ç–µ–º—ã (`run_weekly_etl.sh`), –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏:

```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ run_weekly_etl.sh –ø–æ—Å–ª–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ ETL
run_task "$PYTHON_PATH" cost_importer.py
```

---

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ
