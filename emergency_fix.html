<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üö® –≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
      }
      .container {
        background: white;
        color: #333;
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        max-width: 600px;
        width: 100%;
        text-align: center;
      }
      h1 {
        color: #dc3545;
        margin-bottom: 30px;
      }
      .btn {
        display: inline-block;
        background: #dc3545;
        color: white;
        padding: 20px 40px;
        text-decoration: none;
        border-radius: 8px;
        margin: 10px;
        font-size: 18px;
        font-weight: bold;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .btn:hover {
        background: #c82333;
        transform: translateY(-2px);
      }
      .btn-success {
        background: #28a745;
      }
      .btn-success:hover {
        background: #218838;
      }
      .result {
        margin: 20px 0;
        padding: 15px;
        border-radius: 5px;
        text-align: left;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .loading {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      .problem {
        background: #fff3cd;
        color: #856404;
        padding: 20px;
        border-radius: 5px;
        margin: 20px 0;
        border: 1px solid #ffeaa7;
        text-align: left;
      }
      .step {
        margin: 20px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 5px;
        text-align: left;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üö® –≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–∞</h1>

      <div class="problem">
        <strong>‚ùå –ü—Ä–æ–±–ª–µ–º–∞:</strong><br />
        –î–∞—à–±–æ—Ä–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å–∫–ª–∞–¥—Å–∫–∏—Ö –æ—Å—Ç–∞—Ç–∫–∞—Ö" –∏ –æ—à–∏–±–∫–∏ —Å
        —Ç–∞–±–ª–∏—Ü–∞–º–∏
      </div>

      <div class="step">
        <h3>üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ</h3>
        <p>–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç:</p>
        <ul>
          <li>‚úÖ –î–∞–Ω–Ω—ã–µ –≤ inventory_data (13 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤)</li>
          <li>üîß –¢–∞–±–ª–∏—Ü—É replenishment_recommendations</li>
          <li>üìä –¢–µ—Å—Ç–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</li>
        </ul>

        <button class="btn" onclick="restoreData()">
          üîÑ –í–û–°–°–¢–ê–ù–û–í–ò–¢–¨ –í–°–ï –î–ê–ù–ù–´–ï
        </button>

        <div id="restore-result"></div>
      </div>

      <div class="step">
        <h3>üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</h3>
        <button class="btn" onclick="testDashboard()">
          üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞—à–±–æ—Ä–¥
        </button>
        <button
          class="btn btn-success"
          onclick="window.open('test_dashboard.html', '_blank')"
        >
          üöÄ –û—Ç–∫—Ä—ã—Ç—å –¥–∞—à–±–æ—Ä–¥
        </button>

        <div id="test-result"></div>
      </div>

      <div class="step">
        <h3>üîó –ü—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏</h3>
        <a
          href="api/inventory-analytics.php?action=dashboard"
          target="_blank"
          class="btn"
          >üìä API –¥–∞—à–±–æ—Ä–¥–∞</a
        >
        <a
          href="replenishment_adapter_fixed.php?action=recommendations"
          target="_blank"
          class="btn"
          >üí° API —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π</a
        >
      </div>
    </div>

    <script>
      async function restoreData() {
        const resultDiv = document.getElementById("restore-result");
        resultDiv.innerHTML =
          '<div class="result loading">üîÑ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ...</div>';

        try {
          const response = await fetch(
            "api/inventory-analytics.php?action=restore_data"
          );
          const data = await response.json();

          if (data.status === "success") {
            let html = '<div class="result success">';
            html += "<h4>‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!</h4>";
            html +=
              "<p>üì¶ –ó–∞–ø–∏—Å–µ–π –≤ inventory_data: <strong>" +
              data.data.inventory_records_inserted +
              "</strong></p>";
            html += "<p>üîß –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π: <strong>—Å–æ–∑–¥–∞–Ω–∞</strong></p>";
            html +=
              "<p>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –¥–æ–±–∞–≤–ª–µ–Ω–æ: <strong>" +
              data.data.recommendations_inserted +
              "</strong></p>";
            html += "</div>";
            resultDiv.innerHTML = html;
          } else {
            resultDiv.innerHTML =
              '<div class="result error">‚ùå –û—à–∏–±–∫–∞: ' + data.message + "</div>";
          }
        } catch (error) {
          resultDiv.innerHTML =
            '<div class="result error">‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' +
            error.message +
            "</div>";
        }
      }

      async function testDashboard() {
        const resultDiv = document.getElementById("test-result");
        resultDiv.innerHTML =
          '<div class="result loading">üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –¥–∞—à–±–æ—Ä–¥...</div>';

        try {
          const response = await fetch(
            "api/inventory-analytics.php?action=dashboard"
          );
          const data = await response.json();

          if (data.status === "success") {
            const stats = data.data;
            let html = '<div class="result success">';
            html += "<h4>‚úÖ –î–∞—à–±–æ—Ä–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç!</h4>";
            html +=
              "<p>üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏: <strong>" +
              (stats.critical_stock_count || 0) +
              "</strong></p>";
            html +=
              "<p>‚ö†Ô∏è –ù–∏–∑–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏: <strong>" +
              (stats.low_stock_count || 0) +
              "</strong></p>";
            html +=
              "<p>üìà –ò–∑–±—ã—Ç–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤: <strong>" +
              (stats.overstock_count || 0) +
              "</strong></p>";
            html +=
              "<p>‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ –æ—Å—Ç–∞—Ç–∫–∏: <strong>" +
              (stats.normal_count || 0) +
              "</strong></p>";
            html += "</div>";
            resultDiv.innerHTML = html;
          } else {
            resultDiv.innerHTML =
              '<div class="result error">‚ùå –î–∞—à–±–æ—Ä–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: ' +
              data.message +
              "</div>";
          }
        } catch (error) {
          resultDiv.innerHTML =
            '<div class="result error">‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ' +
            error.message +
            "</div>";
        }
      }
    </script>
  </body>
</html>
