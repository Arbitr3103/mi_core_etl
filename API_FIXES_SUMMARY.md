# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º API

## üéØ –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

### 1. –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–∞—Ä—Å–∏–Ω–≥–æ–º Ozon API

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–∫—Ä–∏–ø—Ç –ø–æ–ª—É—á–∞–ª 0 –∑–∞–ø–∏—Å–µ–π –æ—Å—Ç–∞—Ç–∫–æ–≤, —Ö–æ—Ç—è API –≤–æ–∑–≤—Ä–∞—â–∞–ª –¥–∞–Ω–Ω—ã–µ.

**–ü—Ä–∏—á–∏–Ω—ã:**

- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞: –∫–æ–¥ –æ–∂–∏–¥–∞–ª `data['result']['items']`, –Ω–æ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `data['items']`
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `last_id` –≤–º–µ—Å—Ç–æ `cursor`
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ `warehouse_name` (–≤ API –Ω–µ—Ç —ç—Ç–æ–≥–æ –ø–æ–ª—è)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞ API
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è —á–µ—Ä–µ–∑ `cursor`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ `warehouse_name` –∏–∑ —Ç–∏–ø–∞ —Å–∫–ª–∞–¥–∞ –∏ ID
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ —Å `inventory` –Ω–∞ `inventory_data`

### 2. –ü—Ä–æ–±–ª–µ–º–∞ —Å Wildberries API

**–ü—Ä–æ–±–ª–µ–º–∞:** DNS –æ—à–∏–±–∫–∞ `Name or service not known` –¥–ª—è `suppliers-api.wildberries.ru`

**–ü—Ä–∏—á–∏–Ω—ã:**

- –£—Å—Ç–∞—Ä–µ–≤—à–∏–π –¥–æ–º–µ–Ω API, –∫–æ—Ç–æ—Ä—ã–π –±–æ–ª—å—à–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ endpoints –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

- ‚úÖ –ó–∞–º–µ–Ω–µ–Ω –¥–æ–º–µ–Ω –Ω–∞ `statistics-api.wildberries.ru`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã endpoints –¥–ª—è —Å–∫–ª–∞–¥–æ–≤ –∏ –æ—Å—Ç–∞—Ç–∫–æ–≤
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–æ–≤–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç Ozon API

```
‚úÖ Ozon API —Ä–∞–±–æ—Ç–∞–µ—Ç!
   –ü–æ–ª—É—á–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: 5
   –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: 175
   –ï—Å—Ç—å cursor: True
   –ü—Ä–∏–º–µ—Ä —Ç–æ–≤–∞—Ä–∞:
     offer_id: –ô–æ–≥—É—Ä—Ç1,0
     stocks: 1
     stock type: fbo
     present: 0
     reserved: 0
```

### –¢–µ—Å—Ç Wildberries API

```
‚úÖ –ù–æ–≤—ã–π –¥–æ–º–µ–Ω statistics-api.wildberries.ru –¥–æ—Å—Ç—É–ø–µ–Ω!
   Status code: 401
   (401 - –æ–∂–∏–¥–∞–µ–º–æ, –Ω—É–∂–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API –∫–ª—é—á)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –¥–æ–º–µ–Ω–∞

```
‚úÖ –°—Ç–∞—Ä—ã–π –¥–æ–º–µ–Ω suppliers-api.wildberries.ru –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–æ–∂–∏–¥–∞–µ–º–æ)
```

## üìã –î–µ—Ç–∞–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –§–∞–π–ª: `importers/stock_importer.py`

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Ozon API:

1. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞:**

   ```python
   # –ë—ã–ª–æ:
   if not data.get('result', {}).get('items'):
   items = data['result']['items']

   # –°—Ç–∞–ª–æ:
   if not data.get('items'):
   items = data['items']
   ```

2. **–ü–∞–≥–∏–Ω–∞—Ü–∏—è:**

   ```python
   # –ë—ã–ª–æ:
   last_id = ""

   # –°—Ç–∞–ª–æ:
   cursor = ""
   if cursor:
       payload["cursor"] = cursor
   cursor = data.get('cursor', '')
   ```

3. **Warehouse name:**

   ```python
   # –ë—ã–ª–æ:
   'warehouse_name': stock.get('warehouse_name', 'Unknown'),

   # –°—Ç–∞–ª–æ:
   warehouse_name = f"Ozon-{stock.get('type', 'FBO').upper()}"
   if stock.get('warehouse_ids'):
       warehouse_name += f"-{stock['warehouse_ids'][0]}"
   ```

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Wildberries API:

1. **–î–æ–º–µ–Ω –∏ endpoints:**

   ```python
   # –ë—ã–ª–æ:
   url = "https://suppliers-api.wildberries.ru/api/v1/warehouses"
   url = f"https://suppliers-api.wildberries.ru/api/v3/stocks/{warehouse_id}"

   # –°—Ç–∞–ª–æ:
   url = "https://statistics-api.wildberries.ru/api/v1/supplier/warehouses"
   url = f"https://statistics-api.wildberries.ru/api/v1/supplier/stocks"
   ```

2. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞:**
   ```python
   # –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è API –æ—Å—Ç–∞—Ç–∫–æ–≤:
   params = {
       "dateFrom": datetime.now().strftime("%Y-%m-%d")
   }
   ```

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ë–î:

```python
# –ë—ã–ª–æ:
DELETE FROM inventory WHERE source = %s
INSERT INTO inventory (...)

# –°—Ç–∞–ª–æ:
DELETE FROM inventory_data WHERE source = %s
INSERT INTO inventory_data (..., last_sync_at)
```

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**

- ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å Python –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- ‚úÖ Ozon API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- ‚úÖ Wildberries API –¥–æ–º–µ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ö–µ–º–µ –ë–î
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**

1. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π `stock_importer.py` –Ω–∞ —Å–µ—Ä–≤–µ—Ä
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ API –∫–ª—é—á–∞–º–∏
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏ –≤ `inventory_data`
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ cron

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

- Ozon API –±—É–¥–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–ª—É—á–∞—Ç—å –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
- Wildberries API –±—É–¥–µ—Ç —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ –Ω–æ–≤–æ–º—É –¥–æ–º–µ–Ω—É
- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `inventory_data`
- –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 06 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
