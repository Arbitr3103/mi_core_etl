# –°–∏—Å—Ç–µ–º–∞ –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è PHP —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

## üéØ –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è e-commerce –ø—Ä–æ–µ–∫—Ç–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞—Å—á–µ—Ç–æ–º –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–æ–≤ –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π.

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏** (–≤—ã—Ä—É—á–∫–∞ - —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å)
- ‚úÖ **–î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞** –ø–æ —Ç–æ–≤–∞—Ä–∞–º, –¥–Ω—è–º –∏ –∫–ª–∏–µ–Ω—Ç–∞–º
- ‚úÖ **REST API** –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º
- ‚úÖ **–ì–æ—Ç–æ–≤—ã–µ PHP –∫–ª–∞—Å—Å—ã** –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ **–ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** –¥–ª—è JavaScript/jQuery

---

## üìä –¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö:
- **–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞**: 1,482,031 —Ä—É–±. (–∑–∞ 14 –¥–Ω–µ–π)
- **–û–±—â–∞—è –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å**: 59.5%
- **–¢–æ–≤–∞—Ä–æ–≤ —Å —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å—é**: 56 –∏–∑ 271 (20.7%)
- **–°—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å –≤ –¥–µ–Ω—å**: 63,015 —Ä—É–±.

### –õ—É—á—à–∏–µ —Ç–æ–≤–∞—Ä—ã –ø–æ –º–∞—Ä–∂–µ:
1. **–û–≤—Å—è–Ω—ã–µ —Ö–ª–æ–ø—å—è –ù–¢–í**: 79.7% –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å
2. **–ú—É–∫–∞ —Å–æ—Ä–≥–æ**: 77.5% –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å  
3. **–†–∞–∑—Ä—ã—Ö–ª–∏—Ç–µ–ª—å**: 75.7% –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```php
<?php
// –°–∫–æ–ø–∏—Ä—É–π—Ç–µ MarginAPI.php –≤ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
require_once 'MarginAPI.php';

// –û–±–Ω–æ–≤–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ MarginDatabase
class MarginDatabase {
    private $host = '178.72.129.61';
    private $dbname = 'mi_core_db';
    private $username = 'your_username';  // ‚Üê –ó–∞–º–µ–Ω–∏—Ç–µ
    private $password = 'your_password';  // ‚Üê –ó–∞–º–µ–Ω–∏—Ç–µ
}
?>
```

### 2. –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```php
<?php
try {
    $api = new MarginAPI();
    
    // –ü–æ–ª—É—á–∏—Ç—å –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
    $summary = $api->getSummaryMargin(date('Y-m-01'), date('Y-m-d'));
    
    echo "–ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å: " . $summary['totals']['margin_percent'] . "%\n";
    echo "–ü—Ä–∏–±—ã–ª—å: " . number_format($summary['totals']['profit'], 0) . " —Ä—É–±.\n";
    
} catch (Exception $e) {
    echo "–û—à–∏–±–∫–∞: " . $e->getMessage();
}
?>
```

### 3. REST API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

```bash
# –°–≤–æ–¥–Ω–∞—è –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å
GET /api/margins/summary?start_date=2025-09-01&end_date=2025-09-19

# –ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º  
GET /api/margins/daily?start_date=2025-09-01&end_date=2025-09-19

# –¢–æ–ø —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –º–∞—Ä–∂–µ
GET /api/margins/products/top?limit=20&min_revenue=1000

# –¢–æ–≤–∞—Ä—ã —Å –Ω–∏–∑–∫–æ–π –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é
GET /api/margins/products/low?threshold=15&min_revenue=1000

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è
GET /api/margins/coverage
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
mi_core_etl/
‚îú‚îÄ‚îÄ PHP_MARGIN_API_GUIDE.md      # –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ MarginAPI.php                # –û—Å–Ω–æ–≤–Ω–æ–π PHP –∫–ª–∞—Å—Å
‚îú‚îÄ‚îÄ api_example.php              # REST API –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
‚îú‚îÄ‚îÄ frontend_examples.js         # JavaScript –ø—Ä–∏–º–µ—Ä—ã
‚îú‚îÄ‚îÄ margin_reports.py            # Python –æ—Ç—á–µ—Ç—ã (–¥–ª—è —Å–ø—Ä–∞–≤–∫–∏)
‚îú‚îÄ‚îÄ recalculate_margins.py       # –ü–µ—Ä–µ—Å—á–µ—Ç –¥–∞–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ run_aggregation.py           # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è
```

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã API

### MarginAPI::getSummaryMargin()
–ü–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–¥–Ω—É—é –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∑–∞ –ø–µ—Ä–∏–æ–¥.

```php
$summary = $api->getSummaryMargin('2025-09-01', '2025-09-19', $clientId);

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
[
    'period' => [
        'start_date' => '2025-09-01',
        'end_date' => '2025-09-19',
        'days_count' => 19
    ],
    'totals' => [
        'orders' => 4517,
        'revenue' => 1482031.0,
        'cogs' => 599817.0,
        'profit' => 882214.0,
        'margin_percent' => 59.5
    ],
    'averages' => [
        'daily_revenue' => 105859.0,
        'daily_profit' => 63015.0
    ]
]
```

### MarginAPI::getTopProductsByMargin()
–ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–ø —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.

```php
$products = $api->getTopProductsByMargin(10, null, null, 1000);

foreach ($products as $product) {
    echo sprintf(
        "%s: %s (%.1f%%)\n",
        $product['sku_ozon'],
        $product['product_name'],
        $product['margin_percent']
    );
}
```

### MarginAPI::getLowMarginProducts()
–ù–∞—Ö–æ–¥–∏—Ç —Ç–æ–≤–∞—Ä—ã —Å –Ω–∏–∑–∫–æ–π –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é.

```php
$lowMargin = $api->getLowMarginProducts(15.0, 1000.0, 10);

if (!empty($lowMargin)) {
    echo "‚ö†Ô∏è –¢–æ–≤–∞—Ä—ã —Ç—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è:\n";
    foreach ($lowMargin as $product) {
        echo "- {$product['sku_ozon']}: {$product['margin_percent']}%\n";
    }
}
```

---

## üåê REST API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `api_example.php` –≤ –ø–∞–ø–∫—É `/api/margins.php`
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
3. –û–±–Ω–æ–≤–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CORS –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### –ü—Ä–∏–º–µ—Ä AJAX –∑–∞–ø—Ä–æ—Å–∞

```javascript
// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–æ–¥–Ω–æ–π –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
fetch('/api/margins/summary?start_date=2025-09-01&end_date=2025-09-19')
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            console.log('–ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å:', data.data.totals.margin_percent + '%');
        }
    });
```

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API

```json
{
    "success": true,
    "data": {
        "totals": {
            "revenue": 1482031.0,
            "profit": 882214.0,
            "margin_percent": 59.5
        }
    },
    "timestamp": "2025-09-19T10:25:58+00:00"
}
```

---

## üìà –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

### –ì–æ—Ç–æ–≤—ã–π –¥–∞—à–±–æ—Ä–¥ (JavaScript)

```html
<!DOCTYPE html>
<html>
<head>
    <title>–î–∞—à–±–æ—Ä–¥ –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container mt-4">
        <h1>–ê–Ω–∞–ª–∏–∑ –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏</h1>
        <div id="margin-dashboard"></div>
    </div>
    
    <script src="frontend_examples.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—à–±–æ—Ä–¥–∞
        const dashboard = new MarginDashboard('margin-dashboard');
    </script>
</body>
</html>
```

### jQuery –ø–ª–∞–≥–∏–Ω

```javascript
$('#margin-dashboard').marginDashboard({
    autoRefresh: true,
    refreshInterval: 300000 // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
});
```

---

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:

#### `metrics_daily` - –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
```sql
- metric_date: DATE           # –î–∞—Ç–∞
- revenue_sum: DECIMAL(18,4)  # –í—ã—Ä—É—á–∫–∞
- cogs_sum: DECIMAL(18,4)     # –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å  
- profit_sum: DECIMAL(18,4)   # –ü—Ä–∏–±—ã–ª—å
- orders_cnt: INT             # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤
```

#### `dim_products` - –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ç–æ–≤–∞—Ä–æ–≤
```sql
- sku_ozon: VARCHAR(255)      # –ê—Ä—Ç–∏–∫—É–ª Ozon
- sku_wb: VARCHAR(255)        # –ê—Ä—Ç–∏–∫—É–ª Wildberries
- barcode: VARCHAR(255)       # –®—Ç—Ä–∏—Ö–∫–æ–¥
- product_name: VARCHAR(500)  # –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
- cost_price: DECIMAL(10,2)   # –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å
```

#### `fact_orders` - –î–µ—Ç–∞–ª—å–Ω—ã–µ –∑–∞–∫–∞–∑—ã
```sql
- order_id: VARCHAR(255)      # ID –∑–∞–∫–∞–∑–∞
- sku: VARCHAR(255)           # –ê—Ä—Ç–∏–∫—É–ª —Ç–æ–≤–∞—Ä–∞
- qty: INT                    # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ
- price: DECIMAL(10,2)        # –¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É
- order_date: DATE            # –î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞
- transaction_type: VARCHAR   # –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏
```

---

## ‚öôÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏:
- –ù–æ–≤—ã—Ö –ø—Ä–æ–¥–∞–∂–∞—Ö (—á–µ—Ä–µ–∑ ETL –ø—Ä–æ—Ü–µ—Å—Å)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–æ–≤
- –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–π –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫ (cron: 3:00 —É—Ç—Ä–∞)

### –ü–µ—Ä–µ—Å—á–µ—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
cd /home/vladimir/mi_core_etl
python3 recalculate_margins.py
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏

```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–≥–æ –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞
scp cost_price.xlsx vladimir@178.72.129.61:/home/vladimir/mi_core_etl/data/
ssh vladimir@178.72.129.61 "cd /home/vladimir/mi_core_etl && ./run_cost_import.sh"
```

---

## üé® –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –í–∏–¥–∂–µ—Ç –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –∞–¥–º–∏–Ω–∫–∏

```php
<?php
class MarginWidget {
    private $api;
    
    public function __construct() {
        $this->api = new MarginAPI();
    }
    
    public function render() {
        $summary = $this->api->getSummaryMargin(date('Y-m-01'), date('Y-m-d'));
        $margin = $summary['totals']['margin_percent'];
        
        $color = $margin >= 50 ? 'success' : ($margin >= 30 ? 'warning' : 'danger');
        
        echo "<div class='alert alert-{$color}'>";
        echo "<h4>–ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∑–∞ –º–µ—Å—è—Ü: {$margin}%</h4>";
        echo "<p>–ü—Ä–∏–±—ã–ª—å: " . number_format($summary['totals']['profit'], 0) . " —Ä—É–±.</p>";
        echo "</div>";
    }
}
?>
```

### 2. –û—Ç—á–µ—Ç –ø–æ —Ç–æ–≤–∞—Ä–∞–º

```php
<?php
function generateProductReport() {
    $api = new MarginAPI();
    $products = $api->getTopProductsByMargin(20);
    
    echo "<table class='table'>";
    echo "<tr><th>–¢–æ–≤–∞—Ä</th><th>–í—ã—Ä—É—á–∫–∞</th><th>–ú–∞—Ä–∂–∞</th></tr>";
    
    foreach ($products as $product) {
        $marginClass = $product['margin_percent'] >= 50 ? 'text-success' : 'text-warning';
        echo "<tr>";
        echo "<td>{$product['sku_ozon']}</td>";
        echo "<td>" . number_format($product['revenue'], 0) . " —Ä—É–±.</td>";
        echo "<td class='{$marginClass}'>{$product['margin_percent']}%</td>";
        echo "</tr>";
    }
    
    echo "</table>";
}
?>
```

### 3. API –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```php
<?php
// mobile_api.php
header('Content-Type: application/json');

$api = new MarginAPI();

switch ($_GET['action']) {
    case 'summary':
        $data = $api->getSummaryMargin(date('Y-m-01'), date('Y-m-d'));
        break;
        
    case 'top_products':
        $data = $api->getTopProductsByMargin(10);
        break;
        
    default:
        $data = ['error' => 'Unknown action'];
}

echo json_encode($data, JSON_UNESCAPED_UNICODE);
?>
```

---

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å –Ω–∏–∑–∫–æ–π –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é

```php
<?php
function checkLowMarginAlerts() {
    $api = new MarginAPI();
    $lowMargin = $api->getLowMarginProducts(15.0, 1000.0, 10);
    
    if (!empty($lowMargin)) {
        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        $message = "–ù–∞–π–¥–µ–Ω–æ " . count($lowMargin) . " —Ç–æ–≤–∞—Ä–æ–≤ —Å –Ω–∏–∑–∫–æ–π –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é";
        
        // Email, Slack, Telegram –∏ —Ç.–¥.
        sendAlert($message, $lowMargin);
    }
}

// –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ cron –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
// 0 9 * * * php /path/to/check_alerts.php
?>
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–∫—Ä—ã—Ç–∏—è —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å—é

```php
<?php
function checkCoverageStatus() {
    $api = new MarginAPI();
    $coverage = $api->getCostCoverageStats();
    
    if ($coverage['coverage_percent'] < 50) {
        $message = "–ù–∏–∑–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å—é: {$coverage['coverage_percent']}%";
        sendAlert($message);
    }
}
?>
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ

### –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:
- ‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞** –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—á–µ—Ç—ã** —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ **API –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω** –∏ —Å—Ç–∞–±–∏–ª–µ–Ω
- ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** –ø–æ–ª–Ω–∞—è –∏ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è:
- üìà –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- üìä –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (ROI, ROAS)
- üéØ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã
- üì± –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—é

### –ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º ETL —Å–∏—Å—Ç–µ–º—ã

---

**–°–∏—Å—Ç–µ–º–∞ –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 19 —Å–µ–Ω—Ç—è–±—Ä—è 2025 –≥.*
