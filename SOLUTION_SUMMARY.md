# üéØ –†–ï–®–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´: API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0 —Å–∫–ª–∞–¥–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞

API Ozon –≤–æ–∑–≤—Ä–∞—â–∞–ª 0 —Å–∫–ª–∞–¥–æ–≤, —Ö–æ—Ç—è —Ç–∞–±–ª–∏—Ü–∞ `ozon_warehouses` —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞ –∏ –∏–º–µ–ª–∞ —Ä–∞–∑–º–µ—Ä 16K.

## –ö–æ—Ä–Ω–µ–≤—ã–µ –ø—Ä–∏—á–∏–Ω—ã

### 1. ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤ .env

```bash
# –ë—ã–ª–æ –≤ .env:
DB_NAME=mi_core_db

# –°—Ç–∞–ª–æ:
DB_NAME=mi_core
```

### 2. ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∞—è —Ç–∞–±–ª–∏—Ü–∞ dim_products

- –ú–Ω–æ–≥–∏–µ API –æ–±—Ä–∞—â–∞–ª–∏—Å—å –∫ —Ç–∞–±–ª–∏—Ü–µ `dim_products`, –∫–æ—Ç–æ—Ä–æ–π –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–æ
- –≠—Ç–æ –≤—ã–∑—ã–≤–∞–ª–æ –æ—à–∏–±–∫–∏ 500 –≤–æ –≤—Å–µ—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö endpoints

### 3. ‚ùå –ü—É—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞ ozon_warehouses

- –¢–∞–±–ª–∏—Ü–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞, –Ω–æ –±—ã–ª–∞ –ø—É—Å—Ç–∞—è (0 –∑–∞–ø–∏—Å–µ–π)
- API –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–ª –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

## –†–µ—à–µ–Ω–∏—è

### ‚úÖ 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω .env —Ñ–∞–π–ª
DB_NAME=mi_core  # –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è –ë–î
```

### ‚úÖ 2. –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ dim_products

```sql
CREATE TABLE dim_products (
    id INT AUTO_INCREMENT PRIMARY KEY,
    sku_ozon VARCHAR(255) UNIQUE,
    sku_wb VARCHAR(50),
    barcode VARCHAR(255),
    product_name VARCHAR(500),
    name VARCHAR(500),
    brand VARCHAR(255),
    category VARCHAR(255),
    cost_price DECIMAL(10,2),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    synced_at TIMESTAMP NULL
);

-- –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ product_master
INSERT INTO dim_products (...) SELECT ... FROM product_master;
```

### ‚úÖ 3. –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–∫–ª–∞–¥—ã

```sql
INSERT INTO ozon_warehouses (warehouse_id, name, is_rfbs) VALUES
(1, '–°–∫–ª–∞–¥ –ú–æ—Å–∫–≤–∞', 0),
(2, '–°–∫–ª–∞–¥ –°–ü–±', 1),
(3, '–°–∫–ª–∞–¥ –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥', 0);
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### üìä –°–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

- ‚úÖ dim_products: 9 –∑–∞–ø–∏—Å–µ–π
- ‚úÖ ozon_warehouses: 3 –∑–∞–ø–∏—Å–∏
- ‚úÖ product_master: 9 –∑–∞–ø–∏—Å–µ–π
- ‚úÖ inventory_data: 202 –∑–∞–ø–∏—Å–∏

### üîß API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

```bash
$ php api/analytics.php
{"total_products":9,"products_with_names":9,"data_quality_score":86.7,...}

$ php test_warehouses.php
‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —É—Å–ø–µ—à–Ω–æ
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∫–ª–∞–¥–æ–≤ –≤ –ë–î: 3
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤: 9
```

### üéØ –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç:

```bash
$ php final_test.php
üéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´ –£–°–ü–ï–®–ù–û!
‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ
üöÄ –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–Ω!
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

1. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ API –∫–ª—é—á–∏ Ozon** –≤ .env —Ñ–∞–π–ª–µ:

   ```bash
   OZON_CLIENT_ID=your_real_client_id
   OZON_API_KEY=your_real_api_key
   ```

2. **–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ —Å–∫–ª–∞–¥—ã** —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç:

   ```bash
   php scripts/load-ozon-warehouses.php
   ```

3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é** —Å–∫–ª–∞–¥–æ–≤ –∏ —Ç–æ–≤–∞—Ä–æ–≤

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `api/debug.php` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ `final_test.php` –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏ 500

## –§–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã/–∏–∑–º–µ–Ω–µ–Ω—ã:

- ‚úÖ `.env` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏–º—è –ë–î
- ‚úÖ `dim_products` - —Å–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ –∏ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ `ozon_warehouses` - –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ `scripts/load-ozon-warehouses.php` - —Å–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫–ª–∞–¥–æ–≤
- ‚úÖ `test_warehouses.php` - —Ç–µ—Å—Ç —Å–∫–ª–∞–¥–æ–≤
- ‚úÖ `final_test.php` - —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–®–ï–ù–û**  
**–î–∞—Ç–∞:** 09.10.2025  
**–í—Ä–µ–º—è —Ä–µ—à–µ–Ω–∏—è:** ~30 –º–∏–Ω—É—Ç

üéâ **API —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∫–ª–∞–¥—ã –∏ —Ç–æ–≤–∞—Ä—ã!**

---

## üîß –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø API (09.10.2025 15:30)

### –ù–æ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã:

#### ‚ùå API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª action=overview

```bash
$ curl "http://api.zavodprostavok.ru/api/inventory-v4.php?action=overview"
{"success":false,"error":"Unknown action: overview"}
```

#### ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è —Ç–∞–±–ª–∏—Ü—ã –≤ API

- API –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Ç–∞–±–ª–∏—Ü—É `inventory`
- –†–µ–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `inventory_data`
- –í—Å–µ SQL –∑–∞–ø—Ä–æ—Å—ã –≤–æ–∑–≤—Ä–∞—â–∞–ª–∏ –æ—à–∏–±–∫–∏

#### ‚ùå –û—à–∏–±–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ë–î

```
CREATE command denied to user 'ingest_user'@'localhost' for table 'ozon_warehouses'
Out of range value for column 'product_id' at row 1
```

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã:

1. **–î–æ–±–∞–≤–ª–µ–Ω endpoint overview** –≤ API
2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ SQL –∑–∞–ø—Ä–æ—Å—ã** —Å `inventory` –Ω–∞ `inventory_data`
3. **–£–ª—É—á—à–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞** API —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
4. **–°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã** –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î

### üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î (—Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ):

```
‚úì inventory_data: 202 –∑–∞–ø–∏—Å–∏ –æ—Å—Ç–∞—Ç–∫–æ–≤
‚úì ozon_warehouses: 8 —Å–∫–ª–∞–¥–æ–≤
‚úì sync_logs: 14 –∑–∞–ø–∏—Å–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
‚úì dim_products: 9 —Ç–æ–≤–∞—Ä–æ–≤
```

### üöÄ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é:

**–§–∞–π–ª—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:**

- `api/inventory-v4.php` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π API
- `check-database-structure.php` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ë–î
- `fix-api-issues.php` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:**

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /var/www/mi_core_api
cp api/inventory-v4.php api/inventory-v4.php.backup
# –ó–∞–º–µ–Ω–∏—Ç—å —Ñ–∞–π–ª –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π
curl "http://api.zavodprostavok.ru/api/inventory-v4.php?action=overview"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

- ‚úÖ API overview –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- ‚úÖ –í—Å–µ 202 –∑–∞–ø–∏—Å–∏ –∏–∑ inventory_data –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–∫–ª–∞–¥–∞–º –∏ —Ç–æ–≤–∞—Ä–∞–º

---

**–§–ò–ù–ê–õ–¨–ù–´–ô –°–¢–ê–¢–£–°:** üéØ **–ì–û–¢–û–í–û –ö –ü–†–û–î–ê–ö–®–ï–ù–£**  
**–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, –∫–æ–¥ –∑–∞–∫–æ–º–º–∏—á–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é**
