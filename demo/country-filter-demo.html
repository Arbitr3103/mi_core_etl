<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–î–µ–º–æ: –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç—Ä–∞–Ω–µ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è</title>

    <!-- Bootstrap CSS –¥–ª—è –±–∞–∑–æ–≤—ã—Ö —Å—Ç–∏–ª–µ–π -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- –°—Ç–∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä–∞ -->
    <link href="../css/country-filter.css" rel="stylesheet" />

    <style>
      body {
        background-color: #f8f9fa;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
      }

      .demo-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
      }

      .demo-section {
        background: white;
        border-radius: 0.5rem;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .demo-controls {
        background: #e9ecef;
        padding: 1rem;
        border-radius: 0.375rem;
        margin-bottom: 1rem;
      }

      .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 0.5rem;
      }

      .status-success {
        background-color: #28a745;
      }
      .status-warning {
        background-color: #ffc107;
      }
      .status-error {
        background-color: #dc3545;
      }

      .log-output {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 0.375rem;
        padding: 1rem;
        font-family: "Courier New", monospace;
        font-size: 0.85rem;
        max-height: 300px;
        overflow-y: auto;
      }

      .api-status {
        padding: 0.5rem 1rem;
        border-radius: 0.375rem;
        margin-bottom: 1rem;
      }

      .api-status.online {
        background-color: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
      }

      .api-status.offline {
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
      }

      .feature-demo {
        border-left: 4px solid #007bff;
        padding-left: 1rem;
        margin-bottom: 1rem;
      }

      .btn-demo {
        margin-right: 0.5rem;
        margin-bottom: 0.5rem;
      }
    </style>
  </head>
  <body>
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="demo-header">
      <div class="container">
        <h1 class="mb-0">üöó –î–µ–º–æ: –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç—Ä–∞–Ω–µ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è</h1>
        <p class="mb-0 mt-2">
          –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ CountryFilter
        </p>
      </div>
    </div>

    <div class="container">
      <!-- –°—Ç–∞—Ç—É—Å API -->
      <div id="api-status" class="api-status offline">
        <span class="status-indicator status-error"></span>
        <strong>–°—Ç–∞—Ç—É—Å API:</strong>
        <span id="api-status-text">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...</span>
      </div>

      <!-- –û—Å–Ω–æ–≤–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è -->
      <div class="demo-section">
        <h2>üéØ –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å</h2>
        <p>
          –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–≤—Ç–æ–º–æ–±–∏–ª—è –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä –ø–æ
          —Å—Ç—Ä–∞–Ω–µ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:
        </p>

        <div class="row">
          <!-- –§–∏–ª—å—Ç—Ä –ø–æ –º–∞—Ä–∫–µ -->
          <div class="col-md-3 mb-3">
            <label for="demo-brand" class="form-label">–ú–∞—Ä–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è:</label>
            <select id="demo-brand" class="form-select">
              <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É</option>
              <option value="1">BMW</option>
              <option value="2">Mercedes-Benz</option>
              <option value="3">Audi</option>
              <option value="4">Toyota</option>
              <option value="5">Honda</option>
            </select>
          </div>

          <!-- –§–∏–ª—å—Ç—Ä –ø–æ –º–æ–¥–µ–ª–∏ -->
          <div class="col-md-3 mb-3">
            <label for="demo-model" class="form-label"
              >–ú–æ–¥–µ–ª—å –∞–≤—Ç–æ–º–æ–±–∏–ª—è:</label
            >
            <select id="demo-model" class="form-select" disabled>
              <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É</option>
            </select>
          </div>

          <!-- –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç—Ä–∞–Ω–µ -->
          <div class="col-md-3 mb-3">
            <div id="country-filter-demo"></div>
          </div>

          <!-- –ì–æ–¥ –≤—ã–ø—É—Å–∫–∞ -->
          <div class="col-md-3 mb-3">
            <label for="demo-year" class="form-label">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞:</label>
            <select id="demo-year" class="form-select">
              <option value="">–õ—é–±–æ–π –≥–æ–¥</option>
              <option value="2023">2023</option>
              <option value="2022">2022</option>
              <option value="2021">2021</option>
              <option value="2020">2020</option>
            </select>
          </div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–±–æ—Ä–µ -->
        <div class="demo-controls">
          <h6>–¢–µ–∫—É—â–∏–π –≤—ã–±–æ—Ä:</h6>
          <div id="current-selection">
            <span class="text-muted">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã</span>
          </div>
        </div>
      </div>

      <!-- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ -->
      <div class="demo-section">
        <h2>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ API</h2>
        <p>–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ CountryFilter:</p>

        <div class="feature-demo">
          <h5>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö</h5>
          <button
            class="btn btn-primary btn-demo"
            onclick="testLoadAllCountries()"
          >
            –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Å—Ç—Ä–∞–Ω—ã
          </button>
          <button
            class="btn btn-secondary btn-demo"
            onclick="testLoadCountriesForBrand()"
          >
            –°—Ç—Ä–∞–Ω—ã –¥–ª—è BMW
          </button>
          <button
            class="btn btn-secondary btn-demo"
            onclick="testLoadCountriesForModel()"
          >
            –°—Ç—Ä–∞–Ω—ã –¥–ª—è BMW X5
          </button>
        </div>

        <div class="feature-demo">
          <h5>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–±–æ—Ä–æ–º</h5>
          <button class="btn btn-success btn-demo" onclick="testSetCountry()">
            –í—ã–±—Ä–∞—Ç—å –ì–µ—Ä–º–∞–Ω–∏—é
          </button>
          <button class="btn btn-warning btn-demo" onclick="testGetSelection()">
            –ü–æ–ª—É—á–∏—Ç—å –≤—ã–±–æ—Ä
          </button>
          <button
            class="btn btn-danger btn-demo"
            onclick="testResetSelection()"
          >
            –°–±—Ä–æ—Å–∏—Ç—å –≤—ã–±–æ—Ä
          </button>
        </div>

        <div class="feature-demo">
          <h5>–£—Ç–∏–ª–∏—Ç—ã</h5>
          <button class="btn btn-info btn-demo" onclick="testClearCache()">
            –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
          </button>
          <button
            class="btn btn-outline-secondary btn-demo"
            onclick="testGetCountries()"
          >
            –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å—Ç—Ä–∞–Ω—ã
          </button>
          <button
            class="btn btn-outline-danger btn-demo"
            onclick="testErrorHandling()"
          >
            –¢–µ—Å—Ç –æ—à–∏–±–∫–∏
          </button>
        </div>
      </div>

      <!-- –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π -->
      <div class="demo-section">
        <h2>üìã –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π</h2>
        <div class="d-flex justify-content-between align-items-center mb-2">
          <span>–°–æ–±—ã—Ç–∏—è –∏ –≤—ã–∑–æ–≤—ã API –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:</span>
          <button class="btn btn-sm btn-outline-secondary" onclick="clearLog()">
            –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥
          </button>
        </div>
        <div id="event-log" class="log-output">
          <div class="text-muted">–õ–æ–≥ —Å–æ–±—ã—Ç–∏–π –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å...</div>
        </div>
      </div>

      <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ -->
      <div class="demo-section">
        <h2>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ</h2>
        <div class="row">
          <div class="col-md-6">
            <h5>–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:</h5>
            <ul>
              <li>–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω</li>
              <li>–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</li>
              <li>–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫</li>
              <li>–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω</li>
              <li>Accessibility –ø–æ–¥–¥–µ—Ä–∂–∫–∞</li>
            </ul>
          </div>
          <div class="col-md-6">
            <h5>API Endpoints:</h5>
            <ul>
              <li><code>/api/countries.php</code></li>
              <li><code>/api/countries-by-brand.php</code></li>
              <li><code>/api/countries-by-model.php</code></li>
              <li><code>/api/products-filter.php</code></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/CountryFilter.js"></script>

    <script>
      // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
      let countryFilter;
      let eventLogElement;

      // –ú–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ (–∫–æ–≥–¥–∞ API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ)
      const mockData = {
        countries: [
          { id: 1, name: "–ì–µ—Ä–º–∞–Ω–∏—è" },
          { id: 2, name: "–Ø–ø–æ–Ω–∏—è" },
          { id: 3, name: "–°–®–ê" },
          { id: 4, name: "–Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è" },
          { id: 5, name: "–§—Ä–∞–Ω—Ü–∏—è" },
        ],
        countriesByBrand: {
          1: [{ id: 1, name: "–ì–µ—Ä–º–∞–Ω–∏—è" }], // BMW
          2: [{ id: 1, name: "–ì–µ—Ä–º–∞–Ω–∏—è" }], // Mercedes
          3: [{ id: 1, name: "–ì–µ—Ä–º–∞–Ω–∏—è" }], // Audi
          4: [{ id: 2, name: "–Ø–ø–æ–Ω–∏—è" }], // Toyota
          5: [{ id: 2, name: "–Ø–ø–æ–Ω–∏—è" }], // Honda
        },
        countriesByModel: {
          1: [{ id: 1, name: "–ì–µ—Ä–º–∞–Ω–∏—è" }], // BMW X5
          2: [{ id: 1, name: "–ì–µ—Ä–º–∞–Ω–∏—è" }], // Mercedes GLE
        },
        models: {
          1: [
            { id: 1, name: "X5" },
            { id: 2, name: "X3" },
            { id: 3, name: "3 Series" },
          ],
          2: [
            { id: 4, name: "GLE" },
            { id: 5, name: "C-Class" },
          ],
          3: [
            { id: 6, name: "Q5" },
            { id: 7, name: "A4" },
          ],
          4: [
            { id: 8, name: "Camry" },
            { id: 9, name: "RAV4" },
          ],
          5: [
            { id: 10, name: "Civic" },
            { id: 11, name: "CR-V" },
          ],
        },
      };

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      document.addEventListener("DOMContentLoaded", function () {
        eventLogElement = document.getElementById("event-log");
        initializeDemo();
        checkApiStatus();
      });

      /**
       * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ–º–æ
       */
      function initializeDemo() {
        logEvent("üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ–º–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ CountryFilter");

        // –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ —Ñ–∏–ª—å—Ç—Ä–∞
        countryFilter = new CountryFilter(
          "country-filter-demo",
          onCountryChange
        );

        // –ü—Ä–∏–≤—è–∑–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
        document
          .getElementById("demo-brand")
          .addEventListener("change", onBrandChange);
        document
          .getElementById("demo-model")
          .addEventListener("change", onModelChange);
        document
          .getElementById("demo-year")
          .addEventListener("change", onYearChange);

        logEvent("‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ");
        updateCurrentSelection();
      }

      /**
       * –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ API
       */
      async function checkApiStatus() {
        const statusElement = document.getElementById("api-status");
        const statusTextElement = document.getElementById("api-status-text");

        try {
          // –ü—ã—Ç–∞–µ–º—Å—è —Å–¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å –∫ API
          const response = await fetch("/api/countries.php");

          if (response.ok) {
            statusElement.className = "api-status online";
            statusElement.querySelector(".status-indicator").className =
              "status-indicator status-success";
            statusTextElement.textContent = "API –¥–æ—Å—Ç—É–ø–Ω–æ";
            logEvent("üåê API –¥–æ—Å—Ç—É–ø–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ");
          } else {
            throw new Error("API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ");
          }
        } catch (error) {
          statusElement.className = "api-status offline";
          statusElement.querySelector(".status-indicator").className =
            "status-indicator status-error";
          statusTextElement.textContent =
            "API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ";
          logEvent("‚ö†Ô∏è API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ");

          // –ü–æ–¥–º–µ–Ω—è–µ–º fetch –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
          setupMockFetch();
        }
      }

      /**
       * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–∫–æ–≤–æ–≥–æ fetch
       */
      function setupMockFetch() {
        const originalFetch = window.fetch;

        window.fetch = async function (url) {
          logEvent(`üì° –ú–æ–∫ –∑–∞–ø—Ä–æ—Å: ${url}`);

          // –ò–º–∏—Ç–∏—Ä—É–µ–º –∑–∞–¥–µ—Ä–∂–∫—É —Å–µ—Ç–∏
          await new Promise((resolve) => setTimeout(resolve, 300));

          if (url.includes("/api/countries.php")) {
            return {
              ok: true,
              json: () =>
                Promise.resolve({
                  success: true,
                  data: mockData.countries,
                }),
            };
          }

          if (url.includes("/api/countries-by-brand.php")) {
            const brandId = new URL(
              url,
              window.location.origin
            ).searchParams.get("brand_id");
            return {
              ok: true,
              json: () =>
                Promise.resolve({
                  success: true,
                  data: mockData.countriesByBrand[brandId] || [],
                }),
            };
          }

          if (url.includes("/api/countries-by-model.php")) {
            const modelId = new URL(
              url,
              window.location.origin
            ).searchParams.get("model_id");
            return {
              ok: true,
              json: () =>
                Promise.resolve({
                  success: true,
                  data: mockData.countriesByModel[modelId] || [],
                }),
            };
          }

          // –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π fetch
          return originalFetch.apply(this, arguments);
        };
      }

      /**
       * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω—ã
       */
      function onCountryChange(countryId) {
        logEvent(`üåç –°—Ç—Ä–∞–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∞: ${countryId || "–Ω–µ –≤—ã–±—Ä–∞–Ω–∞"}`);
        updateCurrentSelection();
      }

      /**
       * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–∞—Ä–∫–∏
       */
      function onBrandChange(event) {
        const brandId = event.target.value;
        logEvent(`üöó –ú–∞—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∞: ${brandId || "–Ω–µ –≤—ã–±—Ä–∞–Ω–∞"}`);

        // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–¥–µ–ª–∏
        updateModels(brandId);

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω—ã
        if (brandId) {
          countryFilter.loadCountriesForBrand(brandId);
        } else {
          countryFilter.loadCountries();
        }

        updateCurrentSelection();
      }

      /**
       * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–∏
       */
      function onModelChange(event) {
        const modelId = event.target.value;
        logEvent(`üîß –ú–æ–¥–µ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∞: ${modelId || "–Ω–µ –≤—ã–±—Ä–∞–Ω–∞"}`);

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω—ã –¥–ª—è –º–æ–¥–µ–ª–∏
        if (modelId) {
          countryFilter.loadCountriesForModel(modelId);
        } else {
          const brandId = document.getElementById("demo-brand").value;
          if (brandId) {
            countryFilter.loadCountriesForBrand(brandId);
          } else {
            countryFilter.loadCountries();
          }
        }

        updateCurrentSelection();
      }

      /**
       * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥–æ–¥–∞
       */
      function onYearChange(event) {
        const year = event.target.value;
        logEvent(`üìÖ –ì–æ–¥ –∏–∑–º–µ–Ω–µ–Ω: ${year || "–Ω–µ –≤—ã–±—Ä–∞–Ω"}`);
        updateCurrentSelection();
      }

      /**
       * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π
       */
      function updateModels(brandId) {
        const modelSelect = document.getElementById("demo-model");

        modelSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å</option>';

        if (brandId && mockData.models[brandId]) {
          mockData.models[brandId].forEach((model) => {
            const option = document.createElement("option");
            option.value = model.id;
            option.textContent = model.name;
            modelSelect.appendChild(option);
          });
          modelSelect.disabled = false;
        } else {
          modelSelect.innerHTML =
            '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É</option>';
          modelSelect.disabled = true;
        }
      }

      /**
       * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –≤—ã–±–æ—Ä–∞
       */
      function updateCurrentSelection() {
        const brand = document.getElementById("demo-brand");
        const model = document.getElementById("demo-model");
        const year = document.getElementById("demo-year");
        const country = countryFilter.getSelectedCountryInfo();

        const selection = [];

        if (brand.value) {
          selection.push(`–ú–∞—Ä–∫–∞: ${brand.options[brand.selectedIndex].text}`);
        }

        if (model.value) {
          selection.push(`–ú–æ–¥–µ–ª—å: ${model.options[model.selectedIndex].text}`);
        }

        if (country) {
          selection.push(`–°—Ç—Ä–∞–Ω–∞: ${country.name}`);
        }

        if (year.value) {
          selection.push(`–ì–æ–¥: ${year.value}`);
        }

        const selectionElement = document.getElementById("current-selection");
        if (selection.length > 0) {
          selectionElement.innerHTML = selection.join(" | ");
        } else {
          selectionElement.innerHTML =
            '<span class="text-muted">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã</span>';
        }
      }

      /**
       * –§—É–Ω–∫—Ü–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
       */
      async function testLoadAllCountries() {
        logEvent("üß™ –¢–µ—Å—Ç: –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω");
        const countries = await countryFilter.loadCountries();
        logEvent(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Å—Ç—Ä–∞–Ω: ${countries.length}`);
      }

      async function testLoadCountriesForBrand() {
        logEvent("üß™ –¢–µ—Å—Ç: –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω –¥–ª—è BMW");
        const countries = await countryFilter.loadCountriesForBrand(1);
        logEvent(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Å—Ç—Ä–∞–Ω –¥–ª—è BMW: ${countries.length}`);
      }

      async function testLoadCountriesForModel() {
        logEvent("üß™ –¢–µ—Å—Ç: –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω –¥–ª—è BMW X5");
        const countries = await countryFilter.loadCountriesForModel(1);
        logEvent(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Å—Ç—Ä–∞–Ω –¥–ª—è BMW X5: ${countries.length}`);
      }

      function testSetCountry() {
        logEvent("üß™ –¢–µ—Å—Ç: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç—Ä–∞–Ω—ã (–ì–µ—Ä–º–∞–Ω–∏—è)");
        countryFilter.setSelectedCountry(1);
        logEvent("‚úÖ –°—Ç—Ä–∞–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞");
        updateCurrentSelection();
      }

      function testGetSelection() {
        logEvent("üß™ –¢–µ—Å—Ç: –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω—ã");
        const countryId = countryFilter.getSelectedCountry();
        const countryInfo = countryFilter.getSelectedCountryInfo();
        logEvent(
          `‚úÖ –í—ã–±—Ä–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∞: ID=${countryId}, Info=${JSON.stringify(
            countryInfo
          )}`
        );
      }

      function testResetSelection() {
        logEvent("üß™ –¢–µ—Å—Ç: –°–±—Ä–æ—Å –≤—ã–±–æ—Ä–∞");
        countryFilter.reset();
        logEvent("‚úÖ –í—ã–±–æ—Ä —Å–±—Ä–æ—à–µ–Ω");
        updateCurrentSelection();
      }

      function testClearCache() {
        logEvent("üß™ –¢–µ—Å—Ç: –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞");
        countryFilter.clearCache();
        logEvent("‚úÖ –ö—ç—à –æ—á–∏—â–µ–Ω");
      }

      function testGetCountries() {
        logEvent("üß™ –¢–µ—Å—Ç: –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω");
        const countries = countryFilter.getCountries();
        logEvent(`‚úÖ –í—Å–µ–≥–æ —Å—Ç—Ä–∞–Ω –≤ –ø–∞–º—è—Ç–∏: ${countries.length}`);
        countries.forEach((country) => {
          logEvent(`   - ${country.name} (ID: ${country.id})`);
        });
      }

      function testErrorHandling() {
        logEvent("üß™ –¢–µ—Å—Ç: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏");
        countryFilter.showError("–¢–µ—Å—Ç–æ–≤–∞—è –æ—à–∏–±–∫–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏");
        logEvent("‚úÖ –û—à–∏–±–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∞");

        setTimeout(() => {
          countryFilter.hideError();
          logEvent("‚úÖ –û—à–∏–±–∫–∞ —Å–∫—Ä—ã—Ç–∞");
        }, 3000);
      }

      /**
       * –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
       */
      function logEvent(message) {
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = document.createElement("div");
        logEntry.innerHTML = `<span class="text-muted">[${timestamp}]</span> ${message}`;

        if (
          eventLogElement.querySelector(".text-muted") &&
          eventLogElement.children.length === 1
        ) {
          eventLogElement.innerHTML = "";
        }

        eventLogElement.appendChild(logEntry);
        eventLogElement.scrollTop = eventLogElement.scrollHeight;
      }

      /**
       * –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–∞
       */
      function clearLog() {
        eventLogElement.innerHTML =
          '<div class="text-muted">–õ–æ–≥ –æ—á–∏—â–µ–Ω...</div>';
      }
    </script>
  </body>
</html>
