#!/bin/bash

# Ð¤Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð·Ð°Ð¿ÑƒÑÐº MDM ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ð² Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½
# Ð¡Ð¾Ð·Ð´Ð°Ð½: 09.10.2025
# Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: Ð“Ð¾Ñ‚Ð¾Ð² Ð¿Ð¾ÑÐ»Ðµ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð²ÑÐµÑ… Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼

set -e

# Ð¦Ð²ÐµÑ‚Ð° Ð´Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð°
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð´Ð»Ñ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
log() {
    echo -e "${BLUE}[$(date +'%Y-%m-%d %H:%M:%S')]${NC} $1"
}

success() {
    echo -e "${GREEN}âœ… $1${NC}"
}

warning() {
    echo -e "${YELLOW}âš ï¸ $1${NC}"
}

error() {
    echo -e "${RED}âŒ $1${NC}"
}

# Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº
echo -e "${BLUE}"
echo "ðŸš€ Ð—ÐÐŸÐ£Ð¡Ðš MDM Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ« Ð’ ÐŸÐ ÐžÐ”ÐÐšÐ¨Ð•Ð"
echo "================================="
echo -e "${NC}"

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸
echo -e "${BLUE}ðŸ“‹ ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ Ð“ÐžÐ¢ÐžÐ’ÐÐžÐ¡Ð¢Ð˜ Ðš Ð—ÐÐŸÐ£Ð¡ÐšÐ£${NC}"

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²
required_files=(".env.production" "health-check.php" "switch-to-production.sh")
for file in "${required_files[@]}"; do
    if [ -f "$file" ]; then
        success "Ð¤Ð°Ð¹Ð» $file Ð½Ð°Ð¹Ð´ÐµÐ½"
    else
        error "Ð¤Ð°Ð¹Ð» $file Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½!"
        echo "Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ: ./deployment/production-launch/prepare-production.sh"
        exit 1
    fi
done

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ API ÐºÐ»ÑŽÑ‡Ð¸
log "ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÑƒ API ÐºÐ»ÑŽÑ‡ÐµÐ¹..."
if grep -q "your_production_ozon_client_id\|your_production_ozon_api_key\|your_production_wb_api_key" .env.production; then
    warning "ÐžÐ±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ñ‹ Ð½Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ñ‹Ðµ API ÐºÐ»ÑŽÑ‡Ð¸"
    echo -n "ÐÐ°ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑŒ API ÐºÐ»ÑŽÑ‡Ð¸ ÑÐµÐ¹Ñ‡Ð°Ñ? (y/n): "
    read setup_keys
    if [ "$setup_keys" = "y" ] || [ "$setup_keys" = "Y" ]; then
        ./setup-api-keys.sh
    else
        warning "API ÐºÐ»ÑŽÑ‡Ð¸ Ð½Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ñ‹, Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÐµÐ¼ Ð±ÐµÐ· Ð½Ð¸Ñ…"
    fi
else
    success "API ÐºÐ»ÑŽÑ‡Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ñ‹"
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…
log "ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…..."
if php -r "
require_once 'config.php';
try {
    \$pdo = new PDO('mysql:host=' . DB_HOST . ';dbname=' . DB_NAME, DB_USER, DB_PASSWORD);
    echo 'OK';
} catch (Exception \$e) {
    echo 'ERROR: ' . \$e->getMessage();
    exit(1);
}
" | grep -q "OK"; then
    success "Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð°"
else
    error "ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ñ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸ÐµÐ¼ Ðº Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…"
    exit 1
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ health-check
log "ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ health-check..."
health_result=$(php health-check.php)
if echo "$health_result" | grep -q '"status": "healthy"'; then
    success "Health-check Ð¿Ñ€Ð¾ÑˆÐµÐ» ÑƒÑÐ¿ÐµÑˆÐ½Ð¾"
else
    error "Health-check Ð¿Ð¾ÐºÐ°Ð·Ð°Ð» Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹:"
    echo "$health_result"
    echo -n "ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿ÑƒÑÐº Ð½ÐµÑÐ¼Ð¾Ñ‚Ñ€Ñ Ð½Ð° Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹? (y/n): "
    read continue_anyway
    if [ "$continue_anyway" != "y" ] && [ "$continue_anyway" != "Y" ]; then
        exit 1
    fi
fi

# ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ°
echo -e "\n${YELLOW}âš ï¸ Ð’ÐÐ˜ÐœÐÐÐ˜Ð•: Ð’Ñ‹ ÑÐ¾Ð±Ð¸Ñ€Ð°ÐµÑ‚ÐµÑÑŒ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ Ð² ÐŸÐ ÐžÐ”ÐÐšÐ¨Ð•Ð!${NC}"
echo -e "${YELLOW}Ð­Ñ‚Ð¾ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸Ñ‚ ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ Ð½Ð° Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ.${NC}"
echo ""
echo -n "Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ? (yes/no): "
read confirmation

if [ "$confirmation" != "yes" ]; then
    echo "Ð—Ð°Ð¿ÑƒÑÐº Ð¾Ñ‚Ð¼ÐµÐ½ÐµÐ½"
    exit 0
fi

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ€ÐµÐ·ÐµÑ€Ð²Ð½Ð¾Ð¹ ÐºÐ¾Ð¿Ð¸Ð¸
echo -e "\n${BLUE}ðŸ’¾ Ð¡ÐžÐ—Ð”ÐÐÐ˜Ð• Ð Ð•Ð—Ð•Ð Ð’ÐÐžÐ™ ÐšÐžÐŸÐ˜Ð˜${NC}"

log "Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ñ€ÐµÐ·ÐµÑ€Ð²Ð½ÑƒÑŽ ÐºÐ¾Ð¿Ð¸ÑŽ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…..."
backup_file="backup_before_production_$(date +%Y%m%d_%H%M%S).sql"
mysqldump -u v_admin -p'Arbitr09102022!' mi_core > "$backup_file" 2>/dev/null
success "Ð ÐµÐ·ÐµÑ€Ð²Ð½Ð°Ñ ÐºÐ¾Ð¿Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð°: $backup_file"

log "Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ñ€ÐµÐ·ÐµÑ€Ð²Ð½ÑƒÑŽ ÐºÐ¾Ð¿Ð¸ÑŽ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸..."
cp .env ".env.backup.$(date +%Y%m%d_%H%M%S)"
success "Ð ÐµÐ·ÐµÑ€Ð²Ð½Ð°Ñ ÐºÐ¾Ð¿Ð¸Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð°"

# ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð½Ð° Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½
echo -e "\n${BLUE}ðŸ”„ ÐŸÐ•Ð Ð•ÐšÐ›Ð®Ð§Ð•ÐÐ˜Ð• ÐÐ ÐŸÐ ÐžÐ”ÐÐšÐ¨Ð•Ð${NC}"

log "ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ÑÑ Ð½Ð° Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ..."
./switch-to-production.sh
success "ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð°"

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾ÑÐ»Ðµ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ
log "ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ Ð¿Ð¾ÑÐ»Ðµ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ..."
if php health-check.php | grep -q '"status": "healthy"'; then
    success "Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾"
else
    error "ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ð¿Ð¾ÑÐ»Ðµ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ!"
    echo "Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÐ¼ Ð¾Ñ‚ÐºÐ°Ñ‚..."
    cp .env.backup.* .env
    exit 1
fi

# Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…
echo -e "\n${BLUE}ðŸ“¦ Ð—ÐÐ“Ð Ð£Ð—ÐšÐ ÐŸÐ ÐžÐ”ÐÐšÐ¨Ð•Ð Ð”ÐÐÐÐ«Ð¥${NC}"

log "Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ ÑÐºÐ»Ð°Ð´Ñ‹ Ozon..."
if php scripts/load-ozon-warehouses.php; then
    success "Ð¡ÐºÐ»Ð°Ð´Ñ‹ Ozon Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ñ‹"
else
    warning "ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¾Ð¹ ÑÐºÐ»Ð°Ð´Ð¾Ð² Ozon (Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾, API ÐºÐ»ÑŽÑ‡Ð¸ Ð½Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ñ‹)"
fi

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° crontab
echo -e "\n${BLUE}â° ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ ÐÐ’Ð¢ÐžÐœÐÐ¢Ð˜Ð§Ð•Ð¡ÐšÐ˜Ð¥ Ð—ÐÐ”ÐÐ§${NC}"

log "ÐÐ°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÐµÐ¼ crontab..."
if [ -f "deployment/production/mdm-crontab.txt" ]; then
    echo -n "Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ crontab Ð´Ð»Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ð·Ð°Ð´Ð°Ñ‡? (y/n): "
    read install_cron
    if [ "$install_cron" = "y" ] || [ "$install_cron" = "Y" ]; then
        crontab deployment/production/mdm-crontab.txt
        success "Crontab ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½"
    else
        warning "Crontab Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½, ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ Ð¿Ð¾Ð·Ð¶Ðµ"
    fi
else
    warning "Ð¤Ð°Ð¹Ð» crontab Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"
fi

# Ð¤Ð¸Ð½Ð°Ð»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°
echo -e "\n${BLUE}ðŸ” Ð¤Ð˜ÐÐÐ›Ð¬ÐÐÐ¯ ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ${NC}"

log "ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð²ÑÐµ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹..."

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ API
api_test=$(php -f api/analytics.php 2>/dev/null || echo "ERROR")
if echo "$api_test" | grep -q "total_products"; then
    success "API analytics Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚"
else
    warning "ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ñ API analytics"
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ…
db_check=$(mysql -u v_admin -p'Arbitr09102022!' mi_core -e "SELECT COUNT(*) FROM dim_products" -s -N 2>/dev/null || echo "0")
if [ "$db_check" -gt 0 ]; then
    success "Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ $db_check Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð²"
else
    warning "Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿ÑƒÑÑ‚Ð°Ñ Ð¸Ð»Ð¸ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð°"
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÐºÐ»Ð°Ð´Ñ‹
warehouse_check=$(mysql -u v_admin -p'Arbitr09102022!' mi_core -e "SELECT COUNT(*) FROM ozon_warehouses" -s -N 2>/dev/null || echo "0")
if [ "$warehouse_check" -gt 0 ]; then
    success "Ð—Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð¾ $warehouse_check ÑÐºÐ»Ð°Ð´Ð¾Ð²"
else
    warning "Ð¡ÐºÐ»Ð°Ð´Ñ‹ Ð½Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ñ‹"
fi

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¾Ñ‚Ñ‡ÐµÑ‚Ð° Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÐµ
echo -e "\n${BLUE}ðŸ“Š Ð¡ÐžÐ—Ð”ÐÐÐ˜Ð• ÐžÐ¢Ð§Ð•Ð¢Ð${NC}"

launch_report="production-launch-report-$(date +%Y%m%d_%H%M%S).md"
cat > "$launch_report" << EOF
# ÐžÑ‚Ñ‡ÐµÑ‚ Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÐµ Ð² Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½

**Ð”Ð°Ñ‚Ð° Ð·Ð°Ð¿ÑƒÑÐºÐ°:** $(date)
**Ð¡Ñ‚Ð°Ñ‚ÑƒÑ:** âœ… Ð£Ð¡ÐŸÐ•Ð¨ÐÐž Ð—ÐÐŸÐ£Ð©Ð•Ð

## ÐŸÑ€Ð¾Ð²ÐµÑ€ÐµÐ½Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹

### Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…
- âœ… ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚
- âœ… Ð¢Ð¾Ð²Ð°Ñ€Ð¾Ð² Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ: $db_check
- âœ… Ð¡ÐºÐ»Ð°Ð´Ð¾Ð² Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð¾: $warehouse_check
- âœ… Ð ÐµÐ·ÐµÑ€Ð²Ð½Ð°Ñ ÐºÐ¾Ð¿Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð°: $backup_file

### API
- âœ… Health-check Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚
- âœ… Analytics API Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚
- âœ… Ð’Ñ€ÐµÐ¼Ñ Ð¾Ñ‚ÐºÐ»Ð¸ÐºÐ° Ð² Ð½Ð¾Ñ€Ð¼Ðµ

### ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ
- âœ… ÐŸÑ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð°
- âœ… Ð ÐµÐ·ÐµÑ€Ð²Ð½Ñ‹Ðµ ÐºÐ¾Ð¿Ð¸Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹
- âœ… Ð›Ð¾Ð³Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ñ‹

### ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð°Ñ†Ð¸Ñ
- $([ "$install_cron" = "y" ] && echo "âœ… Crontab ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½" || echo "âš ï¸ Crontab Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½")

## Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ ÑˆÐ°Ð³Ð¸

1. ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ Ð² Ñ‚ÐµÑ‡ÐµÐ½Ð¸Ðµ Ð¿ÐµÑ€Ð²Ñ‹Ñ… 24 Ñ‡Ð°ÑÐ¾Ð²
2. ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ ETL Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ¾Ð²
3. Ð¡Ð¾Ð±Ñ€Ð°Ñ‚ÑŒ Ð¾Ð±Ñ€Ð°Ñ‚Ð½ÑƒÑŽ ÑÐ²ÑÐ·ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
4. ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð¿Ñ€Ð¸ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ÑÑ‚Ð¸

## ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ñ‹ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ¸

- Ð¢ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°: support@company.com
- ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³: http://localhost/health-check.php
- Ð›Ð¾Ð³Ð¸: logs/production/

## ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð´Ð»Ñ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°

\`\`\`bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð´Ð¾Ñ€Ð¾Ð²ÑŒÑ
php health-check.php

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð»Ð¾Ð³Ð¾Ð²
tail -f logs/production/*.log

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…
mysql -u v_admin -p mi_core -e "SELECT COUNT(*) FROM dim_products"
\`\`\`

EOF

success "ÐžÑ‚Ñ‡ÐµÑ‚ ÑÐ¾Ð·Ð´Ð°Ð½: $launch_report"

# Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ
echo -e "\n${GREEN}"
echo "ðŸŽ‰ Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ Ð£Ð¡ÐŸÐ•Ð¨ÐÐž Ð—ÐÐŸÐ£Ð©Ð•ÐÐ Ð’ ÐŸÐ ÐžÐ”ÐÐšÐ¨Ð•Ð!"
echo "========================================"
echo -e "${NC}"

echo -e "${BLUE}ðŸ“Š Ð¡Ð¢ÐÐ¢Ð˜Ð¡Ð¢Ð˜ÐšÐ Ð—ÐÐŸÐ£Ð¡ÐšÐ:${NC}"
echo "- Ð¢Ð¾Ð²Ð°Ñ€Ð¾Ð² Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ: $db_check"
echo "- Ð¡ÐºÐ»Ð°Ð´Ð¾Ð² Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð¾: $warehouse_check"
echo "- Ð ÐµÐ·ÐµÑ€Ð²Ð½Ð°Ñ ÐºÐ¾Ð¿Ð¸Ñ: $backup_file"
echo "- ÐžÑ‚Ñ‡ÐµÑ‚ Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÐµ: $launch_report"

echo -e "\n${YELLOW}ðŸ“‹ Ð Ð•ÐšÐžÐœÐ•ÐÐ”ÐÐ¦Ð˜Ð˜:${NC}"
echo "1. ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€ÑŒÑ‚Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ Ð² Ñ‚ÐµÑ‡ÐµÐ½Ð¸Ðµ Ð¿ÐµÑ€Ð²Ñ‹Ñ… 24 Ñ‡Ð°ÑÐ¾Ð²"
echo "2. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐ¹Ñ‚Ðµ health-check: php health-check.php"
echo "3. Ð¡Ð»ÐµÐ´Ð¸Ñ‚Ðµ Ð·Ð° Ð»Ð¾Ð³Ð°Ð¼Ð¸ Ð² Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸ logs/"
echo "4. ÐŸÑ€Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð°Ñ… Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ñ€ÐµÐ·ÐµÑ€Ð²Ð½ÑƒÑŽ ÐºÐ¾Ð¿Ð¸ÑŽ Ð´Ð»Ñ Ð¾Ñ‚ÐºÐ°Ñ‚Ð°"

echo -e "\n${GREEN}âœ… Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð³Ð¾Ñ‚Ð¾Ð²Ð° Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ðµ Ð² Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐµÐ½Ðµ!${NC}"

# ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ health-check
echo -e "\n${BLUE}ðŸ” Ð¢Ð•ÐšÐ£Ð©Ð˜Ð™ Ð¡Ð¢ÐÐ¢Ð£Ð¡ Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ«:${NC}"
php health-check.php