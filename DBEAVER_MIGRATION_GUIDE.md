# üóÑÔ∏è –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ DBeaver

## –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

1. **–û—Ç–∫—Ä–æ–π—Ç–µ DBeaver**
2. **–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω–æ):
   - –ù–∞–∂–º–∏—Ç–µ `Database` ‚Üí `New Database Connection`
   - –í—ã–±–µ—Ä–∏—Ç–µ `MySQL`
   - –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
     - **Server Host**: `127.0.0.1` (–∏–ª–∏ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞)
     - **Port**: `3306`
     - **Database**: `mi_core_db`
     - **Username**: `mi_core_user`
     - **Password**: `secure_password_123`
   - –ù–∞–∂–º–∏—Ç–µ `Test Connection` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
   - –ù–∞–∂–º–∏—Ç–µ `Finish`

## –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã

1. **–ù–∞–π–¥–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É** `ozon_funnel_data` –≤ –¥–µ—Ä–µ–≤–µ –æ–±—ä–µ–∫—Ç–æ–≤
2. **–©–µ–ª–∫–Ω–∏—Ç–µ –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π** ‚Üí `View Data`
3. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É** `Properties` –∏–ª–∏ `DDL`
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ**, –µ—Å—Ç—å –ª–∏ —É–∂–µ –ø–æ–ª–µ `revenue` –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Ç–∞–±–ª–∏—Ü—ã

## –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç A: –í—ã–ø–æ–ª–Ω–∏—Ç—å –≥–æ—Ç–æ–≤—ã–π SQL —Ñ–∞–π–ª

1. **–û—Ç–∫—Ä–æ–π—Ç–µ SQL —Ä–µ–¥–∞–∫—Ç–æ—Ä**: `SQL Editor` ‚Üí `New SQL Script`
2. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ** —Ñ–∞–π–ª–∞ `migrations/add_revenue_to_funnel_data.sql`:

```sql
-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è revenue –≤ —Ç–∞–±–ª–∏—Ü—É ozon_funnel_data
-- –≠—Ç–æ –ø–æ–ª–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –≤—ã—Ä—É—á–∫–µ –∏–∑ Ozon API

-- –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ –ø–æ–ª–µ revenue
SET @column_exists = (
    SELECT COUNT(*)
    FROM information_schema.columns
    WHERE table_schema = DATABASE()
      AND table_name = 'ozon_funnel_data'
      AND column_name = 'revenue'
);

-- –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–µ revenue —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
SET @sql = IF(@column_exists = 0,
    'ALTER TABLE ozon_funnel_data ADD COLUMN revenue DECIMAL(15,2) DEFAULT 0.00 COMMENT "Revenue from Ozon API" AFTER orders',
    'SELECT "–ü–æ–ª–µ revenue —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ ozon_funnel_data" as message'
);

PREPARE stmt FROM @sql;
EXECUTE stmt;
DEALLOCATE PREPARE stmt;

-- –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
SELECT
    CASE
        WHEN @column_exists = 0 THEN '‚úÖ –ü–æ–ª–µ revenue —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü—É ozon_funnel_data'
        ELSE '‚ÑπÔ∏è –ü–æ–ª–µ revenue —É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–æ –≤ —Ç–∞–±–ª–∏—Ü–µ ozon_funnel_data'
    END as result;

-- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã
SELECT
    column_name,
    data_type,
    is_nullable,
    column_default,
    column_comment
FROM information_schema.columns
WHERE table_schema = DATABASE()
  AND table_name = 'ozon_funnel_data'
ORDER BY ordinal_position;
```

3. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç**: –Ω–∞–∂–º–∏—Ç–µ `Ctrl+Enter` –∏–ª–∏ –∫–Ω–æ–ø–∫—É `Execute SQL Script`

### –í–∞—Ä–∏–∞–Ω—Ç B: –ü—Ä–æ—Å—Ç–∞—è –∫–æ–º–∞–Ω–¥–∞ ALTER TABLE

–ï—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Å—Ç—É—é –∫–æ–º–∞–Ω–¥—É:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—ã–π SQL —Ä–µ–¥–∞–∫—Ç–æ—Ä**
2. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É**:

```sql
-- –ü—Ä–æ—Å—Ç–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è revenue
ALTER TABLE ozon_funnel_data
ADD COLUMN revenue DECIMAL(15,2) DEFAULT 0.00 COMMENT 'Revenue from Ozon API'
AFTER orders;
```

3. **–ù–∞–∂–º–∏—Ç–µ** `Ctrl+Enter` –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

## –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

1. **–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã**:

   - –©–µ–ª–∫–Ω–∏—Ç–µ –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ `ozon_funnel_data`
   - –í—ã–±–µ—Ä–∏—Ç–µ `Refresh`

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã**:

   ```sql
   DESCRIBE ozon_funnel_data;
   ```

3. **–£–±–µ–¥–∏—Ç–µ—Å—å**, —á—Ç–æ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –µ—Å—Ç—å —Å—Ç—Ä–æ–∫–∞:
   ```
   | revenue | decimal(15,2) | YES  |     | 0.00 | Revenue from Ozon API |
   ```

## –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å**:

```sql
-- –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª–µ revenue —Ä–∞–±–æ—Ç–∞–µ—Ç
SELECT
    id,
    product_id,
    views,
    orders,
    revenue,
    cached_at
FROM ozon_funnel_data
LIMIT 5;
```

## üö® –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –û—à–∏–±–∫–∞ "Column already exists"

```
ERROR 1060 (42S21): Duplicate column name 'revenue'
```

**–†–µ—à–µ–Ω–∏–µ**: –ü–æ–ª–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –Ω—É–∂–Ω–∞.

### –û—à–∏–±–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

```
ERROR 1142 (42000): ALTER command denied
```

**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `mi_core_user` –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ `ALTER` –Ω–∞ —Ç–∞–±–ª–∏—Ü—É.

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```
Communications link failure
```

**–†–µ—à–µ–Ω–∏–µ**:

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ MySQL —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## üìã –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏:

1. ‚úÖ –ü–æ–ª–µ `revenue` –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü—É `ozon_funnel_data`
2. ‚úÖ –¢–∏–ø –ø–æ–ª—è: `DECIMAL(15,2)`
3. ‚úÖ –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `0.00`
4. ‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: "Revenue from Ozon API"

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –¥–∞—à–±–æ—Ä–¥ - –æ–Ω –¥–æ–ª–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å –≤—ã—Ä—É—á–∫–æ–π!
