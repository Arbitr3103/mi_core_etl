"""
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è ETL —Å–∏—Å—Ç–µ–º—ã mi_core_etl.

–°–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤ –∏ –¥—Ä—É–≥–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
–í—Å–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ .env —Ñ–∞–π–ª–∞.

–ê–≤—Ç–æ—Ä: ETL System
–î–∞—Ç–∞: 20 —Å–µ–Ω—Ç—è–±—Ä—è 2025
"""

import os
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env —Ñ–∞–π–ª–∞
load_dotenv()

# ===================================================================
# –ù–ê–°–¢–†–û–ô–ö–ò API OZON
# ===================================================================
# –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ .env —Ñ–∞–π–ª–∞
OZON_CLIENT_ID = os.getenv('OZON_CLIENT_ID')
OZON_API_KEY = os.getenv('OZON_API_KEY')

# –ë–∞–∑–æ–≤—ã–π URL –¥–ª—è API Ozon (–ò–°–ü–†–ê–í–õ–ï–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL)
OZON_API_BASE_URL = "https://api-seller.ozon.ru"

# ===================================================================
# –ù–ê–°–¢–†–û–ô–ö–ò API WILDBERRIES
# ===================================================================
# –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ .env —Ñ–∞–π–ª–∞ (–ò–°–ü–†–ê–í–õ–ï–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π)
WB_API_TOKEN = os.getenv('WB_API_KEY')

# –ë–∞–∑–æ–≤—ã–µ URL –¥–ª—è API Wildberries
WB_SUPPLIERS_API_URL = "https://suppliers-api.wildberries.ru"
WB_CONTENT_API_URL = "https://content-api.wildberries.ru"
WB_STATISTICS_API_URL = "https://statistics-api.wildberries.ru"

# ===================================================================
# –ù–ê–°–¢–†–û–ô–ö–ò –ë–ê–ó–´ –î–ê–ù–ù–´–•
# ===================================================================
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MySQL (–∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ .env –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
DB_HOST = os.getenv('DB_HOST', 'localhost')
DB_USER = os.getenv('DB_USER')
DB_PASSWORD = os.getenv('DB_PASSWORD')
DB_NAME = os.getenv('DB_NAME', 'mi_core_db')
DB_PORT = int(os.getenv('DB_PORT', '3306'))

# ===================================================================
# –ù–ê–°–¢–†–û–ô–ö–ò –°–ò–°–¢–ï–ú–´ –£–ü–†–ê–í–õ–ï–ù–ò–Ø –°–ö–õ–ê–î–û–ú
# ===================================================================
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤
INVENTORY_UPDATE_INTERVAL_HOURS = 24  # –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤ (–≤ —á–∞—Å–∞—Ö)
MOVEMENTS_UPDATE_INTERVAL_HOURS = 2   # –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏–π (–≤ —á–∞—Å–∞—Ö)

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏
TURNOVER_ANALYSIS_DAYS = 30          # –ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ–º–æ—Å—Ç–∏ (–≤ –¥–Ω—è—Ö)
MIN_STOCK_DAYS = 7                   # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑–∞–ø–∞—Å –≤ –¥–Ω—è—Ö
REORDER_POINT_MULTIPLIER = 1.5       # –ú–Ω–æ–∂–∏—Ç–µ–ª—å –¥–ª—è —Ç–æ—á–∫–∏ –∑–∞–∫–∞–∑–∞

# ===================================================================
# –ù–ê–°–¢–†–û–ô–ö–ò –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø
# ===================================================================
LOG_LEVEL = "INFO"
LOG_FORMAT = "%(asctime)s - %(levelname)s - %(message)s"
LOG_DIR = "logs"

# ===================================================================
# –ù–ê–°–¢–†–û–ô–ö–ò API –ó–ê–ü–†–û–°–û–í
# ===================================================================
# –ó–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
OZON_REQUEST_DELAY = 0.1
WB_REQUEST_DELAY = 0.5

# –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
REQUEST_TIMEOUT = 30

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
MAX_RETRIES = 3

# ===================================================================
# –ù–ê–°–¢–†–û–ô–ö–ò –£–í–ï–î–û–ú–õ–ï–ù–ò–ô
# ===================================================================
# Email –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
EMAIL_ENABLED = False
SMTP_SERVER = "smtp.gmail.com"
SMTP_PORT = 587
EMAIL_USER = "your_email@gmail.com"
EMAIL_PASSWORD = "your_email_password"
NOTIFICATION_RECIPIENTS = ["admin@yourcompany.com"]

# Telegram –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
TELEGRAM_ENABLED = False
TELEGRAM_BOT_TOKEN = "your_telegram_bot_token"
TELEGRAM_CHAT_ID = "your_telegram_chat_id"

# ===================================================================
# –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò
# ===================================================================
# –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–æ–Ω–∞
TIMEZONE = "Europe/Moscow"

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤
TEMP_DIR = "/tmp/mi_core_etl"
ARCHIVE_DIR = "archive"

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
BACKUP_ENABLED = True
BACKUP_RETENTION_DAYS = 30

# ===================================================================
# –ò–ù–°–¢–†–£–ö–¶–ò–ò –ü–û –ù–ê–°–¢–†–û–ô–ö–ï
# ===================================================================
"""
–ò–ù–°–¢–†–£–ö–¶–ò–ò –ü–û –ù–ê–°–¢–†–û–ô–ö–ï .env –§–ê–ô–õ–ê:

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (–µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç)

2. –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ .env —Ñ–∞–π–ª:

# API –∫–ª—é—á–∏ Ozon
OZON_CLIENT_ID=your_ozon_client_id_here
OZON_API_KEY=your_ozon_api_key_here

# API –∫–ª—é—á Wildberries (JWT —Ç–æ–∫–µ–Ω)
WB_API_KEY=your_wb_api_key_here

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –æ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö)
DB_HOST=localhost
DB_USER=your_db_user
DB_PASSWORD=your_db_password
DB_NAME=mi_core_db
DB_PORT=3306

3. –ü–û–õ–£–ß–ï–ù–ò–ï API –ö–õ–Æ–ß–ï–ô:

OZON API:
   - –í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç Ozon Seller
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" -> "API –∫–ª—é—á–∏"
   - –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π API –∫–ª—é—á —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ Client-Id –∏ Api-Key –≤ .env —Ñ–∞–π–ª

WILDBERRIES API:
   - –í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç WB
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" -> "–î–æ—Å—Ç—É–ø –∫ API"
   - –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω —Å –ø—Ä–∞–≤–∞–º–∏:
     * –ö–æ–Ω—Ç–µ–Ω—Ç (—á—Ç–µ–Ω–∏–µ)
     * –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—á—Ç–µ–Ω–∏–µ)
     * –ü–æ—Å—Ç–∞–≤–∫–∏ (—á—Ç–µ–Ω–∏–µ)
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω –≤ .env —Ñ–∞–π–ª

4. –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨:
   - .env —Ñ–∞–π–ª —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ .gitignore
   - –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ API –∫–ª—é—á–∏ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º
   - –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∫–ª—é—á–∏
   - –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ .env —Ñ–∞–π–ª –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

5. –ü–†–û–í–ï–†–ö–ê –ù–ê–°–¢–†–û–ï–ö:
   - –ó–∞–ø—É—Å—Ç–∏—Ç–µ: python3 test_inventory_system.py
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ API –∫–ª—é—á–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
"""

# ===================================================================
# –§–£–ù–ö–¶–ò–ò –ü–†–û–í–ï–†–ö–ò –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò
# ===================================================================

def validate_config():
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫ –∏–ª–∏ –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –µ—Å–ª–∏ –≤—Å–µ –≤ –ø–æ—Ä—è–¥–∫–µ.
    """
    errors = []
    warnings = []
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ API –∫–ª—é—á–∏ Ozon
    if not OZON_CLIENT_ID:
        errors.append("OZON_CLIENT_ID –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env —Ñ–∞–π–ª–µ")
    elif len(OZON_CLIENT_ID) < 3:
        errors.append("OZON_CLIENT_ID —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π")
    
    if not OZON_API_KEY:
        errors.append("OZON_API_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env —Ñ–∞–π–ª–µ")
    elif len(OZON_API_KEY) < 30:
        errors.append("OZON_API_KEY —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ~36 —Å–∏–º–≤–æ–ª–æ–≤)")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º WB API —Ç–æ–∫–µ–Ω (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
    if not WB_API_TOKEN:
        warnings.append("WB_API_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env —Ñ–∞–π–ª–µ (Wildberries API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)")
    elif len(WB_API_TOKEN) < 50:
        warnings.append("WB_API_KEY –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º (—Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π)")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î
    if not DB_USER:
        errors.append("DB_USER –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env —Ñ–∞–π–ª–µ")
    
    if not DB_PASSWORD:
        errors.append("DB_PASSWORD –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env —Ñ–∞–π–ª–µ")
    
    return errors, warnings

def print_config_status():
    """–í—ã–≤–æ–¥–∏—Ç —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏."""
    print("üìã –°–¢–ê–¢–£–° –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò:")
    print("=" * 40)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º API –∫–ª—é—á–∏ (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –¥–ª–∏–Ω—É –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
    print(f"OZON_CLIENT_ID: {'‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω' if OZON_CLIENT_ID else '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'} ({len(OZON_CLIENT_ID or '')} —Å–∏–º–≤–æ–ª–æ–≤)")
    print(f"OZON_API_KEY: {'‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω' if OZON_API_KEY else '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'} ({len(OZON_API_KEY or '')} —Å–∏–º–≤–æ–ª–æ–≤)")
    print(f"WB_API_TOKEN: {'‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω' if WB_API_TOKEN else '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'} ({len(WB_API_TOKEN or '')} —Å–∏–º–≤–æ–ª–æ–≤)")
    
    print(f"DB_HOST: {DB_HOST}")
    print(f"DB_NAME: {DB_NAME}")
    print(f"DB_USER: {'‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω' if DB_USER else '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}")
    print(f"DB_PASSWORD: {'‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω' if DB_PASSWORD else '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}")
    
    errors, warnings = validate_config()
    
    if warnings:
        print("\n‚ö†Ô∏è –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–Ø:")
        for warning in warnings:
            print(f"  - {warning}")
    
    if errors:
        print("\n‚ùå –û–®–ò–ë–ö–ò –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò:")
        for error in errors:
            print(f"  - {error}")
    else:
        print("\n‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞!")
        
    # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–∞–∑–æ–≤—ã—Ö URL
    print(f"\nüåê API ENDPOINTS:")
    print(f"Ozon API: {OZON_API_BASE_URL}")
    print(f"WB Suppliers API: {WB_SUPPLIERS_API_URL}")
    print(f"WB Statistics API: {WB_STATISTICS_API_URL}")

if __name__ == "__main__":
    print_config_status()
