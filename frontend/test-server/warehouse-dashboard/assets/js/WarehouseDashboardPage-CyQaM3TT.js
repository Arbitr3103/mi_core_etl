import{R as N,r as m,j as e,d as O,e as S,f as $}from"./react-vendor-Dm4r2cAM.js";import{B as M,L as T,E as z}from"./ui-CRQylcxt.js";import"./vendor-CqFCj2_q.js";const I=N.memo(({status:s,daysOfStock:t})=>{const r={critical:"bg-red-100 text-red-800 border-red-300",low:"bg-yellow-100 text-yellow-800 border-yellow-300",normal:"bg-green-100 text-green-800 border-green-300",excess:"bg-blue-100 text-blue-800 border-blue-300"},l={critical:"–î–µ—Ñ–∏—Ü–∏—Ç",low:"–ù–∏–∑–∫–∏–π",normal:"–ù–æ—Ä–º–∞",excess:"–ò–∑–±—ã—Ç–æ–∫"},n=m.useMemo(()=>t===null?"‚àû":`${Math.round(t)} –¥–Ω.`,[t]);return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${r[s]}`,children:[l[s],t!==null&&e.jsxs("span",{className:"ml-1 font-semibold",children:["(",n,")"]})]})}),W=N.memo(({need:s,targetStock:t})=>{const r=m.useMemo(()=>(t>0?s/t*100:0)>50,[s,t]);if(s<=0)return e.jsxs("span",{className:"inline-flex items-center text-green-600 font-medium",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ"]});const l=m.useMemo(()=>s.toLocaleString("ru-RU"),[s]);return e.jsxs("div",{className:`inline-flex items-center font-semibold ${r?"text-red-600":"text-orange-600"}`,children:[e.jsxs("span",{children:[l," —à—Ç."]}),r&&e.jsx("span",{className:"ml-1",title:"–°—Ä–æ—á–Ω–æ! –ë–æ–ª–µ–µ 50% –æ—Ç —Ü–µ–ª–µ–≤–æ–≥–æ –∑–∞–ø–∞—Å–∞",children:"üî•"})]})}),A=N.memo(({item:s,children:t})=>{const[r,l]=m.useState(!1),n=m.useMemo(()=>[{label:"–î–æ—Å—Ç—É–ø–Ω–æ –∫ –ø—Ä–æ–¥–∞–∂–µ",value:s.available,color:"text-gray-700"},{label:"–ì–æ—Ç–æ–≤–∏–º –∫ –ø—Ä–æ–¥–∞–∂–µ",value:s.preparing_for_sale,color:"text-blue-600"},{label:"–í –∑–∞—è–≤–∫–∞—Ö –Ω–∞ –ø–æ—Å—Ç–∞–≤–∫—É",value:s.in_supply_requests,color:"text-purple-600"},{label:"–í –ø–æ—Å—Ç–∞–≤–∫–∞—Ö –≤ –ø—É—Ç–∏",value:s.in_transit,color:"text-indigo-600"},{label:"–ü—Ä–æ—Ö–æ–¥—è—Ç –ø—Ä–æ–≤–µ—Ä–∫—É",value:s.in_inspection,color:"text-yellow-600"},{label:"–í–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –æ—Ç –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π",value:s.returning_from_customers,color:"text-orange-600"},{label:"–ò—Å—Ç–µ–∫–∞–µ—Ç —Å—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏",value:s.expiring_soon,color:"text-red-600",highlight:s.expiring_soon>0},{label:"–ë—Ä–∞–∫, –¥–æ—Å—Ç—É–ø–Ω—ã–π –∫ –≤—ã–≤–æ–∑—É",value:s.defective,color:"text-red-500",highlight:s.defective>0},{label:"–ò–∑–±—ã—Ç–æ–∫ –æ—Ç –ø–æ—Å—Ç–∞–≤–∫–∏",value:s.excess_from_supply,color:"text-gray-600"},{label:"–û–∂–∏–¥–∞—é—Ç –£–ü–î",value:s.awaiting_upd,color:"text-gray-600"},{label:"–ì–æ—Ç–æ–≤—è—Ç—Å—è –∫ –≤—ã–≤–æ–∑—É",value:s.preparing_for_removal,color:"text-gray-600"}].filter(d=>d.value>0||d.highlight),[s]);return e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),className:"cursor-help",children:t}),r&&e.jsxs("div",{className:"absolute z-50 w-72 p-4 bg-white border border-gray-300 rounded-lg shadow-xl bottom-full left-1/2 transform -translate-x-1/2 mb-2",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 mb-3 border-b pb-2",children:"–î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ Ozon"}),e.jsx("div",{className:"space-y-2",children:n.length>0?n.map((c,d)=>e.jsxs("div",{className:`flex justify-between items-center ${c.highlight?"bg-red-50 -mx-2 px-2 py-1 rounded":""}`,children:[e.jsxs("span",{className:"text-xs text-gray-600",children:[c.label,":"]}),e.jsx("span",{className:`text-xs font-semibold ${c.color} ${c.highlight?"animate-pulse":""}`,children:c.value.toLocaleString("ru-RU")})]},d)):e.jsx("div",{className:"text-xs text-gray-500 italic",children:"–ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫"})}),e.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1",children:e.jsx("div",{className:"w-3 h-3 bg-white border-b border-r border-gray-300 transform rotate-45"})})]})]})}),q=({filters:s,onChange:t,warehouses:r=[],clusters:l=[]})=>{const n=[{value:"critical",label:"–î–µ—Ñ–∏—Ü–∏—Ç"},{value:"low",label:"–ù–∏–∑–∫–∏–π –∑–∞–ø–∞—Å"},{value:"normal",label:"–ù–æ—Ä–º–∞"},{value:"excess",label:"–ò–∑–±—ã—Ç–æ–∫"}],c=a=>{t({...s,warehouse:a===""?void 0:a})},d=a=>{t({...s,cluster:a===""?void 0:a})},u=a=>{t({...s,liquidity_status:a===""?void 0:a})},h=a=>{t({...s,active_only:a})},x=a=>{t({...s,has_replenishment_need:a?!0:void 0})};return e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"–§–∏–ª—å—Ç—Ä—ã"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"warehouse-filter",className:"text-sm font-medium text-gray-700 mb-2",children:"–°–∫–ª–∞–¥"}),e.jsxs("select",{id:"warehouse-filter",value:s.warehouse||"",onChange:a=>c(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"–í—Å–µ —Å–∫–ª–∞–¥—ã"}),r.map(a=>e.jsxs("option",{value:a.warehouse_name,children:[a.warehouse_name," (",a.cluster,")"]},a.warehouse_name))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"cluster-filter",className:"text-sm font-medium text-gray-700 mb-2",children:"–ö–ª–∞—Å—Ç–µ—Ä"}),e.jsxs("select",{id:"cluster-filter",value:s.cluster||"",onChange:a=>d(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"–í—Å–µ –∫–ª–∞—Å—Ç–µ—Ä—ã"}),l.map(a=>e.jsxs("option",{value:a.cluster,children:[a.cluster," (",a.warehouse_count," —Å–∫–ª–∞–¥–æ–≤)"]},a.cluster))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"liquidity-filter",className:"text-sm font-medium text-gray-700 mb-2",children:"–°—Ç–∞—Ç—É—Å –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏"}),e.jsxs("select",{id:"liquidity-filter",value:s.liquidity_status||"",onChange:a=>u(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã"}),n.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]}),e.jsxs("div",{className:"flex flex-col justify-end gap-2",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.active_only,onChange:a=>h(a.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-700",children:"–¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ"})]})}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.has_replenishment_need||!1,onChange:a=>x(a.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-700",children:"–ù—É–∂–Ω–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ"})]})})]})]})]})},B=({data:s,sortConfig:t,onSort:r})=>{const l=m.useRef(null),n=m.useMemo(()=>{const i=[];return s.forEach(o=>{i.push({type:"warehouse-header",warehouse:o}),o.items.forEach(p=>{i.push({type:"item",item:p,warehouse:o})}),i.push({type:"warehouse-footer",warehouse:o})}),i},[s]),d=m.useMemo(()=>s.reduce((i,o)=>i+o.items.length,0),[s])>50,u=O({count:n.length,getScrollElement:()=>l.current,estimateSize:i=>{const o=n[i];return o.type==="warehouse-header"||o.type==="warehouse-footer"?48:72},overscan:5,enabled:d}),h=i=>{const o=t.field===i&&t.order==="asc"?"desc":"asc";r({field:i,order:o})},x=i=>t.field!==i?e.jsx("svg",{className:"w-4 h-4 ml-1 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})}):t.order==="asc"?e.jsx("svg",{className:"w-4 h-4 ml-1 text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}):e.jsx("svg",{className:"w-4 h-4 ml-1 text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),a=i=>{if(i.type==="warehouse-header")return e.jsx("tr",{className:"bg-gray-100 font-semibold",children:e.jsx("td",{colSpan:7,className:"px-6 py-3 text-sm text-gray-900 border-t-2 border-gray-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{children:[i.warehouse.warehouse_name,e.jsxs("span",{className:"ml-2 text-xs font-normal text-gray-600",children:["(",i.warehouse.cluster,")"]})]}),e.jsxs("span",{className:"text-xs font-normal text-gray-600",children:[i.warehouse.totals.total_items," —Ç–æ–≤–∞—Ä–æ–≤"]})]})})});if(i.type==="warehouse-footer")return e.jsxs("tr",{className:"bg-gray-50 font-semibold border-b-2 border-gray-300",children:[e.jsx("td",{colSpan:2,className:"px-6 py-3 text-sm text-gray-900 text-right",children:"–ò—Ç–æ–≥–æ –ø–æ —Å–∫–ª–∞–¥—É:"}),e.jsx("td",{className:"px-6 py-3 text-sm text-gray-900 text-right",children:i.warehouse.totals.total_available.toLocaleString("ru-RU")}),e.jsx("td",{className:"px-6 py-3"}),e.jsx("td",{className:"px-6 py-3"}),e.jsxs("td",{className:"px-6 py-3 text-sm text-gray-900 text-right",children:[i.warehouse.totals.total_replenishment_need.toLocaleString("ru-RU")," ","—à—Ç."]}),e.jsx("td",{className:"px-6 py-3"})]});const{item:o,warehouse:p}=i;return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate max-w-xs",children:o.name}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:o.sku})]}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-700",children:e.jsx("div",{className:"truncate max-w-xs",children:p.warehouse_name})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx(A,{item:o,children:e.jsx("span",{className:"text-sm font-semibold text-gray-900 cursor-help border-b border-dashed border-gray-400 whitespace-nowrap",children:o.available.toLocaleString("ru-RU")})})}),e.jsx("td",{className:"px-6 py-4 text-right text-sm text-gray-700 whitespace-nowrap",children:o.daily_sales_avg.toFixed(2)}),e.jsx("td",{className:"px-6 py-4 text-right text-sm text-gray-700 whitespace-nowrap",children:o.days_of_stock!==null?Math.round(o.days_of_stock):"‚àû"}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx(W,{need:o.replenishment_need,targetStock:o.target_stock})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(I,{status:o.liquidity_status,daysOfStock:o.days_of_stock})})]},`${o.product_id}-${o.warehouse_name}`)};return!s||s.length===0?e.jsx("div",{className:"bg-white rounded-lg shadow-md p-8 text-center",children:e.jsx("p",{className:"text-gray-500",children:"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è"})}):e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{ref:l,className:"overflow-x-auto",style:{maxHeight:d?"800px":"none",overflowY:d?"auto":"visible"},children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-28 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{onClick:()=>h("name"),className:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-gray-100 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:["–¢–æ–≤–∞—Ä",x("name")]})}),e.jsx("th",{onClick:()=>h("warehouse_name"),className:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-gray-100 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:["–°–∫–ª–∞–¥",x("warehouse_name")]})}),e.jsx("th",{onClick:()=>h("available"),className:"px-6 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-gray-100 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center justify-end",children:["–î–æ—Å—Ç—É–ø–Ω–æ",x("available")]})}),e.jsx("th",{onClick:()=>h("daily_sales_avg"),className:"px-6 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-gray-100 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center justify-end",children:["–ü—Ä–æ–¥–∞–∂–∏/–¥–µ–Ω—å",x("daily_sales_avg")]})}),e.jsx("th",{onClick:()=>h("days_of_stock"),className:"px-6 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-gray-100 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center justify-end",children:["–î–Ω–µ–π –∑–∞–ø–∞—Å–∞",x("days_of_stock")]})}),e.jsx("th",{onClick:()=>h("replenishment_need"),className:"px-6 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-gray-100 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center justify-end",children:["–ù—É–∂–Ω–æ –∑–∞–∫–∞–∑–∞—Ç—å",x("replenishment_need")]})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider whitespace-nowrap",children:"–°—Ç–∞—Ç—É—Å"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d?e.jsxs(e.Fragment,{children:[e.jsx("tr",{style:{height:`${u.getTotalSize()}px`},children:e.jsx("td",{colSpan:7,style:{padding:0}})}),u.getVirtualItems().map(i=>{const o=n[i.index];return e.jsx(N.Fragment,{children:e.jsx("tr",{style:{position:"absolute",top:0,left:0,width:"100%",transform:`translateY(${i.start}px)`},children:e.jsx("td",{colSpan:7,style:{padding:0},children:e.jsx("table",{className:"min-w-full",children:e.jsx("tbody",{children:a(o)})})})})},i.key)})]}):e.jsx(e.Fragment,{children:s.map(i=>e.jsxs(N.Fragment,{children:[a({type:"warehouse-header",warehouse:i}),i.items.map(o=>a({type:"item",item:o,warehouse:i})),a({type:"warehouse-footer",warehouse:i})]},i.warehouse_name))})})]})})})},U=({summary:s,lastUpdated:t,onRefresh:r,onExport:l,isRefreshing:n=!1})=>{const c=d=>{if(!d)return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";try{const u=new Date(d);return new Intl.DateTimeFormat("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(u)}catch{return"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"–î–∞—à–±–æ—Ä–¥ —Å–∫–ª–∞–¥—Å–∫–∏—Ö –æ—Å—Ç–∞—Ç–∫–æ–≤"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ",c(t)]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-4 lg:mt-0",children:[e.jsxs(M,{variant:"secondary",onClick:r,isLoading:n,disabled:n,children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"]}),e.jsxs(M,{variant:"primary",onClick:l,children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV"]})]})]}),s&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤"}),e.jsx("span",{className:"mt-2 text-3xl font-bold text-gray-900",children:s.total_products.toLocaleString("ru-RU")})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"–ê–∫—Ç–∏–≤–Ω—ã—Ö"}),e.jsx("span",{className:"mt-2 text-3xl font-bold text-blue-600",children:s.active_products.toLocaleString("ru-RU")})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"–î–µ—Ñ–∏—Ü–∏—Ç"}),e.jsx("span",{className:"mt-2 text-3xl font-bold text-red-600",children:s.by_liquidity.critical.toLocaleString("ru-RU")})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"–ù–∏–∑–∫–∏–π –∑–∞–ø–∞—Å"}),e.jsx("span",{className:"mt-2 text-3xl font-bold text-yellow-600",children:s.by_liquidity.low.toLocaleString("ru-RU")})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"–ù–æ—Ä–º–∞"}),e.jsx("span",{className:"mt-2 text-3xl font-bold text-green-600",children:s.by_liquidity.normal.toLocaleString("ru-RU")})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"–ò–∑–±—ã—Ç–æ–∫"}),e.jsx("span",{className:"mt-2 text-3xl font-bold text-blue-600",children:s.by_liquidity.excess.toLocaleString("ru-RU")})]})})]}),s&&s.total_replenishment_need>0&&e.jsx("div",{className:"mt-4 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 text-orange-600 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsxs("span",{className:"text-sm font-medium text-orange-900",children:["–û–±—â–∞—è –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏:"," ",e.jsxs("span",{className:"font-bold",children:[s.total_replenishment_need.toLocaleString("ru-RU")," —à—Ç."]})]})]})})]})},H=({pagination:s,onPageChange:t})=>{const{current_page:r,total_pages:l,has_prev:n,has_next:c,total:d,limit:u,offset:h}=s,x=h+1,a=Math.min(h+u,d),i=()=>{const o=[];if(l<=7)for(let g=1;g<=l;g++)o.push(g);else{o.push(1),r>3&&o.push("...");const g=Math.max(2,r-1),f=Math.min(l-1,r+1);for(let b=g;b<=f;b++)o.push(b);r<l-2&&o.push("..."),o.push(l)}return o};return d===0?null:e.jsx("div",{className:"bg-white rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 flex justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>t(r-1),disabled:!n,className:`px-4 py-2 border border-gray-300 rounded-md text-sm font-medium ${n?"text-gray-700 bg-white hover:bg-gray-50":"text-gray-400 bg-gray-100 cursor-not-allowed opacity-50"}`,children:"–ù–∞–∑–∞–¥"}),e.jsx("button",{onClick:()=>t(r+1),disabled:!c,className:`px-4 py-2 border border-gray-300 rounded-md text-sm font-medium ${c?"text-gray-700 bg-white hover:bg-gray-50":"text-gray-400 bg-gray-100 cursor-not-allowed opacity-50"}`,children:"–í–ø–µ—Ä–µ–¥"})]}),e.jsxs("div",{className:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["–ü–æ–∫–∞–∑–∞–Ω–æ ",e.jsx("span",{className:"font-medium",children:x})," - ",e.jsx("span",{className:"font-medium",children:a})," –∏–∑ ",e.jsx("span",{className:"font-medium",children:d})," —Ç–æ–≤–∞—Ä–æ–≤"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm space-x-2","aria-label":"Pagination",children:[e.jsxs("button",{onClick:()=>t(r-1),disabled:!n,className:`px-4 py-2 border border-gray-300 rounded-md text-sm font-medium ${n?"text-gray-700 bg-white hover:bg-gray-50":"text-gray-400 bg-gray-100 cursor-not-allowed opacity-50"}`,children:[e.jsx("span",{className:"sr-only",children:"–ü—Ä–µ–¥—ã–¥—É—â–∞—è"}),e.jsx("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})]}),i().map((o,p)=>{if(o==="...")return e.jsx("span",{className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md bg-white text-sm font-medium text-gray-700",children:"..."},`ellipsis-${p}`);const g=o,f=g===r;return e.jsx("button",{onClick:()=>t(g),className:`px-4 py-2 border rounded-md text-sm font-medium ${f?"bg-primary-50 border-primary-500 text-primary-600":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:g},g)}),e.jsxs("button",{onClick:()=>t(r+1),disabled:!c,className:`px-4 py-2 border border-gray-300 rounded-md text-sm font-medium ${c?"text-gray-700 bg-white hover:bg-gray-50":"text-gray-400 bg-gray-100 cursor-not-allowed opacity-50"}`,children:[e.jsx("span",{className:"sr-only",children:"–°–ª–µ–¥—É—é—â–∞—è"}),e.jsx("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})]})]})})]})]})})},V="/api",K=3e4,P=3,Y=1e3;class j extends Error{constructor(t,r,l,n=!1){super(t),this.statusCode=r,this.response=l,this.isRetryable=n,this.name="ApiException"}}function J(s){return s instanceof j&&s.statusCode?s.statusCode>=500&&s.statusCode<600:!0}function X(s){return new Promise(t=>setTimeout(t,s))}function G(s,t){const r=new URL(`${V}${s}`,window.location.origin);return t&&Object.entries(t).forEach(([l,n])=>{r.searchParams.append(l,String(n))}),r.toString()}async function Q(s,t={}){const{timeout:r=K,...l}=t,n=new AbortController,c=setTimeout(()=>n.abort(),r);try{const d=await fetch(s,{...l,signal:n.signal});return clearTimeout(c),d}catch(d){throw clearTimeout(c),d instanceof Error&&d.name==="AbortError"?new j("Request timeout",408):d}}async function w(s,t={},r=0){const{params:l,...n}=t,c=G(s,l),d={"Content-Type":"application/json"};try{const u=await Q(c,{...n,headers:{...d,...n.headers}});if(!u.ok){let x;try{x=await u.json()}catch{x={error:u.statusText||"Unknown error",code:u.status}}const a=u.status>=500&&u.status<600;throw new j(x.message||x.error||"Request failed",u.status,x,a)}return await u.json()}catch(u){if(r<P&&J(u)){const h=Y*Math.pow(2,r);return console.warn(`Request failed, retrying in ${h}ms (attempt ${r+1}/${P})`,u),await X(h),w(s,t,r+1)}throw u instanceof j?u:u instanceof Error?new j(u.message,void 0,void 0,!1):new j("Unknown error occurred",void 0,void 0,!1)}}const R={get:(s,t)=>w(s,{...t,method:"GET"}),post:(s,t,r)=>w(s,{...r,method:"POST",body:JSON.stringify(t)}),put:(s,t,r)=>w(s,{...r,method:"PUT",body:JSON.stringify(t)}),delete:(s,t)=>w(s,{...t,method:"DELETE"}),patch:(s,t,r)=>w(s,{...r,method:"PATCH",body:JSON.stringify(t)})},k={DASHBOARD:"/warehouse-dashboard.php",EXPORT:"/warehouse-dashboard.php",WAREHOUSES:"/warehouse-dashboard.php",CLUSTERS:"/warehouse-dashboard.php"},_={async getDashboardData(s={}){const t={action:"dashboard"};s.warehouse&&(t.warehouse=s.warehouse),s.cluster&&(t.cluster=s.cluster),s.liquidity_status&&(t.liquidity_status=s.liquidity_status),s.active_only!==void 0&&(t.active_only=s.active_only),s.has_replenishment_need!==void 0&&(t.has_replenishment_need=s.has_replenishment_need),s.sort_by&&(t.sort_by=s.sort_by),s.sort_order&&(t.sort_order=s.sort_order),s.limit&&(t.limit=s.limit),s.offset&&(t.offset=s.offset);const r=await R.get(k.DASHBOARD,{params:t});if(!r.success)throw new Error(r.error||"Failed to fetch dashboard data");return r.data},async exportToCSV(s={}){const t={action:"export"};s.warehouse&&(t.warehouse=s.warehouse),s.cluster&&(t.cluster=s.cluster),s.liquidity_status&&(t.liquidity_status=s.liquidity_status),s.active_only!==void 0&&(t.active_only=s.active_only),s.has_replenishment_need!==void 0&&(t.has_replenishment_need=s.has_replenishment_need);const r=new URL(`/api${k.EXPORT}`,window.location.origin);Object.entries(t).forEach(([n,c])=>{r.searchParams.append(n,String(c))});const l=await fetch(r.toString());if(!l.ok)throw new Error("Failed to export data");return l.blob()},downloadCSV(s,t){const r=window.URL.createObjectURL(s),l=document.createElement("a");l.href=r,l.download=t||`warehouse_dashboard_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(r)},async getWarehouses(){const s=await R.get(k.WAREHOUSES,{params:{action:"warehouses"}});if(!s.success)throw new Error(s.error||"Failed to fetch warehouses");return s.data},async getClusters(){const s=await R.get(k.CLUSTERS,{params:{action:"clusters"}});if(!s.success)throw new Error(s.error||"Failed to fetch clusters");return s.data}},v={all:["warehouse"],dashboard:s=>[...v.all,"dashboard",s],warehouses:()=>[...v.all,"warehouses"],clusters:()=>[...v.all,"clusters"]};function Z(s={}){const{enabled:t=!0,refetchInterval:r,...l}=s;return S({queryKey:v.dashboard(l),queryFn:()=>_.getDashboardData(l),staleTime:5*60*1e3,gcTime:10*60*1e3,enabled:t,refetchInterval:r,retry:(n,c)=>{if(c instanceof Error&&"statusCode"in c){const d=c.statusCode;if(d&&d>=400&&d<500)return!1}return n<3},retryDelay:n=>Math.min(1e3*2**n,3e4)})}function ee(s={}){const{enabled:t=!0}=s;return S({queryKey:v.warehouses(),queryFn:()=>_.getWarehouses(),staleTime:30*60*1e3,gcTime:60*60*1e3,enabled:t,retry:2})}function se(s={}){const{enabled:t=!0}=s;return S({queryKey:v.clusters(),queryFn:()=>_.getClusters(),staleTime:30*60*1e3,gcTime:60*60*1e3,enabled:t,retry:2})}function te(){return $({mutationFn:s=>_.exportToCSV(s),onSuccess:s=>{_.downloadCSV(s)},onError:s=>{console.error("Failed to export warehouse data:",s)}})}function re(s={}){const{loadWarehouses:t=!0,loadClusters:r=!0,...l}=s,n=Z(l),c=ee({enabled:t}),d=se({enabled:r}),u=te();return{dashboard:n,warehouses:c,clusters:d,exportMutation:u,isLoading:n.isLoading||c.isLoading||d.isLoading,hasError:n.isError||c.isError||d.isError}}const oe=()=>{var L,E;m.useEffect(()=>{console.log("[DIAGNOSTIC] WarehouseDashboardPage component mounted",{timestamp:new Date().toISOString()})},[]);const[s,t]=m.useState({active_only:!0}),[r,l]=m.useState({field:"replenishment_need",order:"desc"}),[n,c]=m.useState(1),d=100,u=m.useMemo(()=>({...s,sort_by:r.field,sort_order:r.order,limit:d,offset:(n-1)*d,refetchInterval:5*60*1e3}),[s,r,n,d]),{dashboard:h,warehouses:x,clusters:a,exportMutation:i,isLoading:o,hasError:p}=re(u),g=m.useMemo(()=>({warehouse:s.warehouse,cluster:s.cluster,liquidity_status:s.liquidity_status,active_only:s.active_only,has_replenishment_need:s.has_replenishment_need}),[s]),f=m.useCallback(()=>{h.refetch()},[h]),b=m.useCallback(()=>{i.mutate(g)},[i,g]),C=m.useCallback(y=>{t(y),c(1)},[]),D=m.useCallback(y=>{l(y),c(1)},[]),F=m.useCallback(y=>{c(y),window.scrollTo({top:0,behavior:"smooth"})},[]);if(o)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(T,{size:"xl",text:"–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–∞—à–±–æ—Ä–¥–∞..."})});if(p){const y=h.error||x.error||a.error;return e.jsx(z,{error:y||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ",title:"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞—à–±–æ—Ä–¥–∞",onRetry:f,showDetails:!0})}return!h.data||h.data.warehouses.length===0?e.jsxs("div",{children:[e.jsx(U,{summary:(L=h.data)==null?void 0:L.summary,lastUpdated:(E=h.data)==null?void 0:E.last_updated,onRefresh:f,onExport:b,isRefreshing:h.isFetching}),e.jsx(q,{filters:s,onChange:C,warehouses:x.data,clusters:a.data}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(U,{summary:h.data.summary,lastUpdated:h.data.last_updated,onRefresh:f,onExport:b,isRefreshing:h.isFetching}),e.jsx(q,{filters:s,onChange:C,warehouses:x.data,clusters:a.data}),e.jsx(B,{data:h.data.warehouses,sortConfig:r,onSort:D}),h.data.pagination&&e.jsx(H,{pagination:h.data.pagination,onPageChange:F}),i.isPending&&e.jsx("div",{className:"fixed bottom-4 right-4 bg-blue-500 text-white px-6 py-3 rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{size:"sm"}),e.jsx("span",{className:"ml-3",children:"–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö..."})]})}),i.isSuccess&&e.jsx("div",{className:"fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("span",{children:"–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã"})]})}),i.isError&&e.jsx("div",{className:"fixed bottom-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),e.jsx("span",{children:"–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö"})]})})]})};export{oe as WarehouseDashboardPage,oe as default};
//# sourceMappingURL=WarehouseDashboardPage-CyQaM3TT.js.map
