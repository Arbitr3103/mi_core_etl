# Полный запуск MDM системы в продакшн

Этот каталог содержит все необходимые файлы и скрипты для полного запуска MDM системы в продакшн после успешного завершения пилотного тестирования.

## Файлы и скрипты

### Основные файлы

- **`launch-plan.md`** - Детальный план полного запуска системы
- **`full-launch.sh`** - Основной скрипт запуска системы в продакшн
- **`post-launch-monitoring.sh`** - Скрипт мониторинга после запуска
- **`README.md`** - Данный файл с инструкциями

### Структура каталогов

```
deployment/production-launch/
├── launch-plan.md              # План запуска
├── full-launch.sh             # Основной скрипт запуска
├── post-launch-monitoring.sh  # Мониторинг после запуска
├── logs/                      # Логи запуска и мониторинга
├── backups/                   # Резервные копии перед запуском
├── monitoring-data/           # Данные мониторинга
└── README.md                  # Инструкции
```

## Предварительные условия

Перед запуском убедитесь, что:

- ✅ Пилотное тестирование завершено успешно
- ✅ Все критические проблемы исправлены
- ✅ Продакшн инфраструктура настроена и работает
- ✅ Команда поддержки готова к работе
- ✅ Пользователи уведомлены о запуске

## Процесс запуска

### 1. Подготовка к запуску

```bash
# Проверьте готовность системы
./full-launch.sh --help

# Выполните проверки готовности (без запуска)
./full-launch.sh --skip-checks
```

### 2. Полный запуск системы

```bash
# Интерактивный запуск с подтверждением
./full-launch.sh

# Принудительный запуск без подтверждения
./full-launch.sh --force

# Запуск с пропуском проверок готовности
./full-launch.sh --skip-checks --force
```

### 3. Мониторинг после запуска

```bash
# Стандартный мониторинг (48 часов, проверки каждые 5 минут)
./post-launch-monitoring.sh

# Непрерывный мониторинг
./post-launch-monitoring.sh --continuous

# Мониторинг с настраиваемыми параметрами
./post-launch-monitoring.sh --duration 24 --interval 180

# Создание отчета по существующим данным
./post-launch-monitoring.sh --report
```

## Этапы запуска

Скрипт `full-launch.sh` выполняет следующие этапы:

### Этап 1: Проверка готовности

- Проверка результатов пилотного тестирования
- Проверка доступности инфраструктуры
- Проверка подключения к базе данных
- Проверка наличия мастер-данных

### Этап 2: Создание резервной копии

- Создание полной резервной копии базы данных
- Сохранение плана отката
- Подготовка к возможному восстановлению

### Этап 3: Переключение источников данных

- Обновление конфигурации API endpoints
- Настройка маршрутизации на MDM систему
- Настройка fallback на старые системы

### Этап 4: Обновление дашбордов

- Создание представлений для совместимости
- Обновление SQL запросов для мастер-данных
- Обновление Grafana дашбордов

### Этап 5: Запуск ETL процессов

- Настройка crontab для регулярных задач
- Запуск первичной синхронизации
- Активация автоматического сопоставления

### Этап 6: Активация мониторинга

- Проверка работы Prometheus и Grafana
- Настройка уведомлений
- Отправка уведомлений о запуске

### Этап 7: Проверка работоспособности

- Тестирование API endpoints
- Проверка производительности
- Валидация состояния базы данных

## Мониторинг после запуска

Скрипт `post-launch-monitoring.sh` отслеживает:

### Метрики API

- Статус здоровья API
- Время отклика endpoints
- Процент успешных запросов
- Количество ошибок

### Состояние базы данных

- Подключение к базе данных
- Количество активных соединений
- Время выполнения запросов

### Системные ресурсы

- Использование CPU
- Использование памяти
- Свободное место на диске

### Качество данных

- Количество мастер-продуктов
- Количество SKU сопоставлений
- Покрытие брендами и категориями

## Критические пороги и алерты

Система автоматически отправляет уведомления при превышении порогов:

- **API недоступен** - критический алерт
- **Время отклика API > 1 секунды** - предупреждение
- **Процент успешных запросов < 95%** - предупреждение
- **CPU > 80%** - предупреждение
- **Память > 85%** - предупреждение
- **Диск > 85%** - предупреждение

## Откат системы

В случае критических проблем:

```bash
# Автоматический откат к предыдущему состоянию
./full-launch.sh --rollback
```

Откат включает:

- Остановку MDM сервисов
- Восстановление базы данных из резервной копии
- Возврат к старой конфигурации API
- Уведомление команды об откате

## Файлы конфигурации

### API конфигурация

- `api_config.json` - Конфигурация API endpoints
- Nginx конфигурация с fallback на старые системы

### ETL процессы

- `mdm_crontab.txt` - Расписание ETL задач
- Скрипты синхронизации данных

### Мониторинг

- Grafana дашборды для продакшн метрик
- Prometheus правила алертинга

## Логи и отчеты

### Логи запуска

- `logs/full_launch_YYYYMMDD_HHMMSS.log` - Детальный лог запуска
- `launch_report_YYYYMMDD_HHMMSS.json` - JSON отчет о запуске

### Логи мониторинга

- `logs/post_launch_monitoring_YYYYMMDD_HHMMSS.log` - Лог мониторинга
- `monitoring-data/metrics_*.json` - Метрики по времени
- `monitoring_report_YYYYMMDD_HHMMSS.json` - Сводный отчет

## Команды для проверки статуса

```bash
# Проверка здоровья API
curl http://localhost:8080/health

# Проверка метрик качества данных
curl http://localhost:8080/api/data-quality/metrics

# Просмотр логов системы
docker-compose -f ../production/docker-compose.prod.yml logs -f mdm-app

# Мониторинг в Grafana
open http://localhost:3000

# Проверка статуса сервисов
docker-compose -f ../production/docker-compose.prod.yml ps
```

## Контакты и поддержка

### Команда запуска

- **Технический лидер**: Общее руководство
- **Администратор БД**: Миграция и мониторинг данных
- **DevOps инженер**: Инфраструктура и мониторинг
- **Разработчик**: Исправление проблем

### Каналы связи

- **Slack**: #mdm-production-launch
- **Email**: mdm-support@company.com
- **Телефон поддержки**: +7 (XXX) XXX-XX-XX

## Следующие шаги после запуска

1. **Первые 24 часа**

   - Непрерывный мониторинг системы
   - Быстрое реагирование на проблемы
   - Сбор первичной обратной связи

2. **Первая неделя**

   - Анализ производительности
   - Оптимизация медленных запросов
   - Обучение пользователей

3. **Первый месяц**
   - Анализ качества данных
   - Планирование улучшений
   - Документирование лучших практик

## Критерии успешного запуска

- ✅ API отвечает стабильно < 200ms
- ✅ Uptime > 99.9% в течение первых 48 часов
- ✅ Нет критических ошибок данных
- ✅ Пользователи работают без проблем
- ✅ ETL процессы выполняются по расписанию
- ✅ Мониторинг работает корректно

## Troubleshooting

### Частые проблемы

1. **API медленно отвечает**

   - Проверить нагрузку на базу данных
   - Оптимизировать медленные запросы
   - Увеличить ресурсы сервера

2. **Ошибки подключения к БД**

   - Проверить статус MySQL сервера
   - Проверить сетевое подключение
   - Проверить лимиты подключений

3. **Высокое использование ресурсов**
   - Проверить активные процессы
   - Оптимизировать запросы
   - Масштабировать инфраструктуру

### Полезные команды диагностики

```bash
# Проверка процессов MySQL
mysql -e "SHOW PROCESSLIST"

# Проверка медленных запросов
mysql -e "SHOW STATUS LIKE 'Slow_queries'"

# Проверка использования памяти
free -h

# Проверка использования диска
df -h

# Проверка сетевых подключений
netstat -an | grep :8080
```
