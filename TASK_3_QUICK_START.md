# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –£–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ v2.0

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ SQL –æ—à–∏–±–∫–∏
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ retry –ª–æ–≥–∏–∫–∞
‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ç–∞–±–ª–∏—Ü–µ–π product_cross_reference
‚úÖ –°–æ–∑–¥–∞–Ω —É–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º

## –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ product_cross_reference —Å–æ–∑–¥–∞–Ω–∞
mysql -u ingest_user -p mi_core_db < create_product_cross_reference_table.sql
```

### 2. –ó–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```bash
# –ë–∞–∑–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (50 —Ç–æ–≤–∞—Ä–æ–≤)
php sync-real-product-names-v2.php

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
php sync-real-product-names-v2.php --limit=100 --batch-size=20 --verbose
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```bash
# –í–∞–ª–∏–¥–∞—Ü–∏—è
php validate_sync_results.php

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
tail -f logs/sync_*.log
```

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª                             | –û–ø–∏—Å–∞–Ω–∏–µ                        |
| -------------------------------- | ------------------------------- |
| `sync-real-product-names-v2.php` | –£–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ |
| `src/SyncErrorHandler.php`       | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ —Å retry       |
| `src/CrossReferenceManager.php`  | –ú–µ–Ω–µ–¥–∂–µ—Ä —Ç–∞–±–ª–∏—Ü—ã —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è  |
| `validate_sync_results.php`      | –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤           |
| `docs/SYNC_SCRIPT_V2_GUIDE.md`   | –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è             |

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

```bash
--limit=N          # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 50)
--batch-size=N     # –†–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10)
--verbose          # –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥
--help             # –°–ø—Ä–∞–≤–∫–∞
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

```bash
php sync-real-product-names-v2.php --limit=10 --verbose
```

### –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

```bash
php sync-real-product-names-v2.php --limit=10000 --batch-size=50
```

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ cron

```bash
# –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ 3:00
0 3 * * * cd /path/to/project && php sync-real-product-names-v2.php --limit=1000 >> logs/cron_sync.log 2>&1
```

## –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. SQL –æ—à–∏–±–∫–∞ —Å ORDER BY

**–ë—ã–ª–æ:**

```sql
SELECT DISTINCT i.product_id
FROM inventory_data i
ORDER BY i.quantity_present DESC  -- –û–®–ò–ë–ö–ê!
```

**–°—Ç–∞–ª–æ:**

```sql
SELECT product_id
FROM (
    SELECT i.product_id, i.quantity_present
    FROM inventory_data i
    ORDER BY i.quantity_present DESC
) ranked_products
```

### 2. –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ç–∏–ø–æ–≤ –≤ JOIN

**–ë—ã–ª–æ:**

```sql
LEFT JOIN dim_products dp ON i.product_id = dp.sku_ozon  -- INT vs VARCHAR
```

**–°—Ç–∞–ª–æ:**

```sql
JOIN product_cross_reference pcr ON CAST(i.product_id AS CHAR) = pcr.inventory_product_id
```

### 3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

**–ë—ã–ª–æ:**

- –°–∫—Ä–∏–ø—Ç –ø–∞–¥–∞–ª –ø—Ä–∏ —Å–±–æ—è—Ö API
- –ù–µ—Ç retry –ª–æ–≥–∏–∫–∏
- –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–°—Ç–∞–ª–æ:**

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ (3 —Ä–∞–∑–∞)
- –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (1s, 2s, 4s)
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- Graceful degradation

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥

```
üîÑ –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –†–ï–ê–õ–¨–ù–´–• –ù–ê–ó–í–ê–ù–ò–ô –¢–û–í–ê–†–û–í (v2.0)
================================================

‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —É—Å–ø–µ—à–Ω–æ

üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...
‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞

üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ–¥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π:
   –í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤: 1250
   –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: 1100
   –û–∂–∏–¥–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: 150
   –ü—Ä–æ—Ü–µ–Ω—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: 88.0%

üöÄ –ù–∞—á–∏–Ω–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é (–ª–∏–º–∏—Ç: 50 —Ç–æ–≤–∞—Ä–æ–≤)...

   –ü—Ä–æ–≥—Ä–µ—Å—Å: [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 100% (50/50)

‚úÖ –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê!

üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
   –í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 50
   –£—Å–ø–µ—à–Ω–æ: 48
   –û—à–∏–±–∫–∏: 2
   –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 12.5 —Å–µ–∫
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ config.php
cat config.php | grep DB_

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø
mysql -u ingest_user -p mi_core_db -e "SELECT 1"
```

### –¢–∞–±–ª–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É
mysql -u ingest_user -p mi_core_db < create_product_cross_reference_table.sql
```

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

```bash
# –£–≤–µ–ª–∏—á—å—Ç–µ —Ä–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞
php sync-real-product-names-v2.php --limit=100 --batch-size=50
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- üìñ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `docs/SYNC_SCRIPT_V2_GUIDE.md`
- üìã –û—Ç—á–µ—Ç –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏: `TASK_3_COMPLETION_REPORT.md`
- üß™ –¢–µ—Å—Ç—ã: `validate_sync_results.php`

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ `logs/`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é: `php validate_sync_results.php`
3. –ò–∑—É—á–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é: `docs/SYNC_SCRIPT_V2_GUIDE.md`
