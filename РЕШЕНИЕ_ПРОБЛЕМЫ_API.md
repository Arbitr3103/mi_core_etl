# –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å API inventory-analytics.php

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–æ–±–ª–µ–º–∞ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ —Ñ–∞–π–ª `inventory-analytics.php` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø–æ –ø—É—Ç–∏ `/var/www/mi_core_api/api/inventory-analytics.php`.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `api/inventory-analytics.php` –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
scp api/inventory-analytics.php user@your-server:/var/www/mi_core_api/api/

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ rsync
rsync -av api/ user@your-server:/var/www/mi_core_api/api/
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh user@your-server

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É
ls -la /var/www/mi_core_api/
ls -la /var/www/mi_core_api/api/

# –°–æ–∑–¥–∞–π—Ç–µ –∫–∞—Ç–∞–ª–æ–≥ api –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
sudo mkdir -p /var/www/mi_core_api/api
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞
sudo chown -R www-data:www-data /var/www/mi_core_api/api/

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∞
sudo chmod -R 644 /var/www/mi_core_api/api/*.php
sudo chmod 755 /var/www/mi_core_api/api/
```

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—É—Ç—å –∫ —Ñ–∞–π–ª–∞–º:

```nginx
server {
    listen 80;
    server_name your-domain.com;
    root /var/www/mi_core_api;
    index index.php index.html;

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}
```

### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª config.php

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –µ—Å—Ç—å —Ñ–∞–π–ª `config.php` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞
ls -la /var/www/mi_core_api/config.php

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ (–±–µ–∑ –ø–∞—Ä–æ–ª–µ–π)
grep -v "PASSWORD" /var/www/mi_core_api/config.php
```

### 6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ .env —Ñ–∞–π–ª–∞
ls -la /var/www/mi_core_api/.env

# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –Ω–µ–º –µ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î
grep "DB_" /var/www/mi_core_api/.env
```

### 7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ API:

```bash
# –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
php /var/www/mi_core_api/config.php

# –¢–µ—Å—Ç API –Ω–∞–ø—Ä—è–º—É—é
cd /var/www/mi_core_api
php -r "
\$_GET['action'] = 'dashboard';
include 'api/inventory-analytics.php';
"

# –¢–µ—Å—Ç —á–µ—Ä–µ–∑ curl
curl "http://127.0.0.1/api/inventory-analytics.php?action=dashboard"
```

## üöÄ –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ:

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä:**

   ```bash
   php start_test_server.php
   ```

2. **–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**

   - –î–∞—à–±–æ—Ä–¥: http://127.0.0.1:8080/test_dashboard.html
   - API: http://127.0.0.1:8080/api/inventory-analytics.php?action=dashboard

3. **–ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π —Ç–µ—Å—Ç:**
   ```bash
   php test_inventory_api_clean.php
   ```

## üìã –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫

- [ ] –§–∞–π–ª `api/inventory-analytics.php` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- [ ] –§–∞–π–ª `config.php` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- [ ] –§–∞–π–ª `.env` —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (644 –¥–ª—è —Ñ–∞–π–ª–æ–≤, 755 –¥–ª—è –ø–∞–ø–æ–∫)
- [ ] –í–ª–∞–¥–µ–ª–µ—Ü —Ñ–∞–π–ª–æ–≤ - www-data
- [ ] Nginx/Apache –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ PHP
- [ ] PHP-FPM –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞ –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ `inventory_data`

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏

–ï—Å–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥—Ä—É–≥–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ç–∞–∫–∂–µ:

- `api/inventory_cache_manager.php` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
- –í—Å–µ —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏ `src/` (–µ—Å–ª–∏ API –∏—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç)
- –§–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫:

   ```bash
   sudo tail -f /var/log/nginx/error.log
   sudo tail -f /var/log/php8.1-fpm.log
   ```

2. –í–∫–ª—é—á–∏—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ PHP –≤—Ä–µ–º–µ–Ω–Ω–æ:

   ```php
   <?php
   error_reporting(E_ALL);
   ini_set('display_errors', 1);

   $_GET['action'] = 'dashboard';
   include 'api/inventory-analytics.php';
   ?>
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç–¥–µ–ª—å–Ω–æ:
   ```php
   <?php
   require_once 'config.php';
   try {
       $pdo = getDatabaseConnection();
       echo "‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —É—Å–ø–µ—à–Ω–æ!\n";
   } catch (Exception $e) {
       echo "‚ùå –û—à–∏–±–∫–∞ –ë–î: " . $e->getMessage() . "\n";
   }
   ?>
   ```
