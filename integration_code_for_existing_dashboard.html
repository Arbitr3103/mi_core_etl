<!-- 
–ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –°–ò–°–¢–ï–ú–´ –ü–û–ü–û–õ–ù–ï–ù–ò–Ø –í –°–£–©–ï–°–¢–í–£–Æ–©–ò–ô –î–ê–®–ë–û–†–î
–î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ –≤–∞—à —Ñ–∞–π–ª test_dashboard.html –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
-->

<!-- 1. –î–û–ë–ê–í–¨–¢–ï –ö–ù–û–ü–ö–£ –í –ù–ê–í–ò–ì–ê–¶–ò–Æ –ò–õ–ò –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø -->
<div class="replenishment-integration" style="margin: 10px 0">
  <button
    id="replenishmentBtn"
    class="btn btn-primary"
    style="
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      transition: all 0.3s ease;
    "
    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.4)'"
    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.3)'"
  >
    üì¶ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—é
  </button>
</div>

<!-- 2. –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –î–ê–®–ë–û–†–î–ê –ü–û–ü–û–õ–ù–ï–ù–ò–Ø -->
<div
  id="replenishmentModal"
  style="
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(5px);
  "
>
  <div
    style="
      position: relative;
      margin: 2% auto;
      width: 95%;
      height: 90%;
      background: white;
      border-radius: 15px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    "
  >
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ -->
    <div
      style="
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      "
    >
      <h2 style="margin: 0; font-size: 24px">
        üì¶ –°–∏—Å—Ç–µ–º–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—é —Å–∫–ª–∞–¥–∞
      </h2>
      <button
        id="closeReplenishmentModal"
        style="
          background: rgba(255, 255, 255, 0.2);
          border: none;
          color: white;
          font-size: 24px;
          width: 40px;
          height: 40px;
          border-radius: 50%;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
        "
        onmouseover="this.style.background='rgba(255,255,255,0.3)'"
        onmouseout="this.style.background='rgba(255,255,255,0.2)'"
      >
        √ó
      </button>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç - iframe —Å –¥–∞—à–±–æ—Ä–¥–æ–º –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è -->
    <iframe
      id="replenishmentFrame"
      src="/html/replenishment_dashboard.php"
      style="
        width: 100%;
        height: calc(100% - 80px);
        border: none;
        background: white;
      "
    >
    </iframe>

    <!-- –ü–∞–Ω–µ–ª—å –±—ã—Å—Ç—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π -->
    <div
      style="
        position: absolute;
        bottom: 20px;
        right: 20px;
        display: flex;
        gap: 10px;
      "
    >
      <button
        onclick="refreshReplenishmentData()"
        style="
          background: #28a745;
          color: white;
          border: none;
          padding: 10px 15px;
          border-radius: 6px;
          cursor: pointer;
          font-size: 14px;
        "
      >
        üîÑ –û–±–Ω–æ–≤–∏—Ç—å
      </button>

      <button
        onclick="exportReplenishmentData()"
        style="
          background: #17a2b8;
          color: white;
          border: none;
          padding: 10px 15px;
          border-radius: 6px;
          cursor: pointer;
          font-size: 14px;
        "
      >
        üìä –≠–∫—Å–ø–æ—Ä—Ç CSV
      </button>
    </div>
  </div>
</div>

<!-- 3. JAVASCRIPT –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ú–û–î–ê–õ–¨–ù–´–ú –û–ö–ù–û–ú -->
<script>
  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
  (function () {
    const modal = document.getElementById("replenishmentModal");
    const btn = document.getElementById("replenishmentBtn");
    const closeBtn = document.getElementById("closeReplenishmentModal");
    const iframe = document.getElementById("replenishmentFrame");

    // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    btn.onclick = function () {
      modal.style.display = "block";
      document.body.style.overflow = "hidden"; // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Ñ–æ–Ω–∞

      // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
      loadReplenishmentStats();
    };

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    closeBtn.onclick = function () {
      modal.style.display = "none";
      document.body.style.overflow = "auto"; // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É
    };

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    window.onclick = function (event) {
      if (event.target == modal) {
        modal.style.display = "none";
        document.body.style.overflow = "auto";
      }
    };

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ ESC
    document.addEventListener("keydown", function (event) {
      if (event.key === "Escape" && modal.style.display === "block") {
        modal.style.display = "none";
        document.body.style.overflow = "auto";
      }
    });

    // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    window.loadReplenishmentStats = function () {
      fetch("/api/replenishment.php?action=status")
        .then((response) => response.json())
        .then((data) => {
          if (data.success) {
            console.log("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞:", data.data);

            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ –∫–Ω–æ–ø–∫—É
            const recommendationsCount =
              data.data.tables.replenishment_recommendations.record_count;
            if (recommendationsCount > 0) {
              btn.innerHTML = `üì¶ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—é (${recommendationsCount})`;
              btn.style.background =
                "linear-gradient(135deg, #28a745 0%, #20c997 100%)";
            }
          }
        })
        .catch((error) => {
          console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:", error);
        });
    };

    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
    window.refreshReplenishmentData = function () {
      iframe.src = iframe.src; // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º iframe
      loadReplenishmentStats();

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      showNotification("–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã", "success");
    };

    // –§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
    window.exportReplenishmentData = function () {
      // –û—Ç–∫—Ä—ã–≤–∞–µ–º —ç–∫—Å–ø–æ—Ä—Ç –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ
      window.open("/export_recommendations.php", "_blank");
      showNotification("–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–ø—É—â–µ–Ω", "info");
    };

    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    function showNotification(message, type = "info") {
      const notification = document.createElement("div");
      notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10001;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            transform: translateX(100%);
        `;

      // –¶–≤–µ—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
      const colors = {
        success: "linear-gradient(135deg, #28a745 0%, #20c997 100%)",
        info: "linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%)",
        warning: "linear-gradient(135deg, #ffc107 0%, #fd7e14 100%)",
        error: "linear-gradient(135deg, #dc3545 0%, #e83e8c 100%)",
      };

      notification.style.background = colors[type] || colors.info;
      notification.textContent = message;

      document.body.appendChild(notification);

      // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
      setTimeout(() => {
        notification.style.transform = "translateX(0)";
      }, 100);

      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
      setTimeout(() => {
        notification.style.transform = "translateX(100%)";
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener("DOMContentLoaded", function () {
      loadReplenishmentStats();

      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞ (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å –æ—Å–Ω–æ–≤–Ω—ã–º –¥–∞—à–±–æ—Ä–¥–æ–º)
      setInterval(loadReplenishmentStats, 24 * 60 * 60 * 1000);
    });
  })();
</script>

<!-- 4. –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ò–ù–¢–ï–ì–†–ê–¶–ò–ò -->
<style>
  /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
  @media (max-width: 768px) {
    #replenishmentModal > div {
      margin: 1% auto;
      width: 98%;
      height: 95%;
    }

    #replenishmentBtn {
      width: 100%;
      margin: 5px 0;
    }
  }

  /* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
  #replenishmentModal {
    animation: fadeIn 0.3s ease;
  }

  #replenishmentModal > div {
    animation: slideIn 0.3s ease;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(-50px) scale(0.9);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö */
  #replenishmentBtn:active {
    transform: translateY(1px);
  }

  #replenishmentBtn:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
  }
</style>

<!-- 
–ò–ù–°–¢–†–£–ö–¶–ò–ò –ü–û –ò–ù–¢–ï–ì–†–ê–¶–ò–ò:

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å —ç—Ç–æ—Ç –∫–æ–¥
2. –í—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –≤ –≤–∞—à —Ñ–∞–π–ª test_dashboard.html –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
3. –†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –∫–Ω–æ–ø–∫—É —Ç–∞–º, –≥–¥–µ —Ö–æ—Ç–∏—Ç–µ (–≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏, –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —Ç.–¥.)
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–∞–±–æ—Ç—É –∫–Ω–æ–ø–∫–∏

–í–û–ó–ú–û–ñ–ù–û–°–¢–ò:
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º –¥–∞—à–±–æ—Ä–¥–æ–º –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- –ö–Ω–æ–ø–∫–∏ –±—ã—Å—Ç—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π (–æ–±–Ω–æ–≤–∏—Ç—å, —ç–∫—Å–ø–æ—Ä—Ç)
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –ö—Ä–∞—Å–∏–≤—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –¥–∏–∑–∞–π–Ω–æ–º
-->
