# 📦 Система пополнения склада

Интеллектуальная система для автоматического анализа запасов и генерации рекомендаций по пополнению товаров на складе.

## 🎯 Основные возможности

- **Анализ текущих запасов** - мониторинг остатков товаров в реальном времени
- **Расчет скорости продаж** - анализ трендов продаж за разные периоды
- **Генерация рекомендаций** - автоматические рекомендации по пополнению с приоритизацией
- **Система алертов** - уведомления о критических остатках и медленно движущихся товарах
- **Комплексная отчетность** - детальные отчеты и аналитика по запасам
- **REST API** - программный интерфейс для интеграции с другими системами
- **Веб-интерфейс** - удобная панель управления

## 🏗️ Архитектура системы

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Веб-интерфейс │    │    REST API     │    │   Планировщик   │
└─────────┬───────┘    └─────────┬───────┘    └─────────┬───────┘
          │                      │                      │
          └──────────────────────┼──────────────────────┘
                                 │
                    ┌─────────────┴───────────────┐
                    │     Оркестратор             │
                    │  (ReplenishmentOrchestrator)│
                    └─────────────┬───────────────┘
                                  │
        ┌─────────────────────────┼─────────────────────────┐
        │                         │                         │
┌───────▼────────┐    ┌───────────▼──────────┐    ┌─────────▼────────┐
│ Анализатор     │    │ Калькулятор скорости │    │ Генератор        │
│ запасов        │    │ продаж               │    │ рекомендаций     │
└────────────────┘    └──────────────────────┘    └──────────────────┘
        │                         │                         │
        └─────────────────────────┼─────────────────────────┘
                                  │
        ┌─────────────────────────┼─────────────────────────┐
        │                         │                         │
┌───────▼────────┐    ┌───────────▼──────────┐    ┌─────────▼────────┐
│ Менеджер       │    │ Движок отчетности    │    │ База данных      │
│ алертов        │    │                      │    │ MySQL            │
└────────────────┘    └──────────────────────┘    └──────────────────┘
```

## 📋 Компоненты системы

### Основные модули

1. **inventory_analyzer.py** - Анализ текущих запасов
2. **sales_velocity_calculator.py** - Расчет скорости продаж и трендов
3. **replenishment_recommender.py** - Генерация рекомендаций по пополнению
4. **alert_manager.py** - Система уведомлений и алертов
5. **reporting_engine.py** - Создание отчетов и аналитики
6. **replenishment_orchestrator.py** - Координация всех компонентов
7. **schedule_replenishment.py** - Планировщик автоматических задач

### API и интерфейсы

8. **simple_api_server.py** - REST API сервер
9. **replenishment_api.py** - Расширенный API с Flask (опционально)

### Утилиты и настройка

10. **create_replenishment_schema.sql** - Схема базы данных
11. **test_replenishment_simple.py** - Набор тестов
12. **requirements.txt** - Зависимости Python

## 🚀 Быстрый старт

### 1. Установка зависимостей

```bash
# Клонируйте репозиторий
git clone <repository-url>
cd inventory-replenishment

# Установите зависимости Python
pip install -r requirements.txt
```

### 2. Настройка базы данных

```bash
# Создайте базу данных MySQL
mysql -u root -p -e "CREATE DATABASE replenishment_db;"

# Выполните миграцию схемы
mysql -u root -p replenishment_db < create_replenishment_schema.sql
```

### 3. Настройка подключения

Отредактируйте файл `importers/config.py`:

```python
DB_CONFIG = {
    'host': 'localhost',
    'user': 'your_username',
    'password': 'your_password',
    'database': 'replenishment_db'
}
```

### 4. Запуск системы

```bash
# Запуск полного анализа
python3 replenishment_orchestrator.py --mode full

# Запуск API сервера
python3 simple_api_server.py

# Запуск планировщика
python3 schedule_replenishment.py --mode schedule
```

## 📊 Использование

### Командная строка

```bash
# Полный анализ пополнения
python3 replenishment_orchestrator.py --mode full

# Быстрая проверка критических остатков
python3 replenishment_orchestrator.py --mode quick

# Экспорт рекомендаций в CSV
python3 replenishment_orchestrator.py --mode export --export-file report.csv --export-format csv

# Запуск только для определенного источника
python3 replenishment_orchestrator.py --mode full --source ozon
```

### REST API

```bash
# Получить рекомендации
curl http://localhost:8000/api/recommendations

# Получить алерты
curl http://localhost:8000/api/alerts

# Запустить анализ
curl -X POST http://localhost:8000/api/analysis/run

# Проверить здоровье системы
curl http://localhost:8000/api/health
```

### Веб-интерфейс

Откройте браузер и перейдите по адресу: http://localhost:8000

## 🔧 Конфигурация

### Настройки товаров

Система поддерживает индивидуальные настройки для каждого товара:

- `min_stock_level` - Минимальный уровень запасов
- `reorder_point` - Точка перезаказа
- `lead_time_days` - Время поставки в днях
- `safety_stock_days` - Страховой запас в днях
- `is_active` - Активность товара

### Настройки системы

Глобальные настройки хранятся в таблице `replenishment_settings`:

```sql
INSERT INTO replenishment_settings (category, setting_key, setting_value, setting_type) VALUES
('ANALYSIS', 'critical_stockout_threshold', '3', 'INTEGER'),
('ANALYSIS', 'high_priority_threshold', '7', 'INTEGER'),
('NOTIFICATIONS', 'enable_email_alerts', 'true', 'BOOLEAN');
```

## 📈 Алгоритмы и логика

### Расчет рекомендуемого количества

```
Потребность на время поставки = Скорость продаж × Время поставки
Страховой запас = Скорость продаж × Дни страхового запаса
Целевой уровень = Потребность + Страховой запас
Рекомендуемый заказ = Целевой уровень - Доступный остаток
```

### Определение приоритета

- **CRITICAL** - Дни до исчерпания ≤ 3 или остаток = 0
- **HIGH** - Дни до исчерпания ≤ 7 или ниже точки перезаказа
- **MEDIUM** - Дни до исчерпания ≤ 14
- **LOW** - Остальные случаи

### Анализ трендов продаж

- **GROWING** - Скорость продаж растет (7д > 14д > 30д)
- **DECLINING** - Скорость продаж падает (7д < 14д < 30д)
- **STABLE** - Колебания менее 20%

## 🔍 Мониторинг и алерты

### Типы алертов

1. **STOCKOUT_CRITICAL** - Критический остаток товара
2. **STOCKOUT_WARNING** - Предупреждение о низком остатке
3. **SLOW_MOVING** - Медленно движущийся товар (>30 дней без продаж)
4. **OVERSTOCKED** - Избыточные запасы (оборачиваемость >90 дней)

### Каналы уведомлений

- Email уведомления для критических алертов
- Веб-дашборд с актуальными алертами
- API для интеграции с внешними системами

## 🧪 Тестирование

```bash
# Запуск всех тестов
python3 test_replenishment_simple.py

# Запуск конкретного теста
python3 -m unittest test_replenishment_simple.TestBusinessLogic.test_priority_levels_ordering
```

## 📊 Отчетность

### Типы отчетов

1. **Комплексный отчет** - Полная аналитика по запасам и продажам
2. **Отчет по рекомендациям** - Список товаров для пополнения
3. **Отчет по алертам** - Критические ситуации
4. **Отчет по медленно движущимся товарам** - Анализ неликвидов

### Форматы экспорта

- JSON - для программной обработки
- CSV - для Excel и аналитики
- HTML - для просмотра в браузере

## 🔄 Автоматизация

### Планировщик задач

```bash
# Запуск планировщика
python3 schedule_replenishment.py --mode schedule

# Ручной запуск задачи
python3 schedule_replenishment.py --mode manual --task full
```

### Расписание по умолчанию

- **Полный анализ** - каждый день в 06:00
- **Быстрая проверка** - каждые 4 часа (08:00, 12:00, 16:00, 20:00)
- **Очистка отчетов** - каждое воскресенье в 02:00

## 🚀 Развертывание

### Docker (рекомендуется)

```bash
# Сборка образа
docker build -t replenishment-system .

# Запуск контейнера
docker run -d -p 8000:8000 --name replenishment replenishment-system
```

### Systemd сервис

```bash
# Копирование файла сервиса
sudo cp deployment/replenishment.service /etc/systemd/system/

# Запуск сервиса
sudo systemctl enable replenishment
sudo systemctl start replenishment
```

## 🔧 Устранение неполадок

### Частые проблемы

1. **Ошибка подключения к БД**

   ```
   Проверьте настройки в config.py
   Убедитесь что MySQL сервер запущен
   ```

2. **Нет рекомендаций**

   ```
   Проверьте наличие данных о продажах
   Убедитесь что товары активны (is_active = TRUE)
   ```

3. **Медленная работа**
   ```
   Добавьте индексы в базу данных
   Ограничьте количество анализируемых товаров
   ```

### Логи

Логи системы сохраняются в файлы:

- `replenishment_orchestrator.log` - Основные операции
- `replenishment_scheduler.log` - Планировщик задач

## 📚 API Документация

### Эндпоинты

| Метод | URL                            | Описание                   |
| ----- | ------------------------------ | -------------------------- |
| GET   | `/api/health`                  | Проверка состояния системы |
| GET   | `/api/recommendations`         | Получить рекомендации      |
| GET   | `/api/recommendations/{id}`    | Рекомендация для товара    |
| GET   | `/api/alerts`                  | Получить алерты            |
| POST  | `/api/alerts/{id}/acknowledge` | Подтвердить алерт          |
| POST  | `/api/analysis/run`            | Запустить анализ           |
| GET   | `/api/reports/comprehensive`   | Комплексный отчет          |

### Параметры запросов

**GET /api/recommendations**

- `limit` (int) - Максимальное количество (по умолчанию: 50)
- `priority` (string) - Фильтр по приоритету (CRITICAL, HIGH, MEDIUM, LOW)
- `source` (string) - Фильтр по источнику данных

**POST /api/analysis/run**

```json
{
  "source": "ozon",
  "save_to_db": true,
  "send_alerts": true
}
```

## 🤝 Вклад в проект

1. Форкните репозиторий
2. Создайте ветку для новой функции (`git checkout -b feature/amazing-feature`)
3. Зафиксируйте изменения (`git commit -m 'Add amazing feature'`)
4. Отправьте в ветку (`git push origin feature/amazing-feature`)
5. Откройте Pull Request

## 📄 Лицензия

Этот проект распространяется под лицензией MIT. См. файл `LICENSE` для подробностей.

## 👥 Авторы

- **Команда разработки** - Система пополнения склада

## 🙏 Благодарности

- Команде за разработку архитектуры системы
- Тестировщикам за обеспечение качества
- Пользователям за обратную связь

---

📞 **Поддержка**: Если у вас есть вопросы или проблемы, создайте issue в репозитории или свяжитесь с командой разработки.
