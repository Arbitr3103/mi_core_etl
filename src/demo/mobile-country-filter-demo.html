<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>–ú–æ–±–∏–ª—å–Ω–∞—è –¥–µ–º–æ: –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç—Ä–∞–Ω–µ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è</title>

    <!-- Bootstrap CSS –¥–ª—è –±–∞–∑–æ–≤—ã—Ö —Å—Ç–∏–ª–µ–π -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- –°—Ç–∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä–∞ -->
    <link href="../css/country-filter.css" rel="stylesheet" />

    <style>
      body {
        background-color: #f8f9fa;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        padding: 0;
        margin: 0;
        -webkit-text-size-adjust: 100%;
        -webkit-tap-highlight-color: transparent;
      }

      .mobile-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1rem;
        position: sticky;
        top: 0;
        z-index: 1000;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .mobile-header h1 {
        font-size: 1.25rem;
        margin: 0;
        font-weight: 600;
      }

      .mobile-header p {
        font-size: 0.85rem;
        margin: 0.25rem 0 0 0;
        opacity: 0.9;
      }

      .mobile-container {
        padding: 1rem;
        max-width: 100%;
      }

      .mobile-section {
        background: white;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 1rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .mobile-section h2 {
        font-size: 1.1rem;
        margin-bottom: 0.75rem;
        color: #333;
        font-weight: 600;
      }

      .mobile-filters {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      .mobile-filter-row {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      @media (min-width: 576px) {
        .mobile-filter-row {
          flex-direction: row;
          gap: 0.75rem;
        }

        .mobile-filter-row > div {
          flex: 1;
        }
      }

      .mobile-actions {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
        flex-wrap: wrap;
      }

      .mobile-actions .btn {
        flex: 1;
        min-width: 120px;
        padding: 0.75rem 1rem;
        font-size: 0.9rem;
        border-radius: 0.5rem;
        touch-action: manipulation;
      }

      .connection-info {
        background: #e3f2fd;
        border: 1px solid #bbdefb;
        border-radius: 0.375rem;
        padding: 0.75rem;
        margin-bottom: 1rem;
        font-size: 0.85rem;
      }

      .device-info {
        background: #f3e5f5;
        border: 1px solid #e1bee7;
        border-radius: 0.375rem;
        padding: 0.75rem;
        margin-bottom: 1rem;
        font-size: 0.85rem;
      }

      .test-results {
        background: #e8f5e8;
        border: 1px solid #c8e6c9;
        border-radius: 0.375rem;
        padding: 0.75rem;
        margin-top: 1rem;
        font-size: 0.85rem;
      }

      .performance-metrics {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.5rem;
        margin-top: 0.75rem;
      }

      .metric-item {
        background: #f8f9fa;
        padding: 0.5rem;
        border-radius: 0.25rem;
        text-align: center;
        border: 1px solid #e9ecef;
      }

      .metric-value {
        font-weight: 600;
        color: #007bff;
        font-size: 1.1rem;
      }

      .metric-label {
        font-size: 0.75rem;
        color: #6c757d;
        margin-top: 0.25rem;
      }

      .touch-test-area {
        background: #fff3cd;
        border: 2px dashed #ffc107;
        border-radius: 0.5rem;
        padding: 1rem;
        text-align: center;
        margin: 1rem 0;
        min-height: 80px;
        display: flex;
        align-items: center;
        justify-content: center;
        user-select: none;
        touch-action: manipulation;
      }

      .touch-test-area.active {
        background: #d4edda;
        border-color: #28a745;
        color: #155724;
      }

      .loading-test {
        text-align: center;
        padding: 1rem;
      }

      .loading-indicator {
        display: inline-block;
        width: 2rem;
        height: 2rem;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #007bff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* –°—Ç–∏–ª–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è touch –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è */
      .btn:active {
        transform: scale(0.98);
      }

      .filter-select:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
      }

      /* –°—Ç–∏–ª–∏ –¥–ª—è landscape –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ */
      @media (orientation: landscape) and (max-height: 500px) {
        .mobile-header {
          padding: 0.5rem 1rem;
        }

        .mobile-header h1 {
          font-size: 1.1rem;
        }

        .mobile-container {
          padding: 0.75rem;
        }

        .mobile-section {
          padding: 0.75rem;
          margin-bottom: 0.75rem;
        }
      }

      /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
      @media (max-width: 360px) {
        .mobile-container {
          padding: 0.75rem;
        }

        .mobile-actions .btn {
          font-size: 0.8rem;
          padding: 0.6rem 0.8rem;
        }

        .performance-metrics {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <!-- –ú–æ–±–∏–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="mobile-header">
      <h1>üì± –ú–æ–±–∏–ª—å–Ω–∞—è –¥–µ–º–æ: –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç—Ä–∞–Ω–µ</h1>
      <p>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ–Ω—Å–æ—Ä–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö</p>
    </div>

    <div class="mobile-container">
      <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ -->
      <div class="device-info">
        <strong>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:</strong> <span id="device-type">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ...</span
        ><br />
        <strong>–≠–∫—Ä–∞–Ω:</strong> <span id="screen-size">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ...</span
        ><br />
        <strong>Touch:</strong> <span id="touch-support">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ...</span
        ><br />
        <strong>–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è:</strong>
        <span id="orientation">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ...</span>
      </div>

      <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ -->
      <div class="connection-info">
        <strong>–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ:</strong>
        <span id="connection-type">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ...</span><br />
        <strong>–°–∫–æ—Ä–æ—Å—Ç—å:</strong>
        <span id="connection-speed">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ...</span>
      </div>

      <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
      <div class="mobile-section">
        <h2>üéØ –§–∏–ª—å—Ç—Ä—ã –∞–≤—Ç–æ–º–æ–±–∏–ª—è</h2>

        <div class="mobile-filters">
          <div class="mobile-filter-row">
            <div>
              <label for="mobile-brand" class="form-label">–ú–∞—Ä–∫–∞:</label>
              <select id="mobile-brand" class="form-select">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É</option>
                <option value="1">BMW</option>
                <option value="2">Mercedes-Benz</option>
                <option value="3">Audi</option>
                <option value="4">Toyota</option>
                <option value="5">Honda</option>
              </select>
            </div>

            <div>
              <label for="mobile-model" class="form-label">–ú–æ–¥–µ–ª—å:</label>
              <select id="mobile-model" class="form-select" disabled>
                <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É</option>
              </select>
            </div>
          </div>

          <div class="mobile-filter-row">
            <div>
              <div id="mobile-country-filter"></div>
            </div>

            <div>
              <label for="mobile-year" class="form-label">–ì–æ–¥:</label>
              <select id="mobile-year" class="form-select">
                <option value="">–õ—é–±–æ–π –≥–æ–¥</option>
                <option value="2023">2023</option>
                <option value="2022">2022</option>
                <option value="2021">2021</option>
                <option value="2020">2020</option>
              </select>
            </div>
          </div>
        </div>

        <div class="mobile-actions">
          <button id="apply-mobile-filters" class="btn btn-primary">
            –ü—Ä–∏–º–µ–Ω–∏—Ç—å
          </button>
          <button id="reset-mobile-filters" class="btn btn-outline-secondary">
            –°–±—Ä–æ—Å–∏—Ç—å
          </button>
        </div>
      </div>

      <!-- –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ -->
      <div class="mobile-section">
        <h2>‚ö° –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</h2>

        <div class="performance-metrics">
          <div class="metric-item">
            <div class="metric-value" id="load-time">-</div>
            <div class="metric-label">–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ (–º—Å)</div>
          </div>
          <div class="metric-item">
            <div class="metric-value" id="response-time">-</div>
            <div class="metric-label">–û—Ç–∫–ª–∏–∫ API (–º—Å)</div>
          </div>
          <div class="metric-item">
            <div class="metric-value" id="cache-hits">-</div>
            <div class="metric-label">–ü–æ–ø–∞–¥–∞–Ω–∏—è –≤ –∫—ç—à</div>
          </div>
          <div class="metric-item">
            <div class="metric-value" id="memory-usage">-</div>
            <div class="metric-label">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏</div>
          </div>
        </div>

        <button id="run-performance-test" class="btn btn-info w-100 mt-2">
          –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        </button>
      </div>

      <!-- –¢–µ—Å—Ç touch –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è -->
      <div class="mobile-section">
        <h2>üëÜ –¢–µ—Å—Ç touch –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è</h2>

        <div class="touch-test-area" id="touch-test-area">
          –ö–æ—Å–Ω–∏—Ç–µ—Å—å —ç—Ç–æ–π –æ–±–ª–∞—Å—Ç–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        </div>

        <div class="test-results" id="touch-results" style="display: none">
          <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã touch —Ç–µ—Å—Ç–∞:</strong><br />
          <span id="touch-details"></span>
        </div>

        <button id="test-touch-responsiveness" class="btn btn-warning w-100">
          –¢–µ—Å—Ç –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç–∏ touch
        </button>
      </div>

      <!-- –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ -->
      <div class="mobile-section">
        <h2>üì° –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h2>

        <div class="loading-test" id="loading-test">
          <p>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</p>
        </div>

        <div class="mobile-actions">
          <button id="test-load-countries" class="btn btn-success">
            –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω—ã
          </button>
          <button id="test-load-by-brand" class="btn btn-info">–ü–æ –º–∞—Ä–∫–µ</button>
        </div>
      </div>

      <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º –≤—ã–±–æ—Ä–µ -->
      <div class="mobile-section">
        <h2>‚ÑπÔ∏è –¢–µ–∫—É—â–∏–π –≤—ã–±–æ—Ä</h2>
        <div id="mobile-selection-info">
          <em>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã</em>
        </div>
      </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/CountryFilter.js"></script>

    <script>
      // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
      let mobileCountryFilter;
      let performanceMetrics = {
        loadTime: 0,
        responseTime: 0,
        cacheHits: 0,
        memoryUsage: 0,
      };

      // –ú–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
      const mockData = {
        countries: [
          { id: 1, name: "–ì–µ—Ä–º–∞–Ω–∏—è" },
          { id: 2, name: "–Ø–ø–æ–Ω–∏—è" },
          { id: 3, name: "–°–®–ê" },
          { id: 4, name: "–Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è" },
          { id: 5, name: "–§—Ä–∞–Ω—Ü–∏—è" },
        ],
        models: {
          1: [
            { id: 1, name: "X5" },
            { id: 2, name: "X3" },
          ],
          2: [
            { id: 3, name: "GLE" },
            { id: 4, name: "C-Class" },
          ],
          3: [
            { id: 5, name: "Q5" },
            { id: 6, name: "A4" },
          ],
          4: [
            { id: 7, name: "Camry" },
            { id: 8, name: "RAV4" },
          ],
          5: [
            { id: 9, name: "Civic" },
            { id: 10, name: "CR-V" },
          ],
        },
      };

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
      document.addEventListener("DOMContentLoaded", function () {
        initializeMobileDemo();
        updateDeviceInfo();
        updateConnectionInfo();
        setupMockAPI();
        bindMobileEvents();
      });

      /**
       * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–±–∏–ª—å–Ω–æ–π –¥–µ–º–æ
       */
      function initializeMobileDemo() {
        const startTime = performance.now();

        // –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞
        mobileCountryFilter = new CountryFilter(
          "mobile-country-filter",
          onMobileCountryChange
        );

        const endTime = performance.now();
        performanceMetrics.loadTime = Math.round(endTime - startTime);
        updatePerformanceMetrics();

        console.log("–ú–æ–±–∏–ª—å–Ω–∞—è –¥–µ–º–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞");
      }

      /**
       * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
       */
      function updateDeviceInfo() {
        const deviceType = detectDeviceType();
        const screenSize = `${window.innerWidth}x${window.innerHeight}`;
        const touchSupport =
          "ontouchstart" in window ? "–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è" : "–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è";
        const orientation =
          window.innerWidth > window.innerHeight ? "Landscape" : "Portrait";

        document.getElementById("device-type").textContent = deviceType;
        document.getElementById("screen-size").textContent = screenSize;
        document.getElementById("touch-support").textContent = touchSupport;
        document.getElementById("orientation").textContent = orientation;
      }

      /**
       * –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
       */
      function detectDeviceType() {
        const userAgent = navigator.userAgent;

        if (/iPad/.test(userAgent)) return "iPad";
        if (/iPhone/.test(userAgent)) return "iPhone";
        if (/Android/.test(userAgent)) {
          return /Mobile/.test(userAgent) ? "Android Phone" : "Android Tablet";
        }
        if (window.innerWidth <= 768) return "Mobile Device";

        return "Desktop/Unknown";
      }

      /**
       * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏
       */
      function updateConnectionInfo() {
        if ("connection" in navigator) {
          const connection = navigator.connection;
          const type = connection.effectiveType || "unknown";
          const speed = connection.downlink
            ? `${connection.downlink} Mbps`
            : "unknown";

          document.getElementById("connection-type").textContent =
            type.toUpperCase();
          document.getElementById("connection-speed").textContent = speed;
        } else {
          document.getElementById("connection-type").textContent =
            "–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è";
          document.getElementById("connection-speed").textContent =
            "–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è";
        }
      }

      /**
       * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–∫–æ–≤–æ–≥–æ API
       */
      function setupMockAPI() {
        const originalFetch = window.fetch;

        window.fetch = async function (url) {
          const startTime = performance.now();

          // –ò–º–∏—Ç–∞—Ü–∏—è —Å–µ—Ç–µ–≤–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
          const delay = getNetworkDelay();
          await new Promise((resolve) => setTimeout(resolve, delay));

          const endTime = performance.now();
          performanceMetrics.responseTime = Math.round(endTime - startTime);

          if (url.includes("/api/countries.php")) {
            return {
              ok: true,
              json: () =>
                Promise.resolve({
                  success: true,
                  data: mockData.countries,
                }),
            };
          }

          if (url.includes("/api/countries-by-brand.php")) {
            const brandId = new URL(
              url,
              window.location.origin
            ).searchParams.get("brand_id");
            return {
              ok: true,
              json: () =>
                Promise.resolve({
                  success: true,
                  data: mockData.countries.filter((c) => c.id <= 2), // –ò–º–∏—Ç–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
                }),
            };
          }

          return originalFetch.apply(this, arguments);
        };
      }

      /**
       * –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
       */
      function getNetworkDelay() {
        if ("connection" in navigator) {
          const effectiveType = navigator.connection.effectiveType;
          switch (effectiveType) {
            case "slow-2g":
              return 2000;
            case "2g":
              return 1000;
            case "3g":
              return 500;
            case "4g":
              return 200;
            default:
              return 300;
          }
        }
        return 300;
      }

      /**
       * –ü—Ä–∏–≤—è–∑–∫–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
       */
      function bindMobileEvents() {
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        document
          .getElementById("mobile-brand")
          .addEventListener("change", onMobileBrandChange);
        document
          .getElementById("mobile-model")
          .addEventListener("change", onMobileModelChange);
        document
          .getElementById("mobile-year")
          .addEventListener("change", onMobileYearChange);

        // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
        document
          .getElementById("apply-mobile-filters")
          .addEventListener("click", applyMobileFilters);
        document
          .getElementById("reset-mobile-filters")
          .addEventListener("click", resetMobileFilters);

        // –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        document
          .getElementById("run-performance-test")
          .addEventListener("click", runPerformanceTest);
        document
          .getElementById("test-load-countries")
          .addEventListener("click", testLoadCountries);
        document
          .getElementById("test-load-by-brand")
          .addEventListener("click", testLoadByBrand);

        // Touch —Ç–µ—Å—Ç—ã
        document
          .getElementById("test-touch-responsiveness")
          .addEventListener("click", testTouchResponsiveness);
        setupTouchTestArea();

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏
        window.addEventListener("orientationchange", () => {
          setTimeout(updateDeviceInfo, 100);
        });

        window.addEventListener("resize", () => {
          updateDeviceInfo();
        });
      }

      /**
       * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±–ª–∞—Å—Ç–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è touch
       */
      function setupTouchTestArea() {
        const touchArea = document.getElementById("touch-test-area");
        let touchCount = 0;
        let touchTimes = [];

        touchArea.addEventListener(
          "touchstart",
          (e) => {
            e.preventDefault();
            const startTime = performance.now();
            touchTimes.push(startTime);

            touchArea.classList.add("active");
            touchArea.textContent = `Touch ${++touchCount}`;
          },
          { passive: false }
        );

        touchArea.addEventListener(
          "touchend",
          (e) => {
            e.preventDefault();
            setTimeout(() => {
              touchArea.classList.remove("active");
            }, 150);
          },
          { passive: false }
        );

        // Fallback –¥–ª—è –º—ã—à–∏
        touchArea.addEventListener("mousedown", (e) => {
          touchArea.classList.add("active");
          touchArea.textContent = `Click ${++touchCount}`;
        });

        touchArea.addEventListener("mouseup", (e) => {
          setTimeout(() => {
            touchArea.classList.remove("active");
          }, 150);
        });
      }

      /**
       * –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
       */
      function onMobileBrandChange(event) {
        const brandId = event.target.value;
        updateMobileModels(brandId);

        if (mobileCountryFilter && brandId) {
          mobileCountryFilter.loadCountriesForBrand(brandId);
        } else if (mobileCountryFilter) {
          mobileCountryFilter.loadCountries();
        }

        updateMobileSelectionInfo();
      }

      function onMobileModelChange(event) {
        const modelId = event.target.value;

        if (mobileCountryFilter && modelId) {
          mobileCountryFilter.loadCountriesForModel(modelId);
        }

        updateMobileSelectionInfo();
      }

      function onMobileYearChange(event) {
        updateMobileSelectionInfo();
      }

      function onMobileCountryChange(countryId) {
        updateMobileSelectionInfo();
      }

      /**
       * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
       */
      function updateMobileModels(brandId) {
        const modelSelect = document.getElementById("mobile-model");

        modelSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å</option>';

        if (brandId && mockData.models[brandId]) {
          mockData.models[brandId].forEach((model) => {
            const option = document.createElement("option");
            option.value = model.id;
            option.textContent = model.name;
            modelSelect.appendChild(option);
          });
          modelSelect.disabled = false;
        } else {
          modelSelect.innerHTML =
            '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É</option>';
          modelSelect.disabled = true;
        }
      }

      /**
       * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤—ã–±–æ—Ä–µ
       */
      function updateMobileSelectionInfo() {
        const brand = document.getElementById("mobile-brand");
        const model = document.getElementById("mobile-model");
        const year = document.getElementById("mobile-year");
        const country = mobileCountryFilter
          ? mobileCountryFilter.getSelectedCountryInfo()
          : null;

        const selection = [];

        if (brand.value) {
          selection.push(`–ú–∞—Ä–∫–∞: ${brand.options[brand.selectedIndex].text}`);
        }

        if (model.value) {
          selection.push(`–ú–æ–¥–µ–ª—å: ${model.options[model.selectedIndex].text}`);
        }

        if (country) {
          selection.push(`–°—Ç—Ä–∞–Ω–∞: ${country.name}`);
        }

        if (year.value) {
          selection.push(`–ì–æ–¥: ${year.value}`);
        }

        const infoElement = document.getElementById("mobile-selection-info");
        if (selection.length > 0) {
          infoElement.innerHTML = selection.join("<br>");
        } else {
          infoElement.innerHTML = "<em>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã</em>";
        }
      }

      /**
       * –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
       */
      function applyMobileFilters() {
        const loadingTest = document.getElementById("loading-test");
        loadingTest.innerHTML = `
          <div class="loading-indicator"></div>
          <p>–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤...</p>
        `;

        setTimeout(() => {
          loadingTest.innerHTML = `
            <div class="alert alert-success">
              ‚úÖ –§–∏–ª—å—Ç—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!<br>
              <small>–ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: ${
                Math.floor(Math.random() * 20) + 1
              }</small>
            </div>
          `;
        }, 1500);
      }

      /**
       * –°–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤
       */
      function resetMobileFilters() {
        document.getElementById("mobile-brand").value = "";
        document.getElementById("mobile-model").value = "";
        document.getElementById("mobile-model").disabled = true;
        document.getElementById("mobile-year").value = "";

        if (mobileCountryFilter) {
          mobileCountryFilter.reset();
          mobileCountryFilter.loadCountries();
        }

        updateMobileSelectionInfo();
      }

      /**
       * –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
       */
      async function runPerformanceTest() {
        const button = document.getElementById("run-performance-test");
        button.disabled = true;
        button.textContent = "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...";

        try {
          // –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏
          const startTime = performance.now();
          await mobileCountryFilter.loadCountries();
          const loadTime = performance.now() - startTime;

          // –¢–µ—Å—Ç –∫—ç—à–∞
          const cacheStartTime = performance.now();
          await mobileCountryFilter.loadCountries(); // –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∏–∑ –∫—ç—à–∞
          const cacheTime = performance.now() - cacheStartTime;

          // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
          performanceMetrics.loadTime = Math.round(loadTime);
          performanceMetrics.responseTime = Math.round(cacheTime);
          performanceMetrics.cacheHits++;

          if (performance.memory) {
            performanceMetrics.memoryUsage = Math.round(
              performance.memory.usedJSHeapSize / 1024 / 1024
            );
          }

          updatePerformanceMetrics();
        } catch (error) {
          console.error("Performance test failed:", error);
        } finally {
          button.disabled = false;
          button.textContent = "–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏";
        }
      }

      async function testLoadCountries() {
        const startTime = performance.now();
        await mobileCountryFilter.loadCountries();
        const endTime = performance.now();

        showLoadingResult(
          `–°—Ç—Ä–∞–Ω—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–∞ ${Math.round(endTime - startTime)}–º—Å`
        );
      }

      async function testLoadByBrand() {
        const startTime = performance.now();
        await mobileCountryFilter.loadCountriesForBrand(1);
        const endTime = performance.now();

        showLoadingResult(
          `–°—Ç—Ä–∞–Ω—ã –¥–ª—è BMW –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–∞ ${Math.round(endTime - startTime)}–º—Å`
        );
      }

      function showLoadingResult(message) {
        const loadingTest = document.getElementById("loading-test");
        loadingTest.innerHTML = `
          <div class="alert alert-info">
            üìä ${message}
          </div>
        `;
      }

      /**
       * –¢–µ—Å—Ç –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç–∏ touch
       */
      function testTouchResponsiveness() {
        const button = document.getElementById("test-touch-responsiveness");
        const results = document.getElementById("touch-results");
        const details = document.getElementById("touch-details");

        button.disabled = true;
        button.textContent = "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...";

        let touchCount = 0;
        let responseTimes = [];

        const testTouch = () => {
          const startTime = performance.now();

          // –ò–º–∏—Ç–∞—Ü–∏—è touch —Å–æ–±—ã—Ç–∏—è
          setTimeout(() => {
            const endTime = performance.now();
            responseTimes.push(endTime - startTime);
            touchCount++;

            if (touchCount < 5) {
              setTimeout(testTouch, 200);
            } else {
              // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
              const avgResponse =
                responseTimes.reduce((a, b) => a + b, 0) / responseTimes.length;
              details.textContent = `–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞: ${Math.round(
                avgResponse
              )}–º—Å (${touchCount} —Ç–µ—Å—Ç–æ–≤)`;
              results.style.display = "block";

              button.disabled = false;
              button.textContent = "–¢–µ—Å—Ç –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç–∏ touch";
            }
          }, Math.random() * 50 + 10);
        };

        testTouch();
      }

      /**
       * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
       */
      function updatePerformanceMetrics() {
        document.getElementById("load-time").textContent =
          performanceMetrics.loadTime;
        document.getElementById("response-time").textContent =
          performanceMetrics.responseTime;
        document.getElementById("cache-hits").textContent =
          performanceMetrics.cacheHits;
        document.getElementById("memory-usage").textContent =
          performanceMetrics.memoryUsage + "MB";
      }
    </script>
  </body>
</html>
