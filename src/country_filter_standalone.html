<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞ —Å—Ç—Ä–∞–Ω –Ω–∞ zavodprostavok.ru</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      .country-filter {
        margin-bottom: 20px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background: #f9f9f9;
      }
      .filter-label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      .filter-select {
        width: 100%;
        max-width: 300px;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background: white;
        font-size: 14px;
      }
      .filter-loading {
        color: #007bff;
        font-style: italic;
        font-size: 12px;
      }
      .filter-error {
        color: #dc3545;
        font-size: 12px;
      }
      .retry-button {
        background: #007bff;
        color: white;
        border: none;
        padding: 4px 8px;
        border-radius: 3px;
        cursor: pointer;
        font-size: 11px;
      }
      .debug-info {
        background: white;
        border: 1px solid #ddd;
        padding: 15px;
        margin-top: 20px;
        border-radius: 4px;
      }
      .debug-info pre {
        background: #f4f4f4;
        padding: 10px;
        border-radius: 3px;
        overflow-x: auto;
      }
      .status {
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
      }
      .status.success {
        background: #d4edda;
        color: #155724;
      }
      .status.error {
        background: #f8d7da;
        color: #721c24;
      }
      .status.info {
        background: #d1ecf1;
        color: #0c5460;
      }
    </style>
  </head>
  <body>
    <h1>üß™ –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞ —Å—Ç—Ä–∞–Ω –Ω–∞ zavodprostavok.ru</h1>

    <div class="status info">
      <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –≠—Ç–æ—Ç —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–∑–º–µ—â–µ–Ω –Ω–∞ —Å–∞–π—Ç–µ
      zavodprostavok.ru –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è CORS –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API –Ω–∞ 178.72.129.61
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞ —Å—Ç—Ä–∞–Ω -->
    <div id="country-filter-container"></div>

    <div class="debug-info">
      <h3>–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
      <div>
        <strong>–¢–µ–∫—É—â–∏–π –¥–æ–º–µ–Ω:</strong> <span id="current-domain"></span>
      </div>
      <div><strong>API URL:</strong> <span id="api-url"></span></div>
      <div>
        <strong>–í—ã–±—Ä–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∞:</strong>
        <span id="selected-country">–ù–µ –≤—ã–±—Ä–∞–Ω–∞</span>
      </div>
      <div>
        <strong>–°—Ç–∞—Ç—É—Å API:</strong> <span id="api-status">–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è...</span>
      </div>
      <div>
        <strong>–ü–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç–≤–µ—Ç:</strong>
        <pre id="api-response">–û–∂–∏–¥–∞–Ω–∏–µ...</pre>
      </div>
    </div>

    <script>
      // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
      const API_BASE_URL = "http://178.72.129.61/api";

      // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
      document.getElementById("current-domain").textContent =
        window.location.hostname;
      document.getElementById("api-url").textContent = API_BASE_URL;

      // –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è CountryFilter –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
      class SimpleCountryFilter {
        constructor(containerId, onChangeCallback) {
          this.container = document.getElementById(containerId);
          this.onChange = onChangeCallback;
          this.countries = [];
          this.selectedCountry = null;
          this.apiBaseUrl = API_BASE_URL;

          this.init();
        }

        init() {
          this.render();
          this.loadCountries();
        }

        render() {
          this.container.innerHTML = `
                    <div class="country-filter">
                        <label for="country-select" class="filter-label">
                            –°—Ç—Ä–∞–Ω–∞ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:
                        </label>
                        <div class="filter-input-wrapper">
                            <select id="country-select" class="filter-select">
                                <option value="">–í—Å–µ —Å—Ç—Ä–∞–Ω—ã</option>
                            </select>
                            <div class="filter-loading" style="display: none;">
                                –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω...
                            </div>
                            <div class="filter-error" style="display: none;">
                                <span class="error-message"></span>
                                <button type="button" class="retry-button">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
                            </div>
                        </div>
                    </div>
                `;

          this.selectElement = this.container.querySelector("#country-select");
          this.loadingElement = this.container.querySelector(".filter-loading");
          this.errorElement = this.container.querySelector(".filter-error");
          this.retryButton = this.container.querySelector(".retry-button");

          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
          this.selectElement.addEventListener("change", (e) => {
            this.selectedCountry = e.target.value || null;
            this.triggerChange();
          });

          this.retryButton.addEventListener("click", () => {
            this.loadCountries();
          });
        }

        async loadCountries() {
          this.showLoading();

          try {
            const response = await fetch(`${this.apiBaseUrl}/countries.php`, {
              method: "GET",
              headers: {
                Accept: "application/json",
                "Content-Type": "application/json",
              },
            });

            const result = await response.json();

            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            document.getElementById("api-status").textContent = response.ok
              ? "‚úÖ –£—Å–ø–µ—à–Ω–æ"
              : "‚ùå –û—à–∏–±–∫–∞";
            document.getElementById("api-response").textContent =
              JSON.stringify(result, null, 2);

            if (result.success && result.data) {
              this.countries = result.data;
              this.populateSelect(result.data);
              this.hideLoading();

              // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω—ã–π —Å—Ç–∞—Ç—É—Å
              this.showStatus(
                "success",
                `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${result.data.length} —Å—Ç—Ä–∞–Ω`
              );
            } else {
              this.showError(result.error || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ API");
            }
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω:", error);
            this.showError(`–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: ${error.message}`);

            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            document.getElementById("api-status").textContent =
              "‚ùå –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞";
            document.getElementById(
              "api-response"
            ).textContent = `–û—à–∏–±–∫–∞: ${error.message}`;
          }
        }

        populateSelect(countries) {
          // –û—á–∏—â–∞–µ–º select
          this.selectElement.innerHTML = '<option value="">–í—Å–µ —Å—Ç—Ä–∞–Ω—ã</option>';

          // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω—ã
          countries.forEach((country) => {
            const option = document.createElement("option");
            option.value = country.id;
            option.textContent = country.name;
            this.selectElement.appendChild(option);
          });
        }

        showLoading() {
          this.loadingElement.style.display = "block";
          this.errorElement.style.display = "none";
          this.selectElement.disabled = true;
        }

        hideLoading() {
          this.loadingElement.style.display = "none";
          this.selectElement.disabled = false;
        }

        showError(message) {
          this.hideLoading();
          this.errorElement.style.display = "block";
          this.errorElement.querySelector(".error-message").textContent =
            message;

          this.showStatus("error", message);
        }

        showStatus(type, message) {
          // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å—Ç–∞—Ç—É—Å—ã
          const existingStatus = document.querySelector(".status.dynamic");
          if (existingStatus) {
            existingStatus.remove();
          }

          // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
          const statusDiv = document.createElement("div");
          statusDiv.className = `status ${type} dynamic`;
          statusDiv.innerHTML = `<strong>${
            type === "success" ? "–£—Å–ø–µ—Ö" : "–û—à–∏–±–∫–∞"
          }:</strong> ${message}`;

          // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
          const h1 = document.querySelector("h1");
          h1.insertAdjacentElement("afterend", statusDiv);
        }

        triggerChange() {
          document.getElementById("selected-country").textContent =
            this.selectedCountry || "–ù–µ –≤—ã–±—Ä–∞–Ω–∞";

          if (typeof this.onChange === "function") {
            this.onChange(this.selectedCountry);
          }
        }
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      document.addEventListener("DOMContentLoaded", function () {
        const countryFilter = new SimpleCountryFilter(
          "country-filter-container",
          function (selectedCountryId) {
            console.log("–í—ã–±—Ä–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∞ —Å ID:", selectedCountryId);

            // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∞—à–∞ –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞–Ω—ã
            if (selectedCountryId) {
              alert(`–í—ã–±—Ä–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∞ —Å ID: ${selectedCountryId}`);
            } else {
              alert("–°–±—Ä–æ—à–µ–Ω —Ñ–∏–ª—å—Ç—Ä –ø–æ —Å—Ç—Ä–∞–Ω–µ");
            }
          }
        );
      });
    </script>
  </body>
</html>
